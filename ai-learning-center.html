<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI学习中心 - XDR智能运营系统</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#1e40af',
                        secondary: '#64748b',
                        accent: '#3b82f6',
                        success: '#10b981',
                        warning: '#f59e0b',
                        danger: '#ef4444',
                        ai: '#8b5cf6',
                        learning: '#06b6d4'
                    },
                    animation: {
                        'fade-in': 'fadeIn 0.5s ease-in-out',
                        'slide-up': 'slideUp 0.3s ease-out',
                        'bounce-subtle': 'bounceSubtle 0.6s ease-in-out',
                        'glow': 'glow 2s ease-in-out infinite alternate'
                    }
                }
            }
        }
    </script>
    <style>
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        @keyframes slideUp {
            from { transform: translateY(20px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }
        @keyframes bounceSubtle {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }
        @keyframes glow {
            from { box-shadow: 0 0 10px rgba(139, 92, 246, 0.3); }
            to { box-shadow: 0 0 20px rgba(139, 92, 246, 0.6); }
        }
        .card-hover {
            transition: all 0.3s ease;
        }
        .card-hover:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.1);
        }
        .learning-badge {
            background: linear-gradient(135deg, #8b5cf6, #06b6d4);
        }
        .knowledge-item:hover .teach-ai-btn {
            opacity: 1;
        }
        .teach-ai-btn {
            opacity: 0;
            transition: opacity 0.2s ease;
        }
        .floating-toolbar {
            background: linear-gradient(135deg, #8b5cf6, #06b6d4);
            box-shadow: 0 4px 20px rgba(139, 92, 246, 0.3);
            animation: fadeInScale 0.2s ease-out;
            border: 2px solid rgba(255, 255, 255, 0.2);
            backdrop-filter: blur(10px);
        }
        @keyframes fadeInScale {
            from { 
                opacity: 0; 
                transform: scale(0.8) translateY(10px); 
            }
            to { 
                opacity: 1; 
                transform: scale(1) translateY(0); 
            }
        }
        .selectable-text {
            user-select: text;
            cursor: text;
        }
        .selectable-text::selection {
            background: rgba(139, 92, 246, 0.3);
        }
    </style>
</head>
<body class="bg-gray-50 min-h-screen">
    <!-- 页面标题区域 -->
    <div class="bg-white shadow-sm border-b">
        <div class="max-w-7xl mx-auto px-6 py-4">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-4">
                    <div class="w-12 h-12 bg-gradient-to-r from-ai to-learning rounded-xl flex items-center justify-center">
                        <i class="fas fa-brain text-white text-xl"></i>
                    </div>
                    <div>
                        <h1 class="text-2xl font-bold text-gray-900">安全GPT智能学习平台</h1>
                        <p class="text-sm text-gray-600">构建自适应、自学习的智能安全调优体系，让AI学习您的独特环境和研判经验</p>
                    </div>
                </div>
                <div class="flex items-center space-x-3">
                    <div class="text-sm text-gray-500">
                        <i class="fas fa-shield-alt mr-1"></i>
                        告警精准度: <span class="font-bold text-success">92%</span>
                    </div>
                    <div class="text-sm text-gray-500">
                        <i class="fas fa-robot mr-1"></i>
                        自动化率: <span class="font-bold text-ai">85%</span>
                    </div>
                    <div class="text-sm text-gray-500">
                        <i class="fas fa-lightbulb mr-1"></i>
                        今日学习: <span class="font-bold text-learning">12</span>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- 主要内容区域 -->
    <div class="max-w-7xl mx-auto px-6 py-6">
        <!-- 导航标签页 -->
        <div class="mb-6">
            <nav class="flex space-x-8">
                <button class="tab-btn active" data-tab="context">
                    <i class="fas fa-hand-pointer mr-2"></i>
                    AI互动调优演示
                </button>
                <button class="tab-btn" data-tab="assets">
                    <i class="fas fa-network-wired mr-2"></i>
                    环境感知学习
                </button>
                <button class="tab-btn" data-tab="judgment">
                    <i class="fas fa-brain mr-2"></i>
                    研判智能学习
                </button>
                <button class="tab-btn" data-tab="disposal">
                    <i class="fas fa-tasks mr-2"></i>
                    处置知识学习
                </button>
                <button class="tab-btn" data-tab="analytics">
                    <i class="fas fa-chart-line mr-2"></i>
                    价值可视化
                </button>
            </nav>
        </div>

        <!-- 环境感知学习 -->
        <div id="assets-tab" class="tab-content hidden">
            <div class="space-y-6">
                <!-- 页面说明 -->
                <div class="bg-gradient-to-r from-context/10 to-blue-50 rounded-lg shadow-sm border border-context/20 p-6">
                    <div class="flex items-center justify-between">
                        <div class="flex items-center space-x-3">
                            <div class="w-12 h-12 bg-gradient-to-r from-context to-blue-500 rounded-xl flex items-center justify-center">
                                <i class="fas fa-network-wired text-white text-xl"></i>
                            </div>
                            <div>
                                <h3 class="text-xl font-bold text-gray-900">环境感知学习</h3>
                                <p class="text-sm text-gray-600">AI自动识别和学习客户IT环境，提供精准的网络拓扑分析和资产配置建议</p>
                            </div>
                        </div>
                        <div class="flex items-center space-x-4">
                            <div class="text-sm text-gray-500">
                                <i class="fas fa-shield-alt mr-1"></i>
                                网络识别准确率: <span class="font-bold text-context">96%</span>
                            </div>
                            <div class="text-sm text-gray-500">
                                <i class="fas fa-server mr-1"></i>
                                已识别资产: <span class="font-bold text-blue-600">342</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 网络拓扑自动识别 -->
                <div class="bg-white rounded-lg shadow-sm border card-hover">
                    <div class="p-6 border-b border-gray-200">
                        <div class="flex items-center justify-between">
                            <div class="flex items-center space-x-3">
                                <div class="w-10 h-10 bg-blue-100 rounded-lg flex items-center justify-center">
                                    <i class="fas fa-sitemap text-blue-600 text-lg"></i>
                                </div>
                                <div>
                                    <h4 class="text-lg font-semibold text-gray-900">网络拓扑自动识别</h4>
                                    <p class="text-sm text-gray-600">AI自动识别内外网配置，推荐网络分段策略</p>
                                </div>
                            </div>
                            <div class="flex items-center space-x-2">
                                <div class="w-2 h-2 bg-green-500 rounded-full animate-pulse"></div>
                                <span class="text-xs text-green-600 font-medium">实时扫描</span>
                            </div>
                        </div>
                    </div>
                    <div class="p-6">
                        <div class="space-y-4">
                            <div class="bg-blue-50 border border-blue-200 rounded-lg p-4">
                                <div class="flex items-start space-x-3">
                                    <div class="w-8 h-8 bg-blue-600 text-white rounded-full flex items-center justify-center text-xs font-bold">
                                        <i class="fas fa-lightbulb"></i>
                                    </div>
                                    <div class="flex-1">
                                        <h5 class="font-medium text-blue-800 mb-1">AI发现: 内网分段建议</h5>
                                        <p class="text-sm text-blue-700 mb-2">基于流量分析，建议将192.168.100.0/24设为DMZ区域</p>
                                        <div class="text-xs text-blue-600 mb-2">
                                            <strong>分析证据:</strong> 该网段存在大量外网访问，且运行Web服务
                                        </div>
                                        <div class="flex items-center space-x-2">
                                            <button onclick="applyNetworkConfig('dmz-suggestion')" class="text-xs bg-blue-600 text-white px-3 py-1 rounded-full hover:bg-blue-700">
                                                一键应用
                                            </button>
                                            <button onclick="showNetworkDetail('dmz-suggestion')" class="text-xs bg-blue-100 text-blue-600 px-3 py-1 rounded-full hover:bg-blue-200">
                                                查看详情
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="bg-green-50 border border-green-200 rounded-lg p-4">
                                <div class="flex items-start space-x-3">
                                    <div class="w-8 h-8 bg-green-600 text-white rounded-full flex items-center justify-center text-xs font-bold">
                                        <i class="fas fa-check"></i>
                                    </div>
                                    <div class="flex-1">
                                        <h5 class="font-medium text-green-800 mb-1">已识别: 办公网络区域</h5>
                                        <p class="text-sm text-green-700 mb-2">10.10.0.0/16确认为办公内网，安全策略已自动适配</p>
                                        <div class="text-xs text-green-600">
                                            <strong>最后更新:</strong> 2小时前
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 资产学习与识别 -->
                <div>
                    <div class="bg-white rounded-lg shadow-sm border card-hover">
                        <div class="p-6 border-b border-gray-200">
                            <div class="flex items-center justify-between">
                                <div class="flex items-center space-x-3">
                                    <div class="w-10 h-10 bg-gradient-to-r from-context to-blue-500 rounded-lg flex items-center justify-center">
                                        <i class="fas fa-database text-white text-lg"></i>
                                    </div>
                                    <div>
                                        <h4 class="text-lg font-semibold text-gray-900">资产学习与识别</h4>
                                        <p class="text-sm text-gray-600">支持CMDB导入，AI自动学习资产属性和业务关联</p>
                                    </div>
                                </div>
                                <div class="flex items-center space-x-2">
                                    <button onclick="importCMDB()" class="bg-gradient-to-r from-context to-blue-500 text-white px-3 py-2 rounded-lg hover:from-green-600 hover:to-blue-600 transition-all text-sm">
                                        <i class="fas fa-upload mr-1"></i>
                                        导入CMDB
                                    </button>
                                    <button onclick="addAssetKnowledge()" class="bg-ai text-white px-3 py-2 rounded-lg hover:bg-purple-700 transition-colors text-sm">
                                        <i class="fas fa-plus mr-1"></i>
                                        新增资产
                                    </button>
                                </div>
                            </div>
                            <div class="mt-4 flex space-x-4">
                                <input type="text" id="asset-search" placeholder="搜索IP、标签或业务归属..." 
                                       oninput="searchAssetKnowledge()"
                                       class="flex-1 px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-ai focus:border-transparent">
                                <select id="asset-filter" onchange="filterAssetKnowledge()" class="px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-ai">
                                    <option value="">全部类型</option>
                                    <option value="服务器">服务器</option>
                                    <option value="网络设备">网络设备</option>
                                    <option value="安全设备">安全设备</option>
                                    <option value="业务系统">业务系统</option>
                                </select>
                            </div>
                        </div>
                        <div class="overflow-x-auto">
                            <table class="w-full">
                                <thead class="bg-gray-50">
                                    <tr>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">实体</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">资产标签</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">业务归属</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">学习来源</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">操作</th>
                                    </tr>
                                </thead>
                                <tbody class="bg-white divide-y divide-gray-200" id="asset-knowledge-list">
                                    <!-- 动态生成的资产知识条目 -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>

            </div>
        </div>

        <!-- 研判智能学习 -->
        <div id="judgment-tab" class="tab-content hidden">
            <div class="max-w-7xl mx-auto">
                <!-- 页面说明 -->
                <div class="bg-gradient-to-r from-judgment/10 to-orange-50 rounded-lg shadow-sm border border-judgment/20 p-6 mb-6">
                    <div class="flex items-center justify-between">
                        <div class="flex items-center space-x-3">
                            <div class="w-12 h-12 bg-gradient-to-r from-judgment to-orange-500 rounded-xl flex items-center justify-center">
                                <i class="fas fa-brain text-white text-xl"></i>
                            </div>
                            <div>
                                <h3 class="text-xl font-bold text-gray-900">研判智能学习</h3>
                                <p class="text-sm text-gray-600">基于用户反馈的监督学习，形成"人工反馈 → AI学习 → 策略优化"的良性闭环</p>
                            </div>
                        </div>
                        <div class="flex items-center space-x-4">
                            <div class="text-sm text-gray-500">
                                <i class="fas fa-thumbs-up mr-1"></i>
                                标注准确率: <span class="font-bold text-judgment">94%</span>
                            </div>
                            <div class="text-sm text-gray-500">
                                <i class="fas fa-robot mr-1"></i>
                                AI推荐采纳率: <span class="font-bold text-orange-600">87%</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 功能模块网格 -->
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6">
                    <!-- 用户反馈学习 -->
                    <div class="bg-white rounded-lg shadow-sm border card-hover">
                        <div class="p-6 border-b border-gray-200">
                            <div class="flex items-center justify-between">
                                <div class="flex items-center space-x-3">
                                    <div class="w-10 h-10 bg-green-100 rounded-lg flex items-center justify-center">
                                        <i class="fas fa-thumbs-up text-green-600 text-lg"></i>
                                    </div>
                                    <div>
                                        <h4 class="text-lg font-semibold text-gray-900">用户反馈学习</h4>
                                        <p class="text-sm text-gray-600">客户打标系统，AI实时学习用户判断</p>
                                    </div>
                                </div>
                                <div class="flex items-center space-x-2">
                                    <div class="w-2 h-2 bg-green-500 rounded-full animate-pulse"></div>
                                    <span class="text-xs text-green-600 font-medium">实时学习</span>
                                </div>
                            </div>
                        </div>
                        <div class="p-6">
                            <div class="space-y-4">
                                <!-- 打标演示 -->
                                <div class="bg-gray-50 rounded-lg p-4">
                                    <h5 class="font-medium text-gray-800 mb-3">模拟告警打标演示</h5>
                                    <div class="bg-white border-2 border-dashed border-gray-300 rounded-lg p-4">
                                        <div class="flex items-center justify-between mb-2">
                                            <div class="text-sm font-medium text-gray-800">SQL注入攻击尝试</div>
                                            <div class="text-xs text-gray-500">2024-01-15 14:30</div>
                                        </div>
                                        <div class="text-sm text-gray-600 mb-3">来源: 192.168.1.100 → 目标: 10.10.10.10</div>
                                        <div class="flex items-center space-x-2">
                                            <button onclick="labelAlert('positive')" class="flex items-center space-x-2 bg-green-500 text-white px-3 py-1 rounded-full text-sm hover:bg-green-600 transition-colors">
                                                <i class="fas fa-check"></i>
                                                <span>✅正报</span>
                                            </button>
                                            <button onclick="labelAlert('negative')" class="flex items-center space-x-2 bg-red-500 text-white px-3 py-1 rounded-full text-sm hover:bg-red-600 transition-colors">
                                                <i class="fas fa-times"></i>
                                                <span>❌误报</span>
                                            </button>
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- 学习统计 -->
                                <div class="bg-green-50 border border-green-200 rounded-lg p-4">
                                    <h5 class="font-medium text-green-800 mb-3">本周学习统计</h5>
                                    <div class="grid grid-cols-2 gap-3 text-sm">
                                        <div class="text-center">
                                            <div class="text-2xl font-bold text-green-600">156</div>
                                            <div class="text-green-700">用户标注</div>
                                        </div>
                                        <div class="text-center">
                                            <div class="text-2xl font-bold text-blue-600">23</div>
                                            <div class="text-blue-700">AI纠错</div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- 现场交互式调优 -->
                    <div class="bg-white rounded-lg shadow-sm border card-hover">
                        <div class="p-6 border-b border-gray-200">
                            <div class="flex items-center justify-between">
                                <div class="flex items-center space-x-3">
                                    <div class="w-10 h-10 bg-purple-100 rounded-lg flex items-center justify-center">
                                        <i class="fas fa-edit text-purple-600 text-lg"></i>
                                    </div>
                                    <div>
                                        <h4 class="text-lg font-semibold text-gray-900">现场交互式调优</h4>
                                        <p class="text-sm text-gray-600">划词调优，复合条件，全程审计</p>
                                    </div>
                                </div>
                                <div class="flex items-center space-x-2">
                                    <div class="w-2 h-2 bg-purple-500 rounded-full animate-pulse"></div>
                                    <span class="text-xs text-purple-600 font-medium">实时调优</span>
                                </div>
                            </div>
                        </div>
                        <div class="p-6">
                            <div class="space-y-4">
                                <!-- 调优演示 -->
                                <div class="bg-gray-50 rounded-lg p-4">
                                    <h5 class="font-medium text-gray-800 mb-3">Payload调优演示</h5>
                                    <div class="bg-white border-2 border-dashed border-gray-300 rounded-lg p-4 font-mono text-sm">
                                        <div class="text-xs text-gray-500 mb-2">划选特定字段创建调优规则</div>
                                        <div class="selectable-text cursor-text">
                                            GET /api/user?id=<span class="bg-yellow-200 px-1 rounded border border-yellow-400 font-semibold">1' OR '1'='1</span> HTTP/1.1<br>
                                            Host: target.com<br>
                                            User-Agent: <span class="bg-yellow-200 px-1 rounded border border-yellow-400 font-semibold">sqlmap/1.0</span>
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- 调优记录 -->
                                <div class="bg-purple-50 border border-purple-200 rounded-lg p-4">
                                    <h5 class="font-medium text-purple-800 mb-3">最近调优记录</h5>
                                    <div class="space-y-2 text-sm">
                                        <div class="flex items-center space-x-2">
                                            <div class="w-4 h-4 bg-purple-600 rounded-full flex items-center justify-center">
                                                <i class="fas fa-check text-white text-xs"></i>
                                            </div>
                                            <span class="text-purple-700">条件: User-Agent包含"sqlmap" AND Payload包含"OR"</span>
                                        </div>
                                        <div class="flex items-center space-x-2">
                                            <div class="w-4 h-4 bg-green-600 rounded-full flex items-center justify-center">
                                                <i class="fas fa-check text-white text-xs"></i>
                                            </div>
                                            <span class="text-green-700">操作: 设置为高风险威胁</span>
                                        </div>
                                        <div class="text-xs text-gray-500">
                                            操作人: 张安全 | 时间: 2024-01-15 14:25
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 知识注入与AI推荐 -->
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                    <!-- 外部知识学习 -->
                    <div class="bg-white rounded-lg shadow-sm border card-hover">
                        <div class="p-6 border-b border-gray-200">
                            <div class="flex items-center justify-between">
                                <div class="flex items-center space-x-3">
                                    <div class="w-10 h-10 bg-blue-100 rounded-lg flex items-center justify-center">
                                        <i class="fas fa-file-upload text-blue-600 text-lg"></i>
                                    </div>
                                    <div>
                                        <h4 class="text-lg font-semibold text-gray-900">外部知识学习</h4>
                                        <p class="text-sm text-gray-600">导入研判手册、应急预案等文档</p>
                                    </div>
                                </div>
                                <button onclick="uploadKnowledgeDoc()" class="bg-blue-500 text-white px-4 py-2 rounded-lg hover:bg-blue-600 transition-colors">
                                    <i class="fas fa-plus mr-2"></i>
                                    导入文档
                                </button>
                            </div>
                        </div>
                        <div class="p-6">
                            <div class="space-y-4">
                                <div class="bg-blue-50 border border-blue-200 rounded-lg p-4">
                                    <div class="flex items-center space-x-3 mb-2">
                                        <i class="fas fa-file-alt text-blue-600"></i>
                                        <span class="font-medium text-blue-800">研判经验手册.pdf</span>
                                    </div>
                                    <div class="text-sm text-blue-700 mb-2">AI已解析并生成12条分析规则</div>
                                    <div class="flex items-center space-x-2">
                                        <span class="text-xs bg-blue-100 text-blue-700 px-2 py-1 rounded">已学习</span>
                                        <span class="text-xs text-blue-600">上传时间: 2024-01-10</span>
                                    </div>
                                </div>
                                
                                <div class="bg-gray-50 border border-gray-200 rounded-lg p-4">
                                    <div class="flex items-center space-x-3 mb-2">
                                        <i class="fas fa-file-alt text-gray-600"></i>
                                        <span class="font-medium text-gray-800">应急响应预案.docx</span>
                                    </div>
                                    <div class="text-sm text-gray-700 mb-2">AI正在解析文档内容...</div>
                                    <div class="flex items-center space-x-2">
                                        <span class="text-xs bg-yellow-100 text-yellow-700 px-2 py-1 rounded">处理中</span>
                                        <span class="text-xs text-gray-600">预计完成: 5分钟</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- AI自主推荐 -->
                    <div class="bg-white rounded-lg shadow-sm border card-hover">
                        <div class="p-6 border-b border-gray-200">
                            <div class="flex items-center justify-between">
                                <div class="flex items-center space-x-3">
                                    <div class="w-10 h-10 bg-gradient-to-r from-purple-500 to-pink-500 rounded-lg flex items-center justify-center">
                                        <i class="fas fa-robot text-white text-lg"></i>
                                    </div>
                                    <div>
                                        <h4 class="text-lg font-semibold text-gray-900">AI自主推荐</h4>
                                        <p class="text-sm text-gray-600">基于数据分析的智能规则推荐</p>
                                    </div>
                                </div>
                                <div class="flex items-center space-x-2">
                                    <div class="w-2 h-2 bg-gradient-to-r from-purple-500 to-pink-500 rounded-full animate-pulse"></div>
                                    <span class="text-xs text-purple-600 font-medium">AI推荐中</span>
                                </div>
                            </div>
                        </div>
                        <div class="p-6">
                            <div class="space-y-4">
                                <div class="bg-gradient-to-r from-purple-50 to-pink-50 border border-purple-200 rounded-lg p-4">
                                    <div class="flex items-start space-x-3">
                                        <div class="w-8 h-8 bg-purple-600 text-white rounded-full flex items-center justify-center text-xs">
                                            <i class="fas fa-lightbulb"></i>
                                        </div>
                                        <div class="flex-1">
                                            <h5 class="font-medium text-purple-800 mb-1">AI推荐规则</h5>
                                            <p class="text-sm text-purple-700 mb-2">基于相似性分析，建议对"Python-requests"特征进行良性标记</p>
                                            <div class="text-xs text-purple-600 mb-2">
                                                <strong>影响告警:</strong> 约45条
                                            </div>
                                            <div class="flex items-center space-x-2">
                                                <button onclick="acceptAIRecommendation('python-requests')" class="text-xs bg-purple-600 text-white px-3 py-1 rounded-full hover:bg-purple-700">
                                                    采纳推荐
                                                </button>
                                                <button onclick="rejectAIRecommendation('python-requests')" class="text-xs bg-purple-100 text-purple-600 px-3 py-1 rounded-full hover:bg-purple-200">
                                                    拒绝推荐
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="bg-gradient-to-r from-blue-50 to-cyan-50 border border-blue-200 rounded-lg p-4">
                                    <div class="flex items-start space-x-3">
                                        <div class="w-8 h-8 bg-blue-600 text-white rounded-full flex items-center justify-center text-xs">
                                            <i class="fas fa-chart-line"></i>
                                        </div>
                                        <div class="flex-1">
                                            <h5 class="font-medium text-blue-800 mb-1">策略优化建议</h5>
                                            <p class="text-sm text-blue-700 mb-2">建议调整SQL注入检测阈值，降低15%误报率</p>
                                            <div class="text-xs text-blue-600 mb-2">
                                                <strong>预期效果:</strong> 误报率从12%降至7%
                                            </div>
                                            <div class="flex items-center space-x-2">
                                                <button onclick="acceptAIRecommendation('sql-threshold')" class="text-xs bg-blue-600 text-white px-3 py-1 rounded-full hover:bg-blue-700">
                                                    采纳推荐
                                                </button>
                                                <button onclick="rejectAIRecommendation('sql-threshold')" class="text-xs bg-blue-100 text-blue-600 px-3 py-1 rounded-full hover:bg-blue-200">
                                                    拒绝推荐
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 统一研判知识库 -->
                <div class="mt-6 bg-white rounded-lg shadow-sm border card-hover">
                    <div class="p-6 border-b border-gray-200">
                        <div class="flex items-center justify-between">
                            <div class="flex items-center space-x-3">
                                <div class="w-10 h-10 bg-gradient-to-r from-judgment to-orange-500 rounded-lg flex items-center justify-center">
                                    <i class="fas fa-database text-white text-lg"></i>
                                </div>
                                <div>
                                    <h4 class="text-lg font-semibold text-gray-900">统一研判知识库</h4>
                                    <p class="text-sm text-gray-600">管理所有来源的研判规则，支持策略生效与反馈机制</p>
                                </div>
                            </div>
                            <div class="flex items-center space-x-2">
                                <button onclick="exportKnowledgeBase()" class="bg-gray-500 text-white px-4 py-2 rounded-lg hover:bg-gray-600 transition-colors">
                                    <i class="fas fa-download mr-2"></i>
                                    导出知识库
                                </button>
                                <button onclick="addCustomRule()" class="bg-gradient-to-r from-judgment to-orange-500 text-white px-4 py-2 rounded-lg hover:from-yellow-600 hover:to-orange-600 transition-all">
                                    <i class="fas fa-plus mr-2"></i>
                                    新增规则
                                </button>
                            </div>
                        </div>
                    </div>
                    <div class="p-6">
                        <div class="space-y-4" id="custom-rules-list">
                            <!-- AI智能规则列表 -->
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- 处置习惯学习 -->
        <div id="disposal-tab" class="tab-content hidden">
            <div class="max-w-7xl mx-auto">
                <!-- 页面说明 -->
                <div class="bg-gradient-to-r from-blue-50 to-purple-50 rounded-lg shadow-sm border border-blue-200 p-6 mb-6">
                    <div class="flex items-center justify-between">
                        <div class="flex items-center space-x-3">
                            <div class="w-10 h-10 bg-gradient-to-r from-blue-500 to-purple-500 rounded-lg flex items-center justify-center">
                                <i class="fas fa-tasks text-white text-lg"></i>
                            </div>
                            <div>
                                <h3 class="text-lg font-semibold text-gray-900">处置知识学习</h3>
                                <p class="text-sm text-gray-600">AI自动学习和识别业务流，智能提升安全策略精确度</p>
                            </div>
                        </div>
                        <div class="flex items-center space-x-4">
                            <div class="text-sm text-gray-500">
                                <i class="fas fa-network-wired mr-1"></i>
                                已学习业务流: <span class="font-bold text-ai">47</span>
                            </div>
                            <div class="text-sm text-gray-500">
                                <i class="fas fa-clock mr-1"></i>
                                今日新增: <span class="font-bold text-learning">8</span>
                            </div>
                            <div class="text-sm text-gray-500">
                                <i class="fas fa-brain mr-1"></i>
                                平均置信度: <span class="font-bold text-success">94%</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 业务流知识管理 -->
                <div class="space-y-6">
                    <!-- 搜索和筛选区域 -->
                    <div class="bg-white rounded-lg shadow-sm border p-6">
                        <div class="flex items-center justify-between mb-4">
                            <h4 class="text-lg font-semibold text-gray-900">业务流知识列表</h4>
                            <div class="flex items-center space-x-3">
                                <select id="status-filter" class="px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-ai text-sm">
                                    <option value="">全部状态</option>
                                    <option value="待确认">待确认</option>
                                    <option value="已确认">已确认</option>
                                    <option value="AI确认">AI确认</option>
                                    <option value="已忽略">已忽略</option>
                                </select>
                                <select id="confidence-filter" class="px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-ai text-sm">
                                    <option value="">全部置信度</option>
                                    <option value="high">高置信度 (90%+)</option>
                                    <option value="medium">中等置信度 (70-90%)</option>
                                    <option value="low">低置信度 (<70%)</option>
                                </select>
                            </div>
                        </div>
                        <input type="text" id="business-flow-search" placeholder="搜索业务流名称、源/目的实体、协议或研判理由..." 
                               class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-ai focus:border-transparent">
                    </div>

                    <!-- 业务流知识表格 -->
                    <div class="bg-white rounded-lg shadow-sm border overflow-hidden">
                        <div class="overflow-x-auto">
                            <table class="w-full">
                                <thead class="bg-gray-50">
                                    <tr>
                                        <th class="px-6 py-4 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">业务流名称</th>
                                        <th class="px-6 py-4 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">源/目的实体</th>
                                        <th class="px-6 py-4 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">协议/端口</th>
                                        <th class="px-6 py-4 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">研判理由</th>
                                        <th class="px-6 py-4 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">置信度</th>
                                        <th class="px-6 py-4 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">确认状态</th>
                                        <th class="px-6 py-4 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">操作</th>
                                    </tr>
                                </thead>
                                <tbody class="bg-white divide-y divide-gray-200" id="business-flow-list">
                                    <!-- 示例业务流数据 -->
                                    <tr class="hover:bg-gray-50 transition-colors">
                                        <td class="px-6 py-4 whitespace-nowrap">
                                            <div class="text-sm font-medium text-gray-900 editable-name" data-id="1">办公网访问CRM系统</div>
                                        </td>
                                        <td class="px-6 py-4 whitespace-nowrap">
                                            <div class="text-sm text-gray-600">
                                                <div>办公网IP段: 10.10.0.0/16</div>
                                                <div class="text-gray-400">↓</div>
                                                <div>CRM服务器集群: 192.168.100.0/24</div>
                                            </div>
                                        </td>
                                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-600">
                                            HTTP/HTTPS<br>
                                            <span class="text-gray-400">80, 443</span>
                                        </td>
                                        <td class="px-6 py-4 text-sm text-gray-600">
                                            <div class="max-w-xs">
                                                <div class="text-gray-800 font-medium mb-1">高频访问模式识别</div>
                                                <div class="text-xs text-gray-500">工作时间内规律性访问，符合办公场景特征</div>
                                            </div>
                                        </td>
                                        <td class="px-6 py-4 whitespace-nowrap">
                                            <div class="flex items-center">
                                                <div class="w-16 bg-gray-200 rounded-full h-2 mr-2">
                                                    <div class="bg-green-500 h-2 rounded-full" style="width: 98%"></div>
                                                </div>
                                                <span class="text-sm font-medium text-green-600">98%</span>
                                            </div>
                                        </td>
                                        <td class="px-6 py-4 whitespace-nowrap">
                                            <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-yellow-100 text-yellow-800">
                                                待确认
                                            </span>
                                        </td>
                                        <td class="px-6 py-4 whitespace-nowrap text-sm font-medium space-x-2">
                                            <button onclick="confirmBusinessFlow(1)" class="text-green-600 hover:text-green-900 transition-colors">
                                                <i class="fas fa-check mr-1"></i>确认
                                            </button>
                                            <button onclick="editBusinessFlow(1)" class="text-blue-600 hover:text-blue-900 transition-colors">
                                                <i class="fas fa-edit mr-1"></i>编辑
                                            </button>
                                            <button onclick="ignoreBusinessFlow(1)" class="text-gray-600 hover:text-gray-900 transition-colors">
                                                <i class="fas fa-times mr-1"></i>忽略
                                            </button>
                                        </td>
                                    </tr>
                                    
                                    <tr class="hover:bg-gray-50 transition-colors">
                                        <td class="px-6 py-4 whitespace-nowrap">
                                            <div class="text-sm font-medium text-gray-900 editable-name" data-id="2">数据库备份流量</div>
                                        </td>
                                        <td class="px-6 py-4 whitespace-nowrap">
                                            <div class="text-sm text-gray-600">
                                                <div>数据库服务器: 192.168.10.5</div>
                                                <div class="text-gray-400">↓</div>
                                                <div>备份存储: 172.16.5.0/24</div>
                                            </div>
                                        </td>
                                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-600">
                                            TCP<br>
                                            <span class="text-gray-400">3306, 22</span>
                                        </td>
                                        <td class="px-6 py-4 text-sm text-gray-600">
                                            <div class="max-w-xs">
                                                <div class="text-gray-800 font-medium mb-1">定时备份流量</div>
                                                <div class="text-xs text-gray-500">夜间定时执行，数据量大且规律，符合备份特征</div>
                                            </div>
                                        </td>
                                        <td class="px-6 py-4 whitespace-nowrap">
                                            <div class="flex items-center">
                                                <div class="w-16 bg-gray-200 rounded-full h-2 mr-2">
                                                    <div class="bg-green-500 h-2 rounded-full" style="width: 95%"></div>
                                                </div>
                                                <span class="text-sm font-medium text-green-600">95%</span>
                                            </div>
                                        </td>
                                        <td class="px-6 py-4 whitespace-nowrap">
                                            <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-green-100 text-green-800">
                                                已确认
                                            </span>
                                        </td>
                                        <td class="px-6 py-4 whitespace-nowrap text-sm font-medium space-x-2">
                                            <button onclick="editBusinessFlow(2)" class="text-blue-600 hover:text-blue-900 transition-colors">
                                                <i class="fas fa-edit mr-1"></i>编辑
                                            </button>
                                            <button onclick="ignoreBusinessFlow(2)" class="text-gray-600 hover:text-gray-900 transition-colors">
                                                <i class="fas fa-times mr-1"></i>忽略
                                            </button>
                                        </td>
                                    </tr>

                                    <tr class="hover:bg-gray-50 transition-colors">
                                        <td class="px-6 py-4 whitespace-nowrap">
                                            <div class="text-sm font-medium text-gray-900 editable-name" data-id="3">监控系统数据采集</div>
                                        </td>
                                        <td class="px-6 py-4 whitespace-nowrap">
                                            <div class="text-sm text-gray-600">
                                                <div>各业务服务器: 多个网段</div>
                                                <div class="text-gray-400">↓</div>
                                                <div>监控中心: 192.168.200.10</div>
                                            </div>
                                        </td>
                                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-600">
                                            SNMP/HTTP<br>
                                            <span class="text-gray-400">161, 8080</span>
                                        </td>
                                        <td class="px-6 py-4 text-sm text-gray-600">
                                            <div class="max-w-xs">
                                                <div class="text-gray-800 font-medium mb-1">监控数据采集</div>
                                                <div class="text-xs text-gray-500">多源设备向监控中心报告状态，数据量适中且持续</div>
                                            </div>
                                        </td>
                                        <td class="px-6 py-4 whitespace-nowrap">
                                            <div class="flex items-center">
                                                <div class="w-16 bg-gray-200 rounded-full h-2 mr-2">
                                                    <div class="bg-yellow-500 h-2 rounded-full" style="width: 87%"></div>
                                                </div>
                                                <span class="text-sm font-medium text-yellow-600">87%</span>
                                            </div>
                                        </td>
                                        <td class="px-6 py-4 whitespace-nowrap">
                                            <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-blue-100 text-blue-800">
                                                <i class="fas fa-robot mr-1"></i>AI确认
                                            </span>
                                        </td>
                                        <td class="px-6 py-4 whitespace-nowrap text-sm font-medium space-x-2">
                                            <button onclick="confirmBusinessFlow(3)" class="text-green-600 hover:text-green-900 transition-colors">
                                                <i class="fas fa-check mr-1"></i>确认
                                            </button>
                                            <button onclick="editBusinessFlow(3)" class="text-blue-600 hover:text-blue-900 transition-colors">
                                                <i class="fas fa-edit mr-1"></i>编辑
                                            </button>
                                            <button onclick="ignoreBusinessFlow(3)" class="text-gray-600 hover:text-gray-900 transition-colors">
                                                <i class="fas fa-times mr-1"></i>忽略
                                            </button>
                                        </td>
                                    </tr>

                                    <tr class="hover:bg-gray-50 transition-colors">
                                        <td class="px-6 py-4 whitespace-nowrap">
                                            <div class="text-sm font-medium text-gray-900 editable-name" data-id="4">Web服务负载均衡</div>
                                        </td>
                                        <td class="px-6 py-4 whitespace-nowrap">
                                            <div class="text-sm text-gray-600">
                                                <div>负载均衡器: 192.168.1.100</div>
                                                <div class="text-gray-400">↓</div>
                                                <div>Web服务器池: 192.168.1.101-105</div>
                                            </div>
                                        </td>
                                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-600">
                                            HTTP/HTTPS<br>
                                            <span class="text-gray-400">80, 443, 8080</span>
                                        </td>
                                        <td class="px-6 py-4 text-sm text-gray-600">
                                            <div class="max-w-xs">
                                                <div class="text-gray-800 font-medium mb-1">负载均衡流量</div>
                                                <div class="text-xs text-gray-500">流量分布不均，可能存在异常访问模式</div>
                                            </div>
                                        </td>
                                        <td class="px-6 py-4 whitespace-nowrap">
                                            <div class="flex items-center">
                                                <div class="w-16 bg-gray-200 rounded-full h-2 mr-2">
                                                    <div class="bg-red-500 h-2 rounded-full" style="width: 65%"></div>
                                                </div>
                                                <span class="text-sm font-medium text-red-600">65%</span>
                                            </div>
                                        </td>
                                        <td class="px-6 py-4 whitespace-nowrap">
                                            <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-blue-100 text-blue-800">
                                                <i class="fas fa-robot mr-1"></i>AI确认
                                            </span>
                                        </td>
                                        <td class="px-6 py-4 whitespace-nowrap text-sm font-medium space-x-2">
                                            <button onclick="confirmBusinessFlow(4)" class="text-green-600 hover:text-green-900 transition-colors">
                                                <i class="fas fa-check mr-1"></i>确认
                                            </button>
                                            <button onclick="editBusinessFlow(4)" class="text-blue-600 hover:text-blue-900 transition-colors">
                                                <i class="fas fa-edit mr-1"></i>编辑
                                            </button>
                                            <button onclick="ignoreBusinessFlow(4)" class="text-gray-600 hover:text-gray-900 transition-colors">
                                                <i class="fas fa-times mr-1"></i>忽略
                                            </button>
                                        </td>
                                    </tr>

                                    <tr class="hover:bg-gray-50 transition-colors">
                                        <td class="px-6 py-4 whitespace-nowrap">
                                            <div class="text-sm font-medium text-gray-900 editable-name" data-id="5">外部API调用</div>
                                        </td>
                                        <td class="px-6 py-4 whitespace-nowrap">
                                            <div class="text-sm text-gray-600">
                                                <div>应用服务器: 192.168.50.20</div>
                                                <div class="text-gray-400">↓</div>
                                                <div>第三方API: 外部互联网</div>
                                            </div>
                                        </td>
                                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-600">
                                            HTTPS<br>
                                            <span class="text-gray-400">443</span>
                                        </td>
                                        <td class="px-6 py-4 text-sm text-gray-600">
                                            <div class="max-w-xs">
                                                <div class="text-gray-800 font-medium mb-1">外部API调用</div>
                                                <div class="text-xs text-gray-500">固定时间调用第三方服务，频率可控且安全</div>
                                            </div>
                                        </td>
                                        <td class="px-6 py-4 whitespace-nowrap">
                                            <div class="flex items-center">
                                                <div class="w-16 bg-gray-200 rounded-full h-2 mr-2">
                                                    <div class="bg-green-500 h-2 rounded-full" style="width: 92%"></div>
                                                </div>
                                                <span class="text-sm font-medium text-green-600">92%</span>
                                            </div>
                                        </td>
                                        <td class="px-6 py-4 whitespace-nowrap">
                                            <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-gray-100 text-gray-800">
                                                已忽略
                                            </span>
                                        </td>
                                        <td class="px-6 py-4 whitespace-nowrap text-sm font-medium space-x-2">
                                            <button onclick="confirmBusinessFlow(5)" class="text-green-600 hover:text-green-900 transition-colors">
                                                <i class="fas fa-check mr-1"></i>确认
                                            </button>
                                            <button onclick="editBusinessFlow(5)" class="text-blue-600 hover:text-blue-900 transition-colors">
                                                <i class="fas fa-edit mr-1"></i>编辑
                                            </button>
                                        </td>
                                    </tr>

                                    <!-- 代理场景业务流 -->
                                    <tr class="hover:bg-gray-50 transition-colors">
                                        <td class="px-6 py-4 whitespace-nowrap">
                                            <div class="text-sm font-medium text-gray-900 editable-name" data-id="6">HTTP代理上网流量</div>
                                        </td>
                                        <td class="px-6 py-4 whitespace-nowrap">
                                            <div class="text-sm text-gray-600">
                                                <div>员工终端: 10.10.0.0/16</div>
                                                <div class="text-gray-400">↓</div>
                                                <div>HTTP代理: 192.168.1.200</div>
                                            </div>
                                        </td>
                                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-600">
                                            HTTP/HTTPS<br>
                                            <span class="text-gray-400">8080, 3128</span>
                                        </td>
                                        <td class="px-6 py-4 text-sm text-gray-600">
                                            <div class="max-w-xs">
                                                <div class="text-gray-800 font-medium mb-1">代理上网流量</div>
                                                <div class="text-xs text-gray-500">员工通过代理服务器访问外网，流量集中且规律</div>
                                            </div>
                                        </td>
                                        <td class="px-6 py-4 whitespace-nowrap">
                                            <div class="flex items-center">
                                                <div class="w-16 bg-gray-200 rounded-full h-2 mr-2">
                                                    <div class="bg-green-500 h-2 rounded-full" style="width: 89%"></div>
                                                </div>
                                                <span class="text-sm font-medium text-green-600">89%</span>
                                            </div>
                                        </td>
                                        <td class="px-6 py-4 whitespace-nowrap">
                                            <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-green-100 text-green-800">
                                                已确认
                                            </span>
                                        </td>
                                        <td class="px-6 py-4 whitespace-nowrap text-sm font-medium space-x-2">
                                            <button onclick="editBusinessFlow(6)" class="text-blue-600 hover:text-blue-900 transition-colors">
                                                <i class="fas fa-edit mr-1"></i>编辑
                                            </button>
                                            <button onclick="ignoreBusinessFlow(6)" class="text-gray-600 hover:text-gray-900 transition-colors">
                                                <i class="fas fa-times mr-1"></i>忽略
                                            </button>
                                        </td>
                                    </tr>

                                    <tr class="hover:bg-gray-50 transition-colors">
                                        <td class="px-6 py-4 whitespace-nowrap">
                                            <div class="text-sm font-medium text-gray-900 editable-name" data-id="7">SOCKS代理连接</div>
                                        </td>
                                        <td class="px-6 py-4 whitespace-nowrap">
                                            <div class="text-sm text-gray-600">
                                                <div>开发环境: 172.16.0.0/16</div>
                                                <div class="text-gray-400">↓</div>
                                                <div>SOCKS代理: 192.168.2.100</div>
                                            </div>
                                        </td>
                                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-600">
                                            SOCKS5<br>
                                            <span class="text-gray-400">1080</span>
                                        </td>
                                        <td class="px-6 py-4 text-sm text-gray-600">
                                            <div class="max-w-xs">
                                                <div class="text-gray-800 font-medium mb-1">开发环境代理</div>
                                                <div class="text-xs text-gray-500">开发人员通过SOCKS代理访问外部资源</div>
                                            </div>
                                        </td>
                                        <td class="px-6 py-4 whitespace-nowrap">
                                            <div class="flex items-center">
                                                <div class="w-16 bg-gray-200 rounded-full h-2 mr-2">
                                                    <div class="bg-yellow-500 h-2 rounded-full" style="width: 76%"></div>
                                                </div>
                                                <span class="text-sm font-medium text-yellow-600">76%</span>
                                            </div>
                                        </td>
                                        <td class="px-6 py-4 whitespace-nowrap">
                                            <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-yellow-100 text-yellow-800">
                                                待确认
                                            </span>
                                        </td>
                                        <td class="px-6 py-4 whitespace-nowrap text-sm font-medium space-x-2">
                                            <button onclick="confirmBusinessFlow(7)" class="text-green-600 hover:text-green-900 transition-colors">
                                                <i class="fas fa-check mr-1"></i>确认
                                            </button>
                                            <button onclick="editBusinessFlow(7)" class="text-blue-600 hover:text-blue-900 transition-colors">
                                                <i class="fas fa-edit mr-1"></i>编辑
                                            </button>
                                            <button onclick="ignoreBusinessFlow(7)" class="text-gray-600 hover:text-gray-900 transition-colors">
                                                <i class="fas fa-times mr-1"></i>忽略
                                            </button>
                                        </td>
                                    </tr>

                                    <tr class="hover:bg-gray-50 transition-colors">
                                        <td class="px-6 py-4 whitespace-nowrap">
                                            <div class="text-sm font-medium text-gray-900 editable-name" data-id="8">反向代理流量</div>
                                        </td>
                                        <td class="px-6 py-4 whitespace-nowrap">
                                            <div class="text-sm text-gray-600">
                                                <div>外部用户: 互联网</div>
                                                <div class="text-gray-400">↓</div>
                                                <div>Nginx反向代理: 10.0.1.10</div>
                                            </div>
                                        </td>
                                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-600">
                                            HTTP/HTTPS<br>
                                            <span class="text-gray-400">80, 443</span>
                                        </td>
                                        <td class="px-6 py-4 text-sm text-gray-600">
                                            <div class="max-w-xs">
                                                <div class="text-gray-800 font-medium mb-1">反向代理服务</div>
                                                <div class="text-xs text-gray-500">外部请求通过反向代理转发到内部服务器</div>
                                            </div>
                                        </td>
                                        <td class="px-6 py-4 whitespace-nowrap">
                                            <div class="flex items-center">
                                                <div class="w-16 bg-gray-200 rounded-full h-2 mr-2">
                                                    <div class="bg-green-500 h-2 rounded-full" style="width: 94%"></div>
                                                </div>
                                                <span class="text-sm font-medium text-green-600">94%</span>
                                            </div>
                                        </td>
                                        <td class="px-6 py-4 whitespace-nowrap">
                                            <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-green-100 text-green-800">
                                                已确认
                                            </span>
                                        </td>
                                        <td class="px-6 py-4 whitespace-nowrap text-sm font-medium space-x-2">
                                            <button onclick="editBusinessFlow(8)" class="text-blue-600 hover:text-blue-900 transition-colors">
                                                <i class="fas fa-edit mr-1"></i>编辑
                                            </button>
                                            <button onclick="ignoreBusinessFlow(8)" class="text-gray-600 hover:text-gray-900 transition-colors">
                                                <i class="fas fa-times mr-1"></i>忽略
                                            </button>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>

            </div>
        </div>

        <!-- 价值可视化 -->
        <div id="analytics-tab" class="tab-content hidden">
            <!-- 页面说明 -->
            <div class="bg-gradient-to-r from-ai/10 to-learning/10 rounded-lg shadow-sm border border-ai/20 p-6 mb-6">
                <div class="flex items-center justify-between">
                    <div class="flex items-center space-x-3">
                        <div class="w-12 h-12 bg-gradient-to-r from-ai to-learning rounded-xl flex items-center justify-center">
                            <i class="fas fa-chart-line text-white text-xl"></i>
                        </div>
                        <div>
                            <h3 class="text-xl font-bold text-gray-900">价值可视化</h3>
                            <p class="text-sm text-gray-600">将学习和调优的过程与效果清晰地展示，证明系统的价值</p>
                        </div>
                    </div>
                    <div class="flex items-center space-x-4">
                        <div class="text-sm text-gray-500">
                            <i class="fas fa-trophy mr-1"></i>
                            综合价值评分: <span class="font-bold text-ai">A+</span>
                        </div>
                        <div class="text-sm text-gray-500">
                            <i class="fas fa-arrow-up mr-1"></i>
                            月度提升: <span class="font-bold text-success">+28%</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-6">
                <!-- 价值指标卡片 -->
                <div class="bg-white rounded-lg shadow-sm border card-hover p-6 cursor-pointer" onclick="showMetricDetail('accuracy')">
                    <div class="flex items-center">
                        <div class="w-12 h-12 bg-success/10 rounded-lg flex items-center justify-center">
                            <i class="fas fa-shield-alt text-success text-xl"></i>
                        </div>
                            </div>
                        </div>
                    </div>

                    <!-- 低危告警处置习惯 -->
                    <div class="bg-white rounded-lg shadow-sm border card-hover">
                        <div class="p-6 border-b border-gray-200">
                            <div class="flex items-center justify-between">
                                <div class="flex items-center space-x-3">
                                    <div class="w-10 h-10 bg-green-100 rounded-lg flex items-center justify-center">
                                        <i class="fas fa-info-circle text-green-600 text-lg"></i>
                                    </div>
                                    <div>
                                        <h3 class="text-lg font-semibold text-gray-900">低危告警处置习惯</h3>
                                        <p class="text-sm text-gray-600">AI分析客户对低危告警的处置策略</p>
                                    </div>
                                </div>
                                <div class="flex items-center space-x-2">
                                    <div class="w-2 h-2 bg-green-500 rounded-full animate-pulse"></div>
                                    <span class="text-xs text-green-600 font-medium">智能优化</span>
                                </div>
                            </div>
                        </div>
                        <div class="p-6">
                            <div class="space-y-4">
                                <!-- 处置习惯项 -->
                                <div class="bg-green-50 border border-green-200 rounded-lg p-4">
                                    <div class="flex items-start space-x-3">
                                        <div class="w-8 h-8 bg-green-600 text-white rounded-full flex items-center justify-center text-xs font-bold">1</div>
                                        <div class="flex-1">
                                            <h4 class="font-medium text-green-800 mb-1">内部工具访问 → 标记忽略</h4>
                                            <p class="text-sm text-green-700 mb-2">AI识别：用户习惯对内部工具的正常访问进行标记忽略</p>
                                            <div class="flex items-center space-x-4 text-xs text-green-600">
                                                <span><i class="fas fa-chart-line mr-1"></i>识别频率: 92%</span>
                                                <span><i class="fas fa-clock mr-1"></i>平均处理时间: 30秒</span>
                                                <span><i class="fas fa-check mr-1"></i>自动化程度: 85%</span>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <div class="bg-green-50 border border-green-200 rounded-lg p-4">
                                    <div class="flex items-start space-x-3">
                                        <div class="w-8 h-8 bg-green-600 text-white rounded-full flex items-center justify-center text-xs font-bold">2</div>
                                        <div class="flex-1">
                                            <h4 class="font-medium text-green-800 mb-1">已知误报 → 批量处理</h4>
                                            <p class="text-sm text-green-700 mb-2">AI识别：用户习惯对已知误报进行批量处理，提高效率</p>
                                            <div class="flex items-center space-x-4 text-xs text-green-600">
                                                <span><i class="fas fa-chart-line mr-1"></i>识别频率: 78%</span>
                                                <span><i class="fas fa-clock mr-1"></i>平均处理时间: 2分钟</span>
                                                <span><i class="fas fa-layer-group mr-1"></i>批量处理率: 90%</span>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <div class="bg-green-50 border border-green-200 rounded-lg p-4">
                                    <div class="flex items-start space-x-3">
                                        <div class="w-8 h-8 bg-green-600 text-white rounded-full flex items-center justify-center text-xs font-bold">3</div>
                                        <div class="flex-1">
                                            <h4 class="font-medium text-green-800 mb-1">健康检查告警 → 自动过滤</h4>
                                            <p class="text-sm text-green-700 mb-2">AI识别：用户习惯对健康检查相关告警进行自动过滤</p>
                                            <div class="flex items-center space-x-4 text-xs text-green-600">
                                                <span><i class="fas fa-chart-line mr-1"></i>识别频率: 95%</span>
                                                <span><i class="fas fa-clock mr-1"></i>平均处理时间: 5秒</span>
                                                <span><i class="fas fa-filter mr-1"></i>过滤准确率: 98%</span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- 业务相关处置习惯 -->
                    <div class="bg-white rounded-lg shadow-sm border card-hover">
                        <div class="p-6 border-b border-gray-200">
                            <div class="flex items-center justify-between">
                                <div class="flex items-center space-x-3">
                                    <div class="w-10 h-10 bg-blue-100 rounded-lg flex items-center justify-center">
                                        <i class="fas fa-building text-blue-600 text-lg"></i>
                                    </div>
                                    <div>
                                        <h3 class="text-lg font-semibold text-gray-900">业务相关处置习惯</h3>
                                        <p class="text-sm text-gray-600">AI分析客户对业务相关安全事件的处置偏好</p>
                                    </div>
                                </div>
                                <div class="flex items-center space-x-2">
                                    <div class="w-2 h-2 bg-blue-500 rounded-full animate-pulse"></div>
                                    <span class="text-xs text-blue-600 font-medium">业务优化</span>
                                </div>
                            </div>
                        </div>
                        <div class="p-6">
                            <div class="space-y-4">
                                <!-- 处置习惯项 -->
                                <div class="bg-blue-50 border border-blue-200 rounded-lg p-4">
                                    <div class="flex items-start space-x-3">
                                        <div class="w-8 h-8 bg-blue-600 text-white rounded-full flex items-center justify-center text-xs font-bold">1</div>
                                        <div class="flex-1">
                                            <h4 class="font-medium text-blue-800 mb-1">业务时间攻击 → 优先处理</h4>
                                            <p class="text-sm text-blue-700 mb-2">AI识别：用户习惯对业务时间内发生的攻击进行优先处理</p>
                                            <div class="flex items-center space-x-4 text-xs text-blue-600">
                                                <span><i class="fas fa-chart-line mr-1"></i>识别频率: 88%</span>
                                                <span><i class="fas fa-clock mr-1"></i>平均响应时间: 1分钟</span>
                                                <span><i class="fas fa-star mr-1"></i>优先级提升: 高</span>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <div class="bg-blue-50 border border-blue-200 rounded-lg p-4">
                                    <div class="flex items-start space-x-3">
                                        <div class="w-8 h-8 bg-blue-600 text-white rounded-full flex items-center justify-center text-xs font-bold">2</div>
                                        <div class="flex-1">
                                            <h4 class="font-medium text-blue-800 mb-1">核心资产告警 → 立即通知</h4>
                                            <p class="text-sm text-blue-700 mb-2">AI识别：用户习惯对核心业务资产的告警进行立即通知</p>
                                            <div class="flex items-center space-x-4 text-xs text-blue-600">
                                                <span><i class="fas fa-chart-line mr-1"></i>识别频率: 91%</span>
                                                <span><i class="fas fa-clock mr-1"></i>平均通知时间: 30秒</span>
                                                <span><i class="fas fa-phone mr-1"></i>通知覆盖率: 100%</span>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <div class="bg-blue-50 border border-blue-200 rounded-lg p-4">
                                    <div class="flex items-start space-x-3">
                                        <div class="w-8 h-8 bg-blue-600 text-white rounded-full flex items-center justify-center text-xs font-bold">3</div>
                                        <div class="flex-1">
                                            <h4 class="font-medium text-blue-800 mb-1">数据泄露风险 → 联系业务方</h4>
                                            <p class="text-sm text-blue-700 mb-2">AI识别：用户习惯对数据泄露风险事件联系相关业务方确认</p>
                                            <div class="flex items-center space-x-4 text-xs text-blue-600">
                                                <span><i class="fas fa-chart-line mr-1"></i>识别频率: 72%</span>
                                                <span><i class="fas fa-clock mr-1"></i>平均联系时间: 5分钟</span>
                                                <span><i class="fas fa-users mr-1"></i>业务方响应率: 87%</span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

            </div>
        </div>

        <!-- AI互动调优演示 -->
        <div id="context-tab" class="tab-content">
            <div class="max-w-7xl mx-auto">
                <!-- 页面说明 -->
                <div class="bg-gradient-to-r from-judgment/10 to-orange-50 rounded-lg shadow-sm border border-judgment/20 p-6 mb-6">
                    <div class="flex items-center justify-between">
                        <div class="flex items-center space-x-3">
                            <div class="w-12 h-12 bg-gradient-to-r from-judgment to-orange-500 rounded-xl flex items-center justify-center">
                                <i class="fas fa-brain text-white text-xl"></i>
                            </div>
                            <div>
                                <h3 class="text-xl font-bold text-gray-900">研判智能学习</h3>
                                <p class="text-sm text-gray-600">基于用户反馈的监督学习，形成"人工反馈 → AI学习 → 策略优化"的良性闭环</p>
                            </div>
                        </div>
                        <div class="flex items-center space-x-4">
                            <div class="text-sm text-gray-500">
                                <i class="fas fa-thumbs-up mr-1"></i>
                                标注准确率: <span class="font-bold text-judgment">94%</span>
                            </div>
                            <div class="text-sm text-gray-500">
                                <i class="fas fa-robot mr-1"></i>
                                AI推荐采纳率: <span class="font-bold text-orange-600">87%</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 功能模块网格 -->
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                    <!-- 用户反馈学习 -->
                    <div class="bg-white rounded-lg shadow-sm border card-hover">
                        <div class="p-6 border-b border-gray-200">
                            <div class="flex items-center justify-between">
                                <div class="flex items-center space-x-3">
                                    <div class="w-10 h-10 bg-green-100 rounded-lg flex items-center justify-center">
                                        <i class="fas fa-thumbs-up text-green-600 text-lg"></i>
                                    </div>
                                    <div>
                                        <h4 class="text-lg font-semibold text-gray-900">用户反馈学习</h4>
                                        <p class="text-sm text-gray-600">客户打标系统，AI实时学习用户判断</p>
                                    </div>
                                </div>
                                <div class="flex items-center space-x-2">
                                    <div class="w-2 h-2 bg-green-500 rounded-full animate-pulse"></div>
                                    <span class="text-xs text-green-600 font-medium">实时学习</span>
                                </div>
                            </div>
                        </div>
                        <div class="p-6">
                            <div class="space-y-4">
                                <!-- 打标演示 -->
                                <div class="bg-gray-50 rounded-lg p-4">
                                    <h5 class="font-medium text-gray-800 mb-3">模拟告警打标演示</h5>
                                    <div class="bg-white border-2 border-dashed border-gray-300 rounded-lg p-4">
                                        <div class="flex items-center justify-between mb-2">
                                            <div class="text-sm font-medium text-gray-800">SQL注入攻击尝试</div>
                                            <div class="text-xs text-gray-500">2024-01-15 14:30</div>
                                        </div>
                                        <div class="text-sm text-gray-600 mb-3">来源: 192.168.1.100 → 目标: 10.10.10.10</div>
                                        <div class="flex items-center space-x-2">
                                            <button onclick="labelAlert('positive')" class="flex items-center space-x-2 bg-green-500 text-white px-3 py-1 rounded-full text-sm hover:bg-green-600 transition-colors">
                                                <i class="fas fa-check"></i>
                                                <span>✅正报</span>
                                            </button>
                                            <button onclick="labelAlert('negative')" class="flex items-center space-x-2 bg-red-500 text-white px-3 py-1 rounded-full text-sm hover:bg-red-600 transition-colors">
                                                <i class="fas fa-times"></i>
                                                <span>❌误报</span>
                                            </button>
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- 学习统计 -->
                                <div class="bg-green-50 border border-green-200 rounded-lg p-4">
                                    <h5 class="font-medium text-green-800 mb-3">本周学习统计</h5>
                                    <div class="grid grid-cols-2 gap-3 text-sm">
                                        <div class="text-center">
                                            <div class="text-2xl font-bold text-green-600">156</div>
                                            <div class="text-green-700">用户标注</div>
                                        </div>
                                        <div class="text-center">
                                            <div class="text-2xl font-bold text-blue-600">23</div>
                                            <div class="text-blue-700">AI纠错</div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- 现场交互式调优 -->
                    <div class="bg-white rounded-lg shadow-sm border card-hover">
                        <div class="p-6 border-b border-gray-200">
                            <div class="flex items-center justify-between">
                                <div class="flex items-center space-x-3">
                                    <div class="w-10 h-10 bg-purple-100 rounded-lg flex items-center justify-center">
                                        <i class="fas fa-edit text-purple-600 text-lg"></i>
                                    </div>
                                    <div>
                                        <h4 class="text-lg font-semibold text-gray-900">现场交互式调优</h4>
                                        <p class="text-sm text-gray-600">划词调优，复合条件，全程审计</p>
                                    </div>
                                </div>
                                <div class="flex items-center space-x-2">
                                    <div class="w-2 h-2 bg-purple-500 rounded-full animate-pulse"></div>
                                    <span class="text-xs text-purple-600 font-medium">实时调优</span>
                                </div>
                            </div>
                        </div>
                        <div class="p-6">
                            <div class="space-y-4">
                                <!-- 调优演示 -->
                                <div class="bg-gray-50 rounded-lg p-4">
                                    <h5 class="font-medium text-gray-800 mb-3">Payload调优演示</h5>
                                    <div class="bg-white border-2 border-dashed border-gray-300 rounded-lg p-4 font-mono text-sm">
                                        <div class="text-xs text-gray-500 mb-2">划选特定字段创建调优规则</div>
                                        <div class="selectable-text cursor-text">
                                            GET /api/user?id=<span class="bg-yellow-200 px-1 rounded border border-yellow-400 font-semibold">1' OR '1'='1</span> HTTP/1.1<br>
                                            Host: target.com<br>
                                            User-Agent: <span class="bg-yellow-200 px-1 rounded border border-yellow-400 font-semibold">sqlmap/1.0</span>
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- 调优记录 -->
                                <div class="bg-purple-50 border border-purple-200 rounded-lg p-4">
                                    <h5 class="font-medium text-purple-800 mb-3">最近调优记录</h5>
                                    <div class="space-y-2 text-sm">
                                        <div class="flex items-center space-x-2">
                                            <div class="w-4 h-4 bg-purple-600 rounded-full flex items-center justify-center">
                                                <i class="fas fa-check text-white text-xs"></i>
                                            </div>
                                            <span class="text-purple-700">条件: User-Agent包含"sqlmap" AND Payload包含"OR"</span>
                                        </div>
                                        <div class="flex items-center space-x-2">
                                            <div class="w-4 h-4 bg-green-600 rounded-full flex items-center justify-center">
                                                <i class="fas fa-check text-white text-xs"></i>
                                            </div>
                                            <span class="text-green-700">操作: 设置为高风险威胁</span>
                                        </div>
                                        <div class="text-xs text-gray-500">
                                            操作人: 张安全 | 时间: 2024-01-15 14:25
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- 价值可视化 -->
        <div id="analytics-tab" class="tab-content hidden">
            <!-- 页面说明 -->
            <div class="bg-gradient-to-r from-ai/10 to-learning/10 rounded-lg shadow-sm border border-ai/20 p-6 mb-6">
                <div class="flex items-center justify-between">
                    <div class="flex items-center space-x-3">
                        <div class="w-12 h-12 bg-gradient-to-r from-ai to-learning rounded-xl flex items-center justify-center">
                            <i class="fas fa-chart-line text-white text-xl"></i>
                        </div>
                        <div>
                            <h3 class="text-xl font-bold text-gray-900">价值可视化</h3>
                            <p class="text-sm text-gray-600">将学习和调优的过程与效果清晰地展示，证明系统的价值</p>
                        </div>
                    </div>
                    <div class="flex items-center space-x-4">
                        <div class="text-sm text-gray-500">
                            <i class="fas fa-trophy mr-1"></i>
                            综合价值评分: <span class="font-bold text-ai">A+</span>
                        </div>
                        <div class="text-sm text-gray-500">
                            <i class="fas fa-arrow-up mr-1"></i>
                            月度提升: <span class="font-bold text-success">+28%</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-6">
                <!-- 价值指标卡片 -->
                <div class="bg-white rounded-lg shadow-sm border card-hover p-6 cursor-pointer" onclick="showMetricDetail('accuracy')">
                    <div class="flex items-center">
                        <div class="w-12 h-12 bg-success/10 rounded-lg flex items-center justify-center">
                            <i class="fas fa-shield-alt text-success text-xl"></i>
                        </div>
                        <div class="ml-4">
                            <h4 class="text-2xl font-bold text-gray-900">92%</h4>
                            <p class="text-sm text-gray-600">告警精准度</p>
                            <p class="text-xs text-success mt-1">↑ 比上月提升15%</p>
                        </div>
                    </div>
                    <div class="mt-3 text-xs text-gray-500">
                        <i class="fas fa-info-circle mr-1"></i>
                        点击查看计算说明
                    </div>
                </div>
                <div class="bg-white rounded-lg shadow-sm border card-hover p-6 cursor-pointer" onclick="showMetricDetail('automation')">
                    <div class="flex items-center">
                        <div class="w-12 h-12 bg-ai/10 rounded-lg flex items-center justify-center">
                            <i class="fas fa-robot text-ai text-xl"></i>
                        </div>
                        <div class="ml-4">
                            <h4 class="text-2xl font-bold text-gray-900">85%</h4>
                            <p class="text-sm text-gray-600">自动化处理率</p>
                            <p class="text-xs text-ai mt-1">↑ 比上月提升12%</p>
                        </div>
                    </div>
                    <div class="mt-3 text-xs text-gray-500">
                        <i class="fas fa-info-circle mr-1"></i>
                        点击查看计算说明
                    </div>
                </div>
                <div class="bg-white rounded-lg shadow-sm border card-hover p-6 cursor-pointer" onclick="showMetricDetail('response')">
                    <div class="flex items-center">
                        <div class="w-12 h-12 bg-warning/10 rounded-lg flex items-center justify-center">
                            <i class="fas fa-clock text-warning text-xl"></i>
                        </div>
                        <div class="ml-4">
                            <h4 class="text-2xl font-bold text-gray-900">3.2分钟</h4>
                            <p class="text-sm text-gray-600">平均响应时间</p>
                            <p class="text-xs text-warning mt-1">↓ 比上月减少40%</p>
                        </div>
                    </div>
                    <div class="mt-3 text-xs text-gray-500">
                        <i class="fas fa-info-circle mr-1"></i>
                        点击查看计算说明
                    </div>
                </div>
                <div class="bg-white rounded-lg shadow-sm border card-hover p-6 cursor-pointer" onclick="showMetricDetail('false_positive')">
                    <div class="flex items-center">
                        <div class="w-12 h-12 bg-gradient-to-r from-blue-100 to-cyan-100 rounded-lg flex items-center justify-center">
                            <i class="fas fa-filter text-blue-600 text-xl"></i>
                        </div>
                        <div class="ml-4">
                            <h4 class="text-2xl font-bold text-blue-600">8%</h4>
                            <p class="text-sm text-gray-600">误报率</p>
                            <p class="text-xs text-blue-500 mt-1">↓ 比上月减少58%</p>
                        </div>
                    </div>
                    <div class="mt-3 text-xs text-gray-500">
                        <i class="fas fa-info-circle mr-1"></i>
                        点击查看计算说明
                    </div>
                </div>
            </div>

            <!-- 学习效果展示 -->
            <div class="bg-gradient-to-r from-blue-50 to-purple-50 rounded-lg shadow-sm border border-blue-200 p-6 mb-6">
                <div class="flex items-center justify-between mb-4">
                    <div class="flex items-center space-x-3">
                        <div class="w-10 h-10 bg-gradient-to-r from-blue-500 to-purple-500 rounded-lg flex items-center justify-center">
                            <i class="fas fa-brain text-white text-lg"></i>
                        </div>
                        <div>
                            <h3 class="text-lg font-semibold text-gray-900">AI学习效果</h3>
                            <p class="text-sm text-gray-600">智能学习系统的实时表现和优化成果</p>
                        </div>
                    </div>
                    <div class="flex items-center space-x-2">
                        <div class="w-2 h-2 bg-green-500 rounded-full animate-pulse"></div>
                        <span class="text-xs text-green-600 font-medium">实时学习中</span>
                    </div>
                </div>
                
                <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                    <div class="bg-white rounded-lg p-4 border border-blue-100 cursor-pointer hover:shadow-md transition-shadow" onclick="showLearningDetail('user_feedback')">
                        <div class="flex items-center space-x-3">
                            <div class="w-8 h-8 bg-blue-100 rounded-full flex items-center justify-center">
                                <i class="fas fa-thumbs-up text-blue-500 text-sm"></i>
                            </div>
                            <div>
                                <div class="text-sm font-medium text-gray-800">用户反馈学习</div>
                                <div class="text-xs text-gray-500">最近30天</div>
                            </div>
                        </div>
                        <div class="mt-3">
                            <div class="text-2xl font-bold text-blue-500">2,348条</div>
                            <div class="text-xs text-gray-600">标注数据，AI学习正报率94%</div>
                        </div>
                    </div>
                    
                    <div class="bg-white rounded-lg p-4 border border-green-100 cursor-pointer hover:shadow-md transition-shadow" onclick="showLearningDetail('rule_optimization')">
                        <div class="flex items-center space-x-3">
                            <div class="w-8 h-8 bg-green-100 rounded-full flex items-center justify-center">
                                <i class="fas fa-cogs text-green-500 text-sm"></i>
                            </div>
                            <div>
                                <div class="text-sm font-medium text-gray-800">规则自动优化</div>
                                <div class="text-xs text-gray-500">本周统计</div>
                            </div>
                        </div>
                        <div class="mt-3">
                            <div class="text-2xl font-bold text-green-500">156次</div>
                            <div class="text-xs text-gray-600">规则调优，检测效率提升23%</div>
                        </div>
                    </div>
                    
                    <div class="bg-white rounded-lg p-4 border border-purple-100 cursor-pointer hover:shadow-md transition-shadow" onclick="showLearningDetail('knowledge_base')">
                        <div class="flex items-center space-x-3">
                            <div class="w-8 h-8 bg-purple-100 rounded-full flex items-center justify-center">
                                <i class="fas fa-database text-purple-500 text-sm"></i>
                            </div>
                            <div>
                                <div class="text-sm font-medium text-gray-800">知识库增长</div>
                                <div class="text-xs text-gray-500">累计学习</div>
                            </div>
                        </div>
                        <div class="mt-3">
                            <div class="text-2xl font-bold text-purple-500">4,567项</div>
                            <div class="text-xs text-gray-600">环境特征，覆盖率98%</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- 价值提升趋势 -->
            <div class="bg-white rounded-lg shadow-sm border card-hover">
                <div class="p-6 border-b border-gray-200">
                    <h3 class="text-lg font-semibold text-gray-900">
                        <i class="fas fa-chart-area text-ai mr-2"></i>
                        价值提升趋势
                    </h3>
                    <p class="text-sm text-gray-600 mt-1">安全GPT智能学习带来的价值提升可视化</p>
                </div>
                <div class="p-6">
                    <div class="h-64 flex items-center justify-center border-2 border-dashed border-gray-300 rounded-lg bg-gradient-to-br from-ai/5 to-learning/5">
                        <div class="text-center">
                            <i class="fas fa-chart-line text-ai text-4xl mb-4"></i>
                            <p class="text-gray-700 font-medium">价值提升趋势图表区域</p>
                            <p class="text-sm text-gray-500">展示告警精准度、自动化程度、成本节省等关键指标的提升趋势</p>
                            <div class="mt-4 grid grid-cols-3 gap-4 text-sm">
                                <div class="bg-white rounded-lg p-3 border">
                                    <div class="text-success font-bold">+28%</div>
                                    <div class="text-gray-600">月度提升</div>
                                </div>
                                <div class="bg-white rounded-lg p-3 border">
                                    <div class="text-ai font-bold">95%</div>
                                    <div class="text-gray-600">客户满意度</div>
                                </div>
                                <div class="bg-white rounded-lg p-3 border">
                                    <div class="text-warning font-bold">ROI 3.2x</div>
                                    <div class="text-gray-600">投资回报率</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- 浮动工具条（用于文本选择后显示） -->
    <div id="floating-toolbar" class="fixed hidden floating-toolbar text-white px-4 py-2 rounded-lg" style="z-index: 9999;">
        <div class="flex items-center space-x-2">
            <div class="text-xs opacity-75 mr-2">选中: "<span id="selected-text-preview"></span>"</div>
            <button class="hover:bg-white/20 px-3 py-1 rounded text-sm font-medium transition-colors" onclick="markAsGood()">
                <i class="fas fa-check mr-1"></i>标记为良性
            </button>
            <button class="hover:bg-white/20 px-3 py-1 rounded text-sm font-medium transition-colors" onclick="markAsThreat()">
                <i class="fas fa-exclamation-triangle mr-1"></i>定义为威胁
            </button>
            <button class="hover:bg-white/20 px-3 py-1 rounded text-sm font-medium transition-colors" onclick="globalSearch()">
                <i class="fas fa-search mr-1"></i>全局搜索
            </button>
        </div>
    </div>

    <!-- 学习弹窗模态框 -->
    <div id="learning-modal" class="fixed inset-0 bg-black bg-opacity-50 hidden flex items-center justify-center z-50">
        <div class="bg-white rounded-lg shadow-xl max-w-md w-full mx-4">
            <div class="p-6 border-b border-gray-200">
                <div class="flex items-center justify-between">
                    <h3 class="text-lg font-semibold text-gray-900">
                        <i class="fas fa-brain text-ai mr-2"></i>
                        教AI学习
                    </h3>
                    <button class="text-gray-400 hover:text-gray-600" onclick="closeLearningModal()">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
            </div>
            <div class="p-6" id="learning-modal-content">
                <!-- 动态内容 -->
            </div>
        </div>
    </div>

    <script>
        // 标签页切换功能
        document.querySelectorAll('.tab-btn').forEach(btn => {
            btn.addEventListener('click', function() {
                const tabId = this.dataset.tab;
                
                // 更新按钮状态
                document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
                this.classList.add('active');
                
                // 显示对应内容
                document.querySelectorAll('.tab-content').forEach(content => {
                    content.classList.add('hidden');
                });
                document.getElementById(tabId + '-tab').classList.remove('hidden');
            });
        });

        // 初始化数据
        document.addEventListener('DOMContentLoaded', function() {
            initializeAssetKnowledge();
            initializeAISuggestions();
            initializeRecentLearning();
            initializeCustomRules();
            initializeDisposalKnowledge();
            setupTextSelection();
        });

        // 资产知识数据存储
        let assetKnowledgeData = [
            {
                id: 1,
                entity: '192.168.50.98',
                tags: ['漏扫服务器', '安全设备'],
                business: '安全运维部',
                source: 'AI智能识别',
                time: '2025-06-29 11:30'
            },
            {
                id: 2,
                entity: '10.20.100.5',
                tags: ['代理服务器', '网络设备'],
                business: '网络运维部',
                source: 'AI智能识别',
                time: '2025-06-29 11:25'
            },
            {
                id: 3,
                entity: '172.16.88.12',
                tags: ['代理服务器', '负载均衡'],
                business: '应用运维部',
                source: 'AI智能识别',
                time: '2025-06-29 11:20'
            },
            {
                id: 4,
                entity: '192.168.1.100',
                tags: ['Web服务器', '生产环境'],
                business: '电商平台',
                source: '由张工手动添加',
                time: '2025-06-29 14:30'
            },
            {
                id: 5,
                entity: '10.10.10.10', 
                tags: ['自动化运维平台'],
                business: '运维部',
                source: '从事件INC-123学习',
                time: '2025-06-29 16:45'
            },
            {
                id: 6,
                entity: '172.16.0.50',
                tags: ['数据库服务器', '核心系统'],
                business: '研发部-核心交易组',
                source: '由李经理手动添加',
                time: '2025-06-28 09:20'
            }
        ];

        // 初始化资产知识列表
        function initializeAssetKnowledge() {
            renderAssetKnowledgeList();
        }

        // 渲染资产知识列表
        function renderAssetKnowledgeList(filteredData = null) {
            const data = filteredData || assetKnowledgeData;
            const tbody = document.getElementById('asset-knowledge-list');
            
            tbody.innerHTML = data.map(item => `
                <tr class="hover:bg-gray-50" data-id="${item.id}">
                    <td class="px-6 py-4 whitespace-nowrap">
                        <div class="font-mono text-sm text-blue-600">${item.entity}</div>
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap">
                        <div class="flex flex-wrap gap-1">
                            ${item.tags.map(tag => `<span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-ai/10 text-ai">${tag}</span>`).join('')}
                        </div>
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">${item.business}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-600">${item.source}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm font-medium">
                        <button onclick="editAssetKnowledge(${item.id})" class="text-ai hover:text-purple-700 mr-3">编辑</button>
                        <button onclick="deleteAssetKnowledge(${item.id})" class="text-red-600 hover:text-red-800">删除</button>
                    </td>
                </tr>
            `).join('');
        }

        // 添加资产知识
        function addAssetKnowledge() {
            showAssetKnowledgeModal();
        }

        // 编辑资产知识
        function editAssetKnowledge(id) {
            const asset = assetKnowledgeData.find(item => item.id === id);
            if (asset) {
                showAssetKnowledgeModal(asset);
            }
        }

        // 删除资产知识
        function deleteAssetKnowledge(id) {
            if (confirm('确定要删除这条资产知识吗？')) {
                assetKnowledgeData = assetKnowledgeData.filter(item => item.id !== id);
                renderAssetKnowledgeList();
                showNotification('资产知识已删除', 'success');
                updateStatistics();
            }
        }

        // 显示资产知识编辑模态框
        function showAssetKnowledgeModal(asset = null) {
            const modal = document.getElementById('learning-modal');
            const content = document.getElementById('learning-modal-content');
            
            const isEdit = asset !== null;
            content.innerHTML = `
                <div class="space-y-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">资产实体</label>
                        <input type="text" id="asset-entity" value="${asset ? asset.entity : ''}" 
                               placeholder="192.168.1.100 或 server-name" 
                               class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-ai">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">资产标签</label>
                        <input type="text" id="asset-tags" value="${asset ? asset.tags.join(', ') : ''}" 
                               placeholder="Web服务器, 生产环境" 
                               class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-ai">
                        <p class="text-xs text-gray-500 mt-1">多个标签用逗号分隔</p>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">业务归属</label>
                        <input type="text" id="asset-business" value="${asset ? asset.business : ''}" 
                               placeholder="电商平台" 
                               class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-ai">
                    </div>
                    <div class="flex space-x-3">
                        <button onclick="saveAssetKnowledge(${asset ? asset.id : 'null'})" 
                                class="flex-1 bg-ai text-white py-2 rounded-lg hover:bg-purple-700">
                            ${isEdit ? '保存修改' : '添加资产知识'}
                        </button>
                        <button onclick="closeLearningModal()" 
                                class="px-4 py-2 border border-gray-300 rounded-lg hover:bg-gray-50">
                            取消
                        </button>
                    </div>
                </div>
            `;
            
            modal.classList.remove('hidden');
        }

        // 保存资产知识
        function saveAssetKnowledge(id) {
            const entity = document.getElementById('asset-entity').value.trim();
            const tags = document.getElementById('asset-tags').value.split(',').map(tag => tag.trim()).filter(tag => tag);
            const business = document.getElementById('asset-business').value.trim();
            
            if (!entity) {
                showNotification('请填写资产实体', 'error');
                return;
            }
            
            const assetData = {
                entity,
                tags,
                business,
                source: id ? '用户修改' : '用户手动添加',
                time: new Date().toLocaleString('zh-CN')
            };
            
            if (id) {
                // 编辑现有资产
                const index = assetKnowledgeData.findIndex(item => item.id === id);
                if (index !== -1) {
                    assetKnowledgeData[index] = { ...assetKnowledgeData[index], ...assetData };
                }
                showNotification('资产知识已更新', 'success');
            } else {
                // 添加新资产
                const newAsset = {
                    id: Date.now(),
                    ...assetData
                };
                assetKnowledgeData.push(newAsset);
                showNotification('资产知识已添加', 'success');
            }
            
            renderAssetKnowledgeList();
            closeLearningModal();
            updateStatistics();
        }

        // 搜索资产知识
        function searchAssetKnowledge() {
            const searchTerm = document.getElementById('asset-search').value.toLowerCase();
            const filterType = document.getElementById('asset-filter').value;
            
            let filteredData = assetKnowledgeData;
            
            // 按搜索词筛选
            if (searchTerm) {
                filteredData = filteredData.filter(item => 
                    item.entity.toLowerCase().includes(searchTerm) ||
                    item.tags.some(tag => tag.toLowerCase().includes(searchTerm)) ||
                    item.business.toLowerCase().includes(searchTerm)
                );
            }
            
            // 按类型筛选
            if (filterType) {
                filteredData = filteredData.filter(item => 
                    item.tags.some(tag => tag.includes(filterType))
                );
            }
            
            renderAssetKnowledgeList(filteredData);
        }

        // 筛选资产知识
        function filterAssetKnowledge() {
            searchAssetKnowledge(); // 复用搜索逻辑
        }

        // 初始化最近学习记录
        function initializeRecentLearning() {
            const container = document.getElementById('recent-learning-list');
            container.innerHTML = learningRecords.map(record => `
                <div class="flex items-start space-x-3 p-3 border ${record.highlight ? 'border-orange-200 bg-orange-50' : 'border-gray-200'} rounded-lg hover:bg-gray-50 ${record.highlight ? 'shadow-md' : ''}">
                    <div class="w-8 h-8 flex items-center justify-center rounded-full ${record.highlight ? 'bg-orange-100' : 'bg-gray-100'}">
                        <i class="fas ${record.icon} ${record.color}"></i>
                    </div>
                    <div class="flex-1">
                        <div class="text-sm font-medium text-gray-800 flex items-center">
                            ${record.type}
                            ${record.highlight ? '<span class="ml-2 inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-orange-100 text-orange-700"><i class="fas fa-star mr-1"></i>重要</span>' : ''}
                        </div>
                        <div class="text-sm text-gray-600">${record.content}</div>
                        <div class="text-xs text-gray-500 mt-1">${record.time}</div>
                    </div>
                </div>
            `).join('');
        }

        // AI智能规则引擎数据存储
        let intelligentRules = [];

        // 初始化AI智能规则引擎
        function initializeCustomRules() {
            const rules = [
                {
                    name: '业务健康检查优化',
                    condition: 'User-Agent匹配健康检查模式',
                    action: 'AI上下文分析',
                    status: '已优化',
                    confidence: '97%',
                    aiGenerated: false,
                    tuningCount: 12,
                    adaptations: 12,
                    lastOptimized: '30分钟前',
                    feature: 'HealthChecker/1.0',
                    learnType: '良性模式识别',
                    ignoreScope: '全局忽略',
                    assetScope: '全部',
                    remark: '内部业务健康检查探针，用于监控服务状态'
                },
                {
                    name: '供应链流量模式',
                    condition: 'API调用频率异常检测',
                    action: 'AI行为基线对比',
                    status: '自适应',
                    confidence: '89%',
                    aiGenerated: true,
                    tuningCount: 8,
                    adaptations: 8,
                    lastOptimized: '1小时前',
                    feature: 'API频率模式',
                    learnType: 'GPT研判优化',
                    ignoreScope: '仅在Web攻击告警中忽略',
                    assetScope: '生产环境资产',
                    remark: '供应链API调用频率基线分析'
                },
                {
                    name: '内网扫描智能识别',
                    condition: '来源IP在192.168.1.0/24且目标端口为22',
                    action: '动态风险评估',
                    status: '学习中',
                    confidence: '94%',
                    aiGenerated: true,
                    tuningCount: 5,
                    adaptations: 5,
                    lastOptimized: '2小时前',
                    feature: '内网SSH扫描',
                    learnType: '运维行为模式',
                    ignoreScope: '仅在SQL注入告警中忽略',
                    assetScope: '办公网资产',
                    remark: '内网运维工具SSH扫描行为识别'
                },
                {
                    name: 'SQL注入语义检测',
                    condition: 'Payload包含SQL关键字组合',
                    action: 'GPT语义理解分析',
                    status: '已优化',
                    confidence: '95%',
                    aiGenerated: false,
                    tuningCount: 23,
                    adaptations: 23,
                    lastOptimized: '15分钟前',
                    feature: 'SQL语义特征',
                    learnType: 'GPT研判优化',
                    ignoreScope: '全局忽略',
                    assetScope: 'Web服务器',
                    remark: 'SQL注入攻击的深度语义理解分析'
                },
                {
                    name: '异常登录行为分析',
                    condition: '登录时间、地点、设备异常组合',
                    action: 'AI风险评分模型',
                    status: '自适应',
                    confidence: '91%',
                    aiGenerated: true,
                    tuningCount: 15,
                    adaptations: 15,
                    lastOptimized: '45分钟前',
                    feature: '登录行为模式',
                    learnType: '业务特征模式',
                    ignoreScope: '仅在Web攻击告警中忽略',
                    assetScope: '核心业务资产',
                    remark: '基于时空和设备特征的异常登录检测'
                },
                {
                    name: '文件上传威胁检测',
                    condition: '文件类型、大小、内容特征分析',
                    action: 'AI多维度威胁识别',
                    status: '学习中',
                    confidence: '87%',
                    aiGenerated: true,
                    tuningCount: 3,
                    adaptations: 3,
                    lastOptimized: '3小时前',
                    feature: '文件上传特征',
                    learnType: '良性模式识别',
                    ignoreScope: '仅在SQL注入告警中忽略',
                    assetScope: '应用服务器',
                    remark: '多维度文件上传威胁检测和识别'
                },
                {
                    name: 'XSS攻击模式识别',
                    condition: 'HTML/JS代码注入特征匹配',
                    action: 'AI语法树分析',
                    status: '已优化',
                    confidence: '93%',
                    aiGenerated: false,
                    tuningCount: 18,
                    adaptations: 18,
                    lastOptimized: '1小时前',
                    feature: 'XSS攻击载荷',
                    learnType: 'GPT研判优化',
                    ignoreScope: '仅在Web攻击告警中忽略',
                    assetScope: 'Web服务器',
                    remark: 'XSS攻击载荷的语法树深度分析'
                },
                {
                    name: '暴力破解检测优化',
                    condition: '短时间内多次失败登录尝试',
                    action: 'AI时间序列分析',
                    status: '自适应',
                    confidence: '96%',
                    aiGenerated: true,
                    tuningCount: 27,
                    adaptations: 27,
                    lastOptimized: '10分钟前',
                    feature: '登录失败模式',
                    learnType: '运维行为模式',
                    ignoreScope: '全局忽略',
                    assetScope: '全部',
                    remark: '基于时间序列的暴力破解检测优化'
                }
            ];

            // 保存到全局变量
            intelligentRules = rules;

            const container = document.getElementById('custom-rules-list');
            container.innerHTML = rules.map(rule => `
                <div class="border border-gray-200 rounded-lg p-4 hover:shadow-md transition-all duration-200 bg-gradient-to-r from-white to-blue-50">
                    <div class="flex items-center justify-between mb-3">
                        <div class="flex items-center space-x-2">
                            <h4 class="font-medium text-gray-800">${rule.name}</h4>
                            ${rule.aiGenerated ? '<span class="inline-flex items-center px-2 py-1 rounded text-xs bg-ai text-white"><i class="fas fa-robot mr-1"></i>AI生成</span>' : ''}
                        </div>
                        <div class="flex items-center space-x-2">
                            <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${rule.status === '学习中' ? 'bg-yellow-100 text-yellow-700' : rule.status === '已优化' ? 'bg-green-100 text-green-700' : 'bg-blue-100 text-blue-700'}">
                                ${rule.status}
                            </span>
                        </div>
                    </div>
                    <div class="space-y-2 mb-3">
                        <div class="text-sm">
                            <span class="text-gray-500">条件:</span>
                            <span class="text-gray-700">${rule.condition}</span>
                        </div>
                        <div class="text-sm">
                            <span class="text-gray-500">动作:</span>
                            <span class="text-gray-700">${rule.action}</span>
                        </div>
                    </div>
                    <div class="grid grid-cols-3 gap-3 text-sm bg-white/50 rounded p-2">
                        <div class="text-center">
                            <div class="text-ai font-bold">${rule.tuningCount}次</div>
                            <div class="text-xs text-gray-500">调优次数</div>
                        </div>
                        <div class="text-center">
                            <div class="text-blue-600 font-bold">${rule.adaptations}</div>
                            <div class="text-xs text-gray-500">自适应次数</div>
                        </div>
                        <div class="text-center">
                            <div class="text-gray-600 font-bold">${rule.lastOptimized}</div>
                            <div class="text-xs text-gray-500">最近优化</div>
                        </div>
                    </div>
                    <div class="flex items-center justify-between mt-3 pt-3 border-t border-gray-100">
                        <div class="flex items-center space-x-3">
                            <button onclick="showRuleDetail('${rule.name}')" class="text-blue-600 hover:text-blue-800 text-sm px-3 py-1 rounded bg-blue-50 hover:bg-blue-100 transition-colors border border-blue-200">
                                <i class="fas fa-info-circle mr-1"></i>
                                详情
                            </button>
                            <button onclick="editRule('${rule.name}')" class="text-ai hover:text-purple-700 text-sm px-3 py-1 rounded bg-purple-50 hover:bg-purple-100 transition-colors border border-purple-200">
                                <i class="fas fa-edit mr-1"></i>
                                修改
                            </button>
                        </div>
                        <div class="text-xs text-gray-500">
                            最近优化: ${rule.lastOptimized}
                        </div>
                    </div>
                </div>
            `).join('');
        }

        // 设置文本选择功能
        function setupTextSelection() {
            document.addEventListener('mouseup', function(e) {
                // 等待一个短暂延迟以确保选择已完成
                setTimeout(() => {
                    const selection = window.getSelection();
                    const selectedText = selection.toString().trim();
                    
                    if (selectedText.length > 0) {
                        const range = selection.getRangeAt(0);
                        const rect = range.getBoundingClientRect();
                        
                        const toolbar = document.getElementById('floating-toolbar');
                        
                        // 改进定位计算，考虑页面滚动
                        const scrollTop = window.pageYOffset || document.documentElement.scrollTop;
                        const scrollLeft = window.pageXOffset || document.documentElement.scrollLeft;
                        
                        toolbar.style.left = (rect.left + scrollLeft) + 'px';
                        toolbar.style.top = (rect.top + scrollTop - 60) + 'px';
                        toolbar.classList.remove('hidden');
                        
                        // 存储选中的文本
                        toolbar.dataset.selectedText = selectedText;
                        
                        // 更新预览文本
                        const preview = document.getElementById('selected-text-preview');
                        if (preview) {
                            preview.textContent = selectedText.length > 20 ? selectedText.substring(0, 20) + '...' : selectedText;
                        }
                        
                        console.log('文本已选择:', selectedText); // 调试信息
                        
                        // 显示成功提示
                        if (selectedText.includes('HealthChecker')) {
                            showNotification('文本选择成功！请点击"标记为良性"按钮', 'success');
                        }
                    } else {
                        // 如果没有选中文本，隐藏工具条
                        document.getElementById('floating-toolbar').classList.add('hidden');
                    }
                }, 10);
            });

            // 点击其他地方时隐藏工具条
            document.addEventListener('click', function(e) {
                if (!e.target.closest('#floating-toolbar')) {
                    const selection = window.getSelection();
                    if (selection.toString().trim().length === 0) {
                        document.getElementById('floating-toolbar').classList.add('hidden');
                    }
                }
            });

            // 键盘操作支持
            document.addEventListener('keydown', function(e) {
                if (e.key === 'Escape') {
                    document.getElementById('floating-toolbar').classList.add('hidden');
                    window.getSelection().removeAllRanges();
                }
            });
        }

        // 标记为良性
        function markAsGood() {
            const toolbar = document.getElementById('floating-toolbar');
            const selectedText = toolbar.dataset.selectedText;
            
            showLearningModal('good', selectedText);
            toolbar.classList.add('hidden');
        }

        // 标记为威胁
        function markAsThreat() {
            const toolbar = document.getElementById('floating-toolbar');
            const selectedText = toolbar.dataset.selectedText;
            
            showLearningModal('threat', selectedText);
            toolbar.classList.add('hidden');
        }

        // 全局搜索
        function globalSearch() {
            const toolbar = document.getElementById('floating-toolbar');
            const selectedText = toolbar.dataset.selectedText;
            
            showNotification(`搜索 "${selectedText}" 的相关信息...`, 'info');
            toolbar.classList.add('hidden');
        }

        // 显示学习模态框
        function showLearningModal(type, text) {
            const modal = document.getElementById('learning-modal');
            const content = document.getElementById('learning-modal-content');
            
            if (type === 'good') {
                content.innerHTML = `
                    <div class="space-y-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">特征内容</label>
                            <input type="text" value="${text}" class="w-full px-3 py-2 border border-gray-300 rounded-lg bg-gray-50" readonly>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">AI学习类型</label>
                            <select class="w-full px-3 py-2 border border-gray-300 rounded-lg">
                                <option>良性模式识别</option>
                                <option>运维行为模式</option>
                                <option>内部域名模式</option>
                                <option>GPT研判优化</option>
                                <option>业务特征模式</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">忽略范围</label>
                            <select class="w-full px-3 py-2 border border-gray-300 rounded-lg">
                                <option>全局忽略</option>
                                <option>仅在Web攻击告警中忽略</option>
                                <option>仅在SQL注入告警中忽略</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">生效资产</label>
                            <select class="w-full px-3 py-2 border border-gray-300 rounded-lg">
                                <option selected>全部</option>
                                <option>生产环境资产</option>
                                <option>测试环境资产</option>
                                <option>办公网资产</option>
                                <option>DMZ区域资产</option>
                                <option>核心业务资产</option>
                                <option>Web服务器</option>
                                <option>数据库服务器</option>
                                <option>应用服务器</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">备注</label>
                            <textarea placeholder="内部业务健康检查探针" class="w-full px-3 py-2 border border-gray-300 rounded-lg h-20 resize-none"></textarea>
                        </div>
                        <div class="flex space-x-3">
                            <button onclick="confirmLearning('good')" class="flex-1 bg-success text-white py-2 rounded-lg hover:bg-green-700">
                                确认，不再告警
                            </button>
                            <button onclick="closeLearningModal()" class="px-4 py-2 border border-gray-300 rounded-lg hover:bg-gray-50">
                                取消
                            </button>
                        </div>
                    </div>
                `;
            }
            
            modal.classList.remove('hidden');
        }

        // 关闭学习模态框
        function closeLearningModal() {
            document.getElementById('learning-modal').classList.add('hidden');
        }

        // 确认学习
        function confirmLearning(type) {
            showNotification('学习成功！AI已记住这个特征', 'success');
            closeLearningModal();
            
            // 刷新相关数据
            setTimeout(() => {
                initializeRecentLearning();
            }, 500);
        }

        // 教AI功能 - 点击IP地址时调用
        function teachAI(type, value) {
            if (type === 'ip') {
                showIPLearningModal(value);
            }
        }

        // 显示IP学习模态框
        function showIPLearningModal(ip) {
            const modal = document.getElementById('learning-modal');
            const content = document.getElementById('learning-modal-content');
            
            content.innerHTML = `
                <div class="space-y-4">
                    <div class="text-center mb-4">
                        <div class="w-16 h-16 bg-ai/10 rounded-full flex items-center justify-center mx-auto mb-3">
                            <i class="fas fa-brain text-ai text-2xl"></i>
                        </div>
                        <h4 class="text-lg font-semibold text-gray-800">教AI学习资产信息</h4>
                        <p class="text-sm text-gray-600">为 <code class="bg-gray-100 px-2 py-1 rounded">${ip}</code> 添加资产属性</p>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">资产标签</label>
                        <input type="text" id="ip-tags" placeholder="例如: 自动化运维平台, 内部工具" 
                               class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-ai">
                        <p class="text-xs text-gray-500 mt-1">多个标签用逗号分隔</p>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">业务归属</label>
                        <input type="text" id="ip-business" placeholder="例如: 运维部" 
                               class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-ai">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">补充说明</label>
                        <textarea id="ip-description" placeholder="例如: Ansible自动化平台，会有大量SSH登录，属正常行为" 
                                  class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-ai h-20 resize-none"></textarea>
                    </div>
                    <div class="flex space-x-3">
                        <button onclick="saveIPLearning('${ip}')" 
                                class="flex-1 bg-ai text-white py-2 rounded-lg hover:bg-purple-700">
                            <i class="fas fa-brain mr-2"></i>好的，AI记住了
                        </button>
                        <button onclick="closeLearningModal()" 
                                class="px-4 py-2 border border-gray-300 rounded-lg hover:bg-gray-50">
                            取消
                        </button>
                    </div>
                </div>
            `;
            
            modal.classList.remove('hidden');
        }

        // 保存IP学习
        function saveIPLearning(ip) {
            const tags = document.getElementById('ip-tags').value.split(',').map(tag => tag.trim()).filter(tag => tag);
            const business = document.getElementById('ip-business').value.trim();
            const description = document.getElementById('ip-description').value.trim();
            
            if (tags.length === 0) {
                showNotification('请至少添加一个资产标签', 'error');
                return;
            }
            
            // 添加到资产知识库
            const newAsset = {
                id: Date.now(),
                entity: ip,
                tags: tags,
                business: business || '未知',
                source: '在场学习获得',
                time: new Date().toLocaleString('zh-CN'),
                description: description
            };
            
            assetKnowledgeData.push(newAsset);
            
            // 添加到学习记录
            addLearningRecord('资产标记', `${ip} → ${tags.join(', ')}`);
            
            showNotification('学习成功！AI已记住这个资产', 'success');
            closeLearningModal();
            renderAssetKnowledgeList();
            updateStatistics();
        }

        // 学习记录数据存储
        let learningRecords = [
            {
                id: 1,
                type: 'AI纠错',
                content: '纠正杜少对192.168.50.98的误判 → 改为"漏扫服务器"',
                time: '2分钟前',
                icon: 'fa-exclamation-triangle',
                color: 'text-orange-500',
                highlight: true
            },
            {
                id: 2,
                type: 'AI优化',
                content: 'GPT模型调优 → SQL注入检测准确率提升12%',
                time: '8分钟前',
                icon: 'fa-brain',
                color: 'text-purple-500'
            },
            {
                id: 3,
                type: 'AI纠错',
                content: '纠正杜少对"Python-requests"的威胁判断',
                time: '1小时前',
                icon: 'fa-sync-alt',
                color: 'text-red-500',
                highlight: true
            },
            {
                id: 4,
                type: '智能发现',
                content: 'AI识别出代理服务器10.20.100.5的行为特征',
                time: '2小时前',
                icon: 'fa-search',
                color: 'text-blue-500'
            },
            {
                id: 5,
                type: 'AI纠错',
                content: '纠正杜少对内网扫描的误报判断 → 降低15%误报',
                time: '3小时前',
                icon: 'fa-check-circle',
                color: 'text-green-500',
                highlight: true
            },
            {
                id: 6,
                type: '特征学习',
                content: 'HealthChecker/1.0 → 标记为良性特征',
                time: '昨天',
                icon: 'fa-check-shield',
                color: 'text-success'
            }
        ];

        // 添加学习记录
        function addLearningRecord(type, content) {
            const icons = {
                '资产标记': 'fa-server',
                '特征标记': 'fa-check-shield',
                'GPT调优': 'fa-brain',
                '规则定义': 'fa-code-branch'
            };
            
            const colors = {
                '资产标记': 'text-ai',
                '特征标记': 'text-success',
                'GPT调优': 'text-ai',
                '规则定义': 'text-warning'
            };
            
            const newRecord = {
                id: Date.now(),
                type,
                content,
                time: '刚刚',
                icon: icons[type] || 'fa-lightbulb',
                color: colors[type] || 'text-gray-600'
            };
            
            learningRecords.unshift(newRecord); // 添加到开头
            if (learningRecords.length > 10) {
                learningRecords = learningRecords.slice(0, 10); // 只保留最近10条
            }
            
            // 重新渲染学习记录
            const container = document.getElementById('recent-learning-list');
            container.innerHTML = learningRecords.map(record => `
                <div class="flex items-start space-x-3 p-3 border ${record.highlight ? 'border-orange-200 bg-orange-50' : 'border-gray-200'} rounded-lg hover:bg-gray-50 ${record.highlight ? 'shadow-md' : ''}">
                    <div class="w-8 h-8 flex items-center justify-center rounded-full ${record.highlight ? 'bg-orange-100' : 'bg-gray-100'}">
                        <i class="fas ${record.icon} ${record.color}"></i>
                    </div>
                    <div class="flex-1">
                        <div class="text-sm font-medium text-gray-800 flex items-center">
                            ${record.type}
                            ${record.highlight ? '<span class="ml-2 inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-orange-100 text-orange-700"><i class="fas fa-star mr-1"></i>重要</span>' : ''}
                        </div>
                        <div class="text-sm text-gray-600">${record.content}</div>
                        <div class="text-xs text-gray-500 mt-1">${record.time}</div>
                    </div>
                </div>
            `).join('');
        }

        // 更新统计数据
        function updateStatistics() {
            // 更新总知识项（只计算资产知识）
            const totalKnowledge = assetKnowledgeData.length;
            
            // 更新页面头部统计
            const statElements = document.querySelectorAll('.text-2xl.font-bold');
            if (statElements.length >= 4) {
                statElements[0].textContent = totalKnowledge;
                statElements[1].textContent = assetKnowledgeData.length;
                // 其他统计项保持不变
            }
        }

        // 初始化AI智能建议
        function initializeAISuggestions() {
            const suggestions = [
                {
                    type: 'network-discovery',
                    title: 'AI发现新的网段模式',
                    description: '基于流量分析，发现172.20.0.0/16可能是数据库专用网段',
                    confidence: '89%',
                    action: '添加为已知网段',
                    icon: 'fa-network-wired',
                    color: 'text-blue-500',
                    priority: 'high',
                    detailInfo: {
                        networkRange: '172.20.0.0/16',
                        analysis: '该网段流量模式显示典型的数据库访问特征',
                        suggestedTags: ['数据库网段', '高敏感度'],
                        riskLevel: '高'
                    }
                },
                {
                    type: 'asset-discovery',
                    title: '发现新的代理服务器',
                    description: '192.168.100.88 表现出代理服务器行为特征，需要用户确认',
                    confidence: '92%',
                    action: '确认并标记',
                    icon: 'fa-server',
                    color: 'text-green-500',
                    priority: 'high',
                    detailInfo: {
                        assetIP: '192.168.100.88',
                        behaviorPattern: '大量转发请求，端口8080开放',
                        suggestedTags: ['代理服务器', '网络设备'],
                        department: '网络运维部'
                    }
                },
                {
                    type: 'asset-discovery',
                    title: '识别疑似漏扫设备',
                    description: '10.50.30.15 具有漏洞扫描器行为特征，建议确认归属',
                    confidence: '87%',
                    action: '确认设备类型',
                    icon: 'fa-search',
                    color: 'text-purple-500',
                    priority: 'medium',
                    detailInfo: {
                        assetIP: '10.50.30.15',
                        behaviorPattern: '对多个端口进行扫描，User-Agent包含安全工具特征',
                        suggestedTags: ['漏扫服务器', '安全设备'],
                        scanPorts: '22, 80, 443, 3389, 8080'
                    }
                }
            ];

            const container = document.getElementById('ai-suggestions');
            container.innerHTML = suggestions.map(suggestion => {
                const bgClass = suggestion.priority === 'high' ? 'bg-gradient-to-r from-white to-purple-50' : 
                               suggestion.priority === 'medium' ? 'bg-gradient-to-r from-white to-blue-50' : 
                               'bg-gradient-to-r from-white to-gray-50';
                
                const iconBgClass = suggestion.priority === 'high' ? 'bg-purple-100' : 
                                   suggestion.priority === 'medium' ? 'bg-blue-100' : 
                                   'bg-gray-100';
                
                const priorityBadgeClass = suggestion.priority === 'high' ? 'bg-red-100 text-red-700' : 
                                          suggestion.priority === 'medium' ? 'bg-yellow-100 text-yellow-700' : 
                                          'bg-gray-100 text-gray-700';
                
                const priorityText = suggestion.priority === 'high' ? '高优先级' : 
                                    suggestion.priority === 'medium' ? '中优先级' : 
                                    '低优先级';
                
                return `
                    <div class="border border-gray-200 rounded-lg p-4 hover:shadow-lg transition-all duration-300 ${bgClass} hover:scale-105">
                        <div class="flex items-start space-x-4">
                            <div class="w-12 h-12 rounded-lg flex items-center justify-center ${iconBgClass}">
                                <i class="fas ${suggestion.icon} ${suggestion.color} text-lg"></i>
                            </div>
                            <div class="flex-1">
                                <div class="flex items-center justify-between mb-2">
                                    <h4 class="font-semibold text-gray-900">${suggestion.title}</h4>
                                    <div class="flex items-center space-x-2">
                                        <span class="inline-flex items-center px-2 py-1 rounded-full text-xs font-medium ${priorityBadgeClass}">
                                            ${priorityText}
                                        </span>
                                    </div>
                                </div>
                                <p class="text-sm text-gray-700 mb-4 leading-relaxed">${suggestion.description}</p>
                                <div class="flex items-center justify-between">
                                    <button onclick="applySuggestion('${suggestion.type}', '${suggestion.title}')" class="flex items-center space-x-2 bg-gradient-to-r from-purple-500 to-blue-500 text-white px-4 py-2 rounded-lg text-sm hover:from-purple-600 hover:to-blue-600 transition-all transform hover:scale-105">
                                        <i class="fas fa-robot"></i>
                                        <span>${suggestion.action}</span>
                                    </button>
                                    <div class="flex items-center space-x-2">
                                        <button onclick="showSuggestionDetail(${JSON.stringify(suggestion).replace(/"/g, '&quot;')})" class="text-blue-600 hover:text-blue-800 text-sm px-3 py-1 rounded bg-blue-50 hover:bg-blue-100 transition-colors border border-blue-200">
                                            <i class="fas fa-info-circle mr-1"></i>
                                            详情
                                        </button>
                                        <button onclick="ignoreSuggestion('${suggestion.type}')" class="text-gray-500 hover:text-red-600 text-sm px-2 py-1 rounded hover:bg-red-50 transition-colors">
                                            <i class="fas fa-times mr-1"></i>
                                            忽略
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
        }

        // 添加自定义规则
        function addCustomRule() {
            showNotification('自定义规则功能开发中，敬请期待！', 'info');
        }

        // 显示建议详情
        function showSuggestionDetail(suggestion) {
            const modal = document.getElementById('learning-modal');
            const content = document.getElementById('learning-modal-content');
            
            let detailHTML = '';
            
            if (suggestion.type === 'network-discovery') {
                detailHTML = `
                    <div class="space-y-4">
                        <div class="flex items-center space-x-3 mb-4">
                            <div class="w-10 h-10 bg-blue-100 rounded-lg flex items-center justify-center">
                                <i class="fas fa-network-wired text-blue-600"></i>
                            </div>
                            <div>
                                <h3 class="text-lg font-semibold text-gray-900">${suggestion.title}</h3>
                            </div>
                        </div>
                        <div class="bg-gray-50 rounded-lg p-4">
                            <h4 class="font-medium text-gray-800 mb-3">网段分析详情</h4>
                            <div class="grid grid-cols-2 gap-3 text-sm">
                                <div>
                                    <span class="text-gray-600">网段范围：</span>
                                    <span class="font-mono text-blue-600">${suggestion.detailInfo.networkRange}</span>
                                </div>
                                <div>
                                    <span class="text-gray-600">风险等级：</span>
                                    <span class="text-red-600 font-medium">${suggestion.detailInfo.riskLevel}</span>
                                </div>
                                <div class="col-span-2">
                                    <span class="text-gray-600">分析结果：</span>
                                    <p class="text-gray-800 mt-1">${suggestion.detailInfo.analysis}</p>
                                </div>
                                <div class="col-span-2">
                                    <span class="text-gray-600">建议标签：</span>
                                    <div class="flex flex-wrap gap-1 mt-1">
                                        ${suggestion.detailInfo.suggestedTags.map(tag => 
                                            `<span class="inline-flex items-center px-2 py-1 rounded text-xs bg-blue-100 text-blue-700">${tag}</span>`
                                        ).join('')}
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
            } else if (suggestion.type === 'asset-discovery') {
                detailHTML = `
                    <div class="space-y-4">
                        <div class="flex items-center space-x-3 mb-4">
                            <div class="w-10 h-10 bg-green-100 rounded-lg flex items-center justify-center">
                                <i class="fas ${suggestion.icon} ${suggestion.color}"></i>
                            </div>
                            <div>
                                <h3 class="text-lg font-semibold text-gray-900">${suggestion.title}</h3>
                            </div>
                        </div>
                        <div class="bg-gray-50 rounded-lg p-4">
                            <h4 class="font-medium text-gray-800 mb-3">资产分析详情</h4>
                            <div class="grid grid-cols-1 gap-3 text-sm">
                                <div>
                                    <span class="text-gray-600">资产IP：</span>
                                    <span class="font-mono text-blue-600">${suggestion.detailInfo.assetIP}</span>
                                </div>
                                <div>
                                    <span class="text-gray-600">行为模式：</span>
                                    <p class="text-gray-800 mt-1">${suggestion.detailInfo.behaviorPattern}</p>
                                </div>
                                ${suggestion.detailInfo.scanPorts ? `
                                <div>
                                    <span class="text-gray-600">扫描端口：</span>
                                    <span class="font-mono text-gray-800">${suggestion.detailInfo.scanPorts}</span>
                                </div>
                                ` : ''}
                                <div>
                                    <span class="text-gray-600">建议归属：</span>
                                    <span class="text-gray-800">${suggestion.detailInfo.department || '待确认'}</span>
                                </div>
                                <div>
                                    <span class="text-gray-600">建议标签：</span>
                                    <div class="flex flex-wrap gap-1 mt-1">
                                        ${suggestion.detailInfo.suggestedTags.map(tag => 
                                            `<span class="inline-flex items-center px-2 py-1 rounded text-xs bg-purple-100 text-purple-700">${tag}</span>`
                                        ).join('')}
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
            }
            
            content.innerHTML = detailHTML + `
                <div class="flex space-x-3 mt-6">
                    <button onclick="applySuggestion('${suggestion.type}', '${suggestion.title}')" 
                            class="flex-1 bg-gradient-to-r from-purple-500 to-blue-500 text-white py-2 rounded-lg hover:from-purple-600 hover:to-blue-600">
                        ${suggestion.action}
                    </button>
                    <button onclick="closeLearningModal()" 
                            class="px-4 py-2 border border-gray-300 rounded-lg hover:bg-gray-50">
                        关闭
                    </button>
                </div>
            `;
            
            modal.classList.remove('hidden');
        }

        // 应用建议
        function applySuggestion(type, title) {
            if (type === 'network-discovery') {
                showNotification('已将网段信息添加到资产知识库', 'success');
                // 这里可以添加实际的网段添加逻辑
            } else if (type === 'asset-discovery') {
                showNotification('已确认资产类型并添加到知识库', 'success');
                // 这里可以添加实际的资产添加逻辑
            }
            closeLearningModal();
        }

        // 忽略建议
        function ignoreSuggestion(type) {
            showNotification('已忽略该建议', 'info');
            // 这里可以添加从建议列表中移除的逻辑
        }

        // 新增的环境感知学习相关函数
        function applyNetworkConfig(suggestionId) {
            showNotification('网络配置已应用，正在生成配置单...', 'success');
            // 这里可以添加实际的网络配置应用逻辑
        }

        function showNetworkDetail(suggestionId) {
            showNotification('查看网络配置详情...', 'info');
            // 这里可以添加显示网络详情的逻辑
        }

        function confirmProxyServer(ip) {
            showNotification(`已确认 ${ip} 为代理服务器，正在应用配置...`, 'success');
            // 这里可以添加确认代理服务器的逻辑
        }

        function ignoreProxyServer(ip) {
            showNotification(`已忽略 ${ip} 的代理服务器建议`, 'info');
            // 这里可以添加忽略代理服务器建议的逻辑
        }

        function importCMDB() {
            showNotification('CMDB导入功能开发中，敬请期待！', 'info');
            // 这里可以添加CMDB导入的逻辑
        }

        // 新增的研判智能学习相关函数
        function labelAlert(type) {
            const labels = {
                'positive': '✅正报',
                'negative': '❌误报'
            };
            
            showNotification(`已标记为${labels[type]}，AI正在学习中...`, 'success');
            // 这里可以添加实际的标记学习逻辑
        }

        function uploadKnowledgeDoc() {
            showNotification('知识文档上传功能开发中，敬请期待！', 'info');
            // 这里可以添加文档上传的逻辑
        }

        function acceptAIRecommendation(ruleId) {
            showNotification('AI推荐规则已采纳，正在应用中...', 'success');
            // 这里可以添加采纳AI推荐的逻辑
        }

        function rejectAIRecommendation(ruleId) {
            showNotification('AI推荐规则已拒绝', 'info');
            // 这里可以添加拒绝AI推荐的逻辑
        }

        function exportKnowledgeBase() {
            showNotification('知识库导出功能开发中，敬请期待！', 'info');
            // 这里可以添加知识库导出的逻辑
        }

        // 显示指标详情
        function showMetricDetail(metricType) {
            const modal = document.getElementById('learning-modal');
            const content = document.getElementById('learning-modal-content');
            
            const metricDetails = {
                'accuracy': {
                    title: '告警精准度',
                    value: '92%',
                    formula: '告警精准度 = 真实威胁告警数 / 总告警数',
                    calculation: `
                        <div class="space-y-3">
                            <div class="bg-gray-50 rounded-lg p-4">
                                <h5 class="font-medium text-gray-800 mb-2">计算公式</h5>
                                <div class="font-mono text-sm text-blue-600">
                                    精准度 = 真实威胁告警数 / 总告警数 × 100%
                                </div>
                            </div>
                            <div class="grid grid-cols-2 gap-4">
                                <div class="bg-blue-50 rounded-lg p-3">
                                    <div class="text-sm text-blue-800">真实威胁告警</div>
                                    <div class="text-2xl font-bold text-blue-600">2,208</div>
                                </div>
                                <div class="bg-gray-50 rounded-lg p-3">
                                    <div class="text-sm text-gray-800">总告警数</div>
                                    <div class="text-2xl font-bold text-gray-600">2,400</div>
                                </div>
                            </div>
                            <div class="bg-green-50 rounded-lg p-3">
                                <div class="text-sm text-green-800">计算结果</div>
                                <div class="text-lg font-bold text-green-600">2,208 ÷ 2,400 = 92%</div>
                            </div>
                        </div>
                    `,
                    improvement: '通过AI学习用户标注，模型不断优化威胁识别准确性，相比上月提升15%'
                },
                'automation': {
                    title: '自动化处理率',
                    value: '85%',
                    formula: '自动化处理率 = 自动处理告警数 / 总告警数',
                    calculation: `
                        <div class="space-y-3">
                            <div class="bg-gray-50 rounded-lg p-4">
                                <h5 class="font-medium text-gray-800 mb-2">计算公式</h5>
                                <div class="font-mono text-sm text-purple-600">
                                    自动化率 = 自动处理告警数 / 总告警数 × 100%
                                </div>
                            </div>
                            <div class="grid grid-cols-2 gap-4">
                                <div class="bg-purple-50 rounded-lg p-3">
                                    <div class="text-sm text-purple-800">自动处理告警</div>
                                    <div class="text-2xl font-bold text-purple-600">2,040</div>
                                </div>
                                <div class="bg-gray-50 rounded-lg p-3">
                                    <div class="text-sm text-gray-800">总告警数</div>
                                    <div class="text-2xl font-bold text-gray-600">2,400</div>
                                </div>
                            </div>
                            <div class="bg-green-50 rounded-lg p-3">
                                <div class="text-sm text-green-800">计算结果</div>
                                <div class="text-lg font-bold text-green-600">2,040 ÷ 2,400 = 85%</div>
                            </div>
                        </div>
                    `,
                    improvement: '通过处置习惯学习，系统自动应用历史处置策略，减少人工干预'
                },
                'response': {
                    title: '平均响应时间',
                    value: '3.2分钟',
                    formula: '平均响应时间 = 总响应时间 / 处理告警数',
                    calculation: `
                        <div class="space-y-3">
                            <div class="bg-gray-50 rounded-lg p-4">
                                <h5 class="font-medium text-gray-800 mb-2">计算公式</h5>
                                <div class="font-mono text-sm text-orange-600">
                                    响应时间 = 总响应时间 / 处理告警数
                                </div>
                            </div>
                            <div class="grid grid-cols-2 gap-4">
                                <div class="bg-orange-50 rounded-lg p-3">
                                    <div class="text-sm text-orange-800">总响应时间</div>
                                    <div class="text-2xl font-bold text-orange-600">7,680分钟</div>
                                </div>
                                <div class="bg-gray-50 rounded-lg p-3">
                                    <div class="text-sm text-gray-800">处理告警数</div>
                                    <div class="text-2xl font-bold text-gray-600">2,400</div>
                                </div>
                            </div>
                            <div class="bg-green-50 rounded-lg p-3">
                                <div class="text-sm text-green-800">计算结果</div>
                                <div class="text-lg font-bold text-green-600">7,680 ÷ 2,400 = 3.2分钟</div>
                            </div>
                        </div>
                    `,
                    improvement: '通过智能分析和自动化处理，告警响应时间比上月减少40%'
                },
                'false_positive': {
                    title: '误报率',
                    value: '8%',
                    formula: '误报率 = 误报告警数 / 总告警数',
                    calculation: `
                        <div class="space-y-3">
                            <div class="bg-gray-50 rounded-lg p-4">
                                <h5 class="font-medium text-gray-800 mb-2">计算公式</h5>
                                <div class="font-mono text-sm text-red-600">
                                    误报率 = 误报告警数 / 总告警数 × 100%
                                </div>
                            </div>
                            <div class="grid grid-cols-2 gap-4">
                                <div class="bg-red-50 rounded-lg p-3">
                                    <div class="text-sm text-red-800">误报告警数</div>
                                    <div class="text-2xl font-bold text-red-600">192</div>
                                </div>
                                <div class="bg-gray-50 rounded-lg p-3">
                                    <div class="text-sm text-gray-800">总告警数</div>
                                    <div class="text-2xl font-bold text-gray-600">2,400</div>
                                </div>
                            </div>
                            <div class="bg-green-50 rounded-lg p-3">
                                <div class="text-sm text-green-800">计算结果</div>
                                <div class="text-lg font-bold text-green-600">192 ÷ 2,400 = 8%</div>
                            </div>
                        </div>
                    `,
                    improvement: '通过环境感知学习和研判智能优化，误报率比上月降低58%'
                }
            };
            
            const detail = metricDetails[metricType];
            
            content.innerHTML = `
                <div class="space-y-4">
                    <div class="text-center mb-4">
                        <div class="w-16 h-16 bg-blue-100 rounded-full flex items-center justify-center mx-auto mb-3">
                            <i class="fas fa-calculator text-blue-600 text-2xl"></i>
                        </div>
                        <h4 class="text-lg font-semibold text-gray-800">${detail.title}</h4>
                        <p class="text-sm text-gray-600">当前数值: ${detail.value}</p>
                    </div>
                    
                    ${detail.calculation}
                    
                    <div class="bg-blue-50 rounded-lg p-4">
                        <h5 class="font-medium text-blue-800 mb-2">优化说明</h5>
                        <p class="text-sm text-blue-700">${detail.improvement}</p>
                    </div>
                    
                    <div class="flex space-x-3">
                        <button onclick="closeLearningModal()" class="flex-1 bg-blue-500 text-white py-2 rounded-lg hover:bg-blue-600">
                            关闭
                        </button>
                    </div>
                </div>
            `;
            
            modal.classList.remove('hidden');
        }

        // 显示学习详情
        function showLearningDetail(learningType) {
            const modal = document.getElementById('learning-modal');
            const content = document.getElementById('learning-modal-content');
            
            const learningDetails = {
                'user_feedback': {
                    title: '用户反馈学习',
                    icon: 'fa-thumbs-up',
                    color: 'text-blue-600',
                    description: '通过客户打标系统收集的反馈数据，AI实时学习用户的判断标准',
                    details: `
                        <div class="space-y-4">
                            <div class="grid grid-cols-2 gap-4">
                                <div class="bg-green-50 rounded-lg p-3">
                                    <div class="text-sm text-green-800">正报标注</div>
                                    <div class="text-2xl font-bold text-green-600">2,208</div>
                                </div>
                                <div class="bg-red-50 rounded-lg p-3">
                                    <div class="text-sm text-red-800">误报标注</div>
                                    <div class="text-2xl font-bold text-red-600">140</div>
                                </div>
                            </div>
                            <div class="bg-gray-50 rounded-lg p-3">
                                <div class="text-sm text-gray-800">学习准确率</div>
                                <div class="text-lg font-bold text-gray-600">94%</div>
                                <div class="text-xs text-gray-500">AI对用户标注的学习准确度</div>
                            </div>
                        </div>
                    `
                },
                'rule_optimization': {
                    title: '规则自动优化',
                    icon: 'fa-cogs',
                    color: 'text-green-600',
                    description: '基于历史数据和用户反馈，AI自动优化检测规则，提升检测效率',
                    details: `
                        <div class="space-y-4">
                            <div class="grid grid-cols-2 gap-4">
                                <div class="bg-blue-50 rounded-lg p-3">
                                    <div class="text-sm text-blue-800">规则优化次数</div>
                                    <div class="text-2xl font-bold text-blue-600">156</div>
                                </div>
                                <div class="bg-purple-50 rounded-lg p-3">
                                    <div class="text-sm text-purple-800">生成新规则</div>
                                    <div class="text-2xl font-bold text-purple-600">23</div>
                                </div>
                            </div>
                            <div class="bg-gray-50 rounded-lg p-3">
                                <div class="text-sm text-gray-800">效率提升</div>
                                <div class="text-lg font-bold text-gray-600">23%</div>
                                <div class="text-xs text-gray-500">相比优化前的检测效率提升</div>
                            </div>
                        </div>
                    `
                },
                'knowledge_base': {
                    title: '知识库增长',
                    icon: 'fa-database',
                    color: 'text-purple-600',
                    description: '通过环境感知学习积累的环境特征和威胁模式知识库',
                    details: `
                        <div class="space-y-4">
                            <div class="grid grid-cols-2 gap-4">
                                <div class="bg-green-50 rounded-lg p-3">
                                    <div class="text-sm text-green-800">环境特征</div>
                                    <div class="text-2xl font-bold text-green-600">3,245</div>
                                </div>
                                <div class="bg-orange-50 rounded-lg p-3">
                                    <div class="text-sm text-orange-800">威胁模式</div>
                                    <div class="text-2xl font-bold text-orange-600">1,322</div>
                                </div>
                            </div>
                            <div class="bg-gray-50 rounded-lg p-3">
                                <div class="text-sm text-gray-800">覆盖率</div>
                                <div class="text-lg font-bold text-gray-600">98%</div>
                                <div class="text-xs text-gray-500">对客户环境的特征覆盖程度</div>
                            </div>
                        </div>
                    `
                }
            };
            
            const detail = learningDetails[learningType];
            
            content.innerHTML = `
                <div class="space-y-4">
                    <div class="text-center mb-4">
                        <div class="w-16 h-16 bg-gray-100 rounded-full flex items-center justify-center mx-auto mb-3">
                            <i class="fas ${detail.icon} ${detail.color} text-2xl"></i>
                        </div>
                        <h4 class="text-lg font-semibold text-gray-800">${detail.title}</h4>
                        <p class="text-sm text-gray-600">${detail.description}</p>
                    </div>
                    
                    ${detail.details}
                    
                    <div class="bg-blue-50 rounded-lg p-4">
                        <h5 class="font-medium text-blue-800 mb-2">技术说明</h5>
                        <p class="text-sm text-blue-700">所有学习数据都经过脱敏处理，确保用户隐私安全。AI模型采用联邦学习技术，在本地环境中进行训练和优化。</p>
                    </div>
                    
                    <div class="flex space-x-3">
                        <button onclick="closeLearningModal()" class="flex-1 bg-blue-500 text-white py-2 rounded-lg hover:bg-blue-600">
                            关闭
                        </button>
                    </div>
                </div>
            `;
            
            modal.classList.remove('hidden');
        }

        // 显示通知
        function showNotification(message, type = 'info') {
            const colors = {
                success: 'bg-green-500',
                error: 'bg-red-500',
                warning: 'bg-yellow-500',
                info: 'bg-blue-500'
            };
            
            const notification = document.createElement('div');
            notification.className = `fixed top-4 right-4 ${colors[type]} text-white px-6 py-3 rounded-lg shadow-lg z-50 animate-fade-in`;
            notification.textContent = message;
            
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.remove();
            }, 3000);
        }

        // CSS 样式
        const style = document.createElement('style');
        style.textContent = `
            .tab-btn {
                padding: 0.75rem 1.5rem;
                border-radius: 0.5rem;
                color: #6b7280;
                background: transparent;
                border: none;
                cursor: pointer;
                transition: all 0.2s ease;
                font-weight: 500;
            }
            .tab-btn:hover {
                color: #8b5cf6;
                background: #f3f4f6;
            }
            .tab-btn.active {
                color: #8b5cf6;
                background: #f3f0ff;
                border: 1px solid #e0e7ff;
            }
        `;
        document.head.appendChild(style);

        // 显示规则详情
        function showRuleDetail(ruleName) {
            const rule = intelligentRules.find(r => r.name === ruleName);
            if (!rule) return;

            const modal = document.getElementById('learning-modal');
            const content = document.getElementById('learning-modal-content');
            
            content.innerHTML = `
                <div class="space-y-4">
                    <div class="text-center mb-4">
                        <div class="w-16 h-16 bg-blue-100 rounded-full flex items-center justify-center mx-auto mb-3">
                            <i class="fas fa-info-circle text-blue-600 text-2xl"></i>
                        </div>
                        <h4 class="text-lg font-semibold text-gray-800">${rule.name}</h4>
                        <p class="text-sm text-gray-600">规则详情信息</p>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">特征内容</label>
                        <input type="text" value="${rule.feature}" class="w-full px-3 py-2 border border-gray-300 rounded-lg bg-gray-50" readonly>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">AI学习类型</label>
                        <input type="text" value="${rule.learnType}" class="w-full px-3 py-2 border border-gray-300 rounded-lg bg-gray-50" readonly>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">忽略范围</label>
                        <input type="text" value="${rule.ignoreScope}" class="w-full px-3 py-2 border border-gray-300 rounded-lg bg-gray-50" readonly>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">生效资产</label>
                        <input type="text" value="${rule.assetScope}" class="w-full px-3 py-2 border border-gray-300 rounded-lg bg-gray-50" readonly>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">备注</label>
                        <textarea class="w-full px-3 py-2 border border-gray-300 rounded-lg h-20 resize-none bg-gray-50" readonly>${rule.remark}</textarea>
                    </div>
                    <div class="bg-gray-50 rounded-lg p-4">
                        <h5 class="font-medium text-gray-800 mb-3">规则统计信息</h5>
                        <div class="grid grid-cols-3 gap-3 text-sm">
                            <div class="text-center">
                                <div class="text-ai font-bold">${rule.tuningCount}次</div>
                                <div class="text-xs text-gray-500">调优次数</div>
                            </div>
                            <div class="text-center">
                                <div class="text-blue-600 font-bold">${rule.adaptations}</div>
                                <div class="text-xs text-gray-500">自适应次数</div>
                            </div>
                            <div class="text-center">
                                <div class="text-green-600 font-bold">${rule.confidence}</div>
                                <div class="text-xs text-gray-500">置信度</div>
                            </div>
                        </div>
                    </div>
                    <div class="flex space-x-3">
                        <button onclick="editRule('${rule.name}')" class="flex-1 bg-ai text-white py-2 rounded-lg hover:bg-purple-700">
                            <i class="fas fa-edit mr-2"></i>编辑规则
                        </button>
                        <button onclick="closeLearningModal()" class="px-4 py-2 border border-gray-300 rounded-lg hover:bg-gray-50">
                            关闭
                        </button>
                    </div>
                </div>
            `;
            
            modal.classList.remove('hidden');
        }

        // 编辑规则
        function editRule(ruleName) {
            const rule = intelligentRules.find(r => r.name === ruleName);
            if (!rule) return;

            const modal = document.getElementById('learning-modal');
            const content = document.getElementById('learning-modal-content');
            
            content.innerHTML = `
                <div class="space-y-4">
                    <div class="text-center mb-4">
                        <div class="w-16 h-16 bg-ai/10 rounded-full flex items-center justify-center mx-auto mb-3">
                            <i class="fas fa-edit text-ai text-2xl"></i>
                        </div>
                        <h4 class="text-lg font-semibold text-gray-800">修改AI规则</h4>
                        <p class="text-sm text-gray-600">编辑 <code class="bg-gray-100 px-2 py-1 rounded">${rule.name}</code> 的配置</p>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">特征内容</label>
                        <input type="text" id="edit-feature" value="${rule.feature}" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-ai">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">AI学习类型</label>
                        <select id="edit-learn-type" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-ai">
                            <option value="良性模式识别" ${rule.learnType === '良性模式识别' ? 'selected' : ''}>良性模式识别</option>
                            <option value="运维行为模式" ${rule.learnType === '运维行为模式' ? 'selected' : ''}>运维行为模式</option>
                            <option value="内部域名模式" ${rule.learnType === '内部域名模式' ? 'selected' : ''}>内部域名模式</option>
                            <option value="GPT研判优化" ${rule.learnType === 'GPT研判优化' ? 'selected' : ''}>GPT研判优化</option>
                            <option value="业务特征模式" ${rule.learnType === '业务特征模式' ? 'selected' : ''}>业务特征模式</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">忽略范围</label>
                        <select id="edit-ignore-scope" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-ai">
                            <option value="全局忽略" ${rule.ignoreScope === '全局忽略' ? 'selected' : ''}>全局忽略</option>
                            <option value="仅在Web攻击告警中忽略" ${rule.ignoreScope === '仅在Web攻击告警中忽略' ? 'selected' : ''}>仅在Web攻击告警中忽略</option>
                            <option value="仅在SQL注入告警中忽略" ${rule.ignoreScope === '仅在SQL注入告警中忽略' ? 'selected' : ''}>仅在SQL注入告警中忽略</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">生效资产</label>
                        <select id="edit-asset-scope" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-ai">
                            <option value="全部" ${rule.assetScope === '全部' ? 'selected' : ''}>全部</option>
                            <option value="生产环境资产" ${rule.assetScope === '生产环境资产' ? 'selected' : ''}>生产环境资产</option>
                            <option value="测试环境资产" ${rule.assetScope === '测试环境资产' ? 'selected' : ''}>测试环境资产</option>
                            <option value="办公网资产" ${rule.assetScope === '办公网资产' ? 'selected' : ''}>办公网资产</option>
                            <option value="DMZ区域资产" ${rule.assetScope === 'DMZ区域资产' ? 'selected' : ''}>DMZ区域资产</option>
                            <option value="核心业务资产" ${rule.assetScope === '核心业务资产' ? 'selected' : ''}>核心业务资产</option>
                            <option value="Web服务器" ${rule.assetScope === 'Web服务器' ? 'selected' : ''}>Web服务器</option>
                            <option value="数据库服务器" ${rule.assetScope === '数据库服务器' ? 'selected' : ''}>数据库服务器</option>
                            <option value="应用服务器" ${rule.assetScope === '应用服务器' ? 'selected' : ''}>应用服务器</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">备注</label>
                        <textarea id="edit-remark" class="w-full px-3 py-2 border border-gray-300 rounded-lg h-20 resize-none focus:outline-none focus:ring-2 focus:ring-ai">${rule.remark}</textarea>
                    </div>
                    <div class="flex space-x-3">
                        <button onclick="saveRuleEdit('${rule.name}')" class="flex-1 bg-ai text-white py-2 rounded-lg hover:bg-purple-700">
                            <i class="fas fa-save mr-2"></i>保存修改
                        </button>
                        <button onclick="closeLearningModal()" class="px-4 py-2 border border-gray-300 rounded-lg hover:bg-gray-50">
                            取消
                        </button>
                    </div>
                </div>
            `;
            
            modal.classList.remove('hidden');
        }

        // 保存规则编辑
        function saveRuleEdit(ruleName) {
            const feature = document.getElementById('edit-feature').value.trim();
            const learnType = document.getElementById('edit-learn-type').value;
            const ignoreScope = document.getElementById('edit-ignore-scope').value;
            const assetScope = document.getElementById('edit-asset-scope').value;
            const remark = document.getElementById('edit-remark').value.trim();

            if (!feature) {
                showNotification('请填写特征内容', 'error');
                return;
            }

            // 更新规则数据
            const ruleIndex = intelligentRules.findIndex(r => r.name === ruleName);
            if (ruleIndex !== -1) {
                intelligentRules[ruleIndex] = {
                    ...intelligentRules[ruleIndex],
                    feature,
                    learnType,
                    ignoreScope,
                    assetScope,
                    remark,
                    lastOptimized: '刚刚'
                };
            }

            showNotification('AI规则已更新', 'success');
            closeLearningModal();
            
            // 重新渲染规则列表
            initializeCustomRules();
        }

        // 处置知识库相关函数
        function refreshDisposalSuggestions() {
            showNotification('AI建议已刷新', 'success');
            // 这里可以添加实际的刷新逻辑
        }

        function applyDisposalSuggestion(suggestionType) {
            const suggestions = {
                'auto-health-check': {
                    title: '自动化健康检查告警',
                    message: '已为健康检查告警配置自动化处理规则',
                    effect: '预计节省95%的处理时间'
                },
                'optimize-brute-force': {
                    title: '优化暴力破解攻击处置',
                    message: '已调整暴力破解攻击的监控策略为预防型',
                    effect: '预计提升40%的防护效果'
                },
                'improve-collaboration': {
                    title: '改善业务协作机制',
                    message: '已建立与业务方的快速响应机制',
                    effect: '预计提升60%的响应速度'
                },
                'backup-verification': {
                    title: '增强数据安全保护',
                    message: '已配置高危事件处置时的备份验证流程',
                    effect: '预计提升80%的数据安全'
                }
            };

            const suggestion = suggestions[suggestionType];
            if (suggestion) {
                showNotification(`${suggestion.message}。${suggestion.effect}`, 'success');
                
                // 可以在这里添加实际的应用逻辑
                console.log('应用处置建议:', suggestion);
            } else {
                showNotification('未知的建议类型', 'error');
            }
        }

        // 初始化处置知识库数据
        function initializeDisposalKnowledge() {
            // 模拟处置习惯统计数据
            const disposalStats = {
                totalHabits: 23,
                todayNew: 5,
                categories: {
                    highRisk: 8,
                    mediumRisk: 7,
                    lowRisk: 5,
                    business: 3
                }
            };

            // 更新页面统计数据
            const statsElements = document.querySelectorAll('[data-disposal-stat]');
            statsElements.forEach(element => {
                const statType = element.getAttribute('data-disposal-stat');
                if (disposalStats[statType]) {
                    element.textContent = disposalStats[statType];
                }
            });

            console.log('处置知识库初始化完成', disposalStats);
        }

        // 业务流知识操作函数
        function confirmBusinessFlow(id) {
            const row = document.querySelector(`tr:has([data-id="${id}"])`);
            if (row) {
                const statusCell = row.querySelector('td:nth-child(5) span');
                statusCell.className = 'inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-green-100 text-green-800';
                statusCell.textContent = '已确认';
                
                // 隐藏确认按钮
                const confirmBtn = row.querySelector('button[onclick*="confirmBusinessFlow"]');
                if (confirmBtn) {
                    confirmBtn.style.display = 'none';
                }
                
                // 显示成功提示
                showNotification('业务流已确认为正常流量', 'success');
            }
        }

        function editBusinessFlow(id) {
            const row = document.querySelector(`tr:has([data-id="${id}"])`);
            if (row) {
                const nameCell = row.querySelector('.editable-name');
                const currentName = nameCell.textContent;
                
                // 创建现代化编辑对话框
                showEditDialog(currentName, (newName) => {
                    if (newName && newName !== currentName) {
                        nameCell.textContent = newName;
                        showNotification('业务流名称已更新', 'success');
                    }
                });
            }
        }

        function showEditDialog(currentName, callback) {
            // 创建模态对话框背景
            const backdrop = document.createElement('div');
            backdrop.className = 'fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4';
            backdrop.style.animation = 'fadeIn 0.2s ease-out';

            // 创建对话框内容
            backdrop.innerHTML = `
                <div class="bg-white rounded-xl shadow-2xl max-w-md w-full transform transition-all duration-200 scale-95 opacity-0" id="edit-dialog">
                    <div class="p-6">
                        <!-- 头部 -->
                        <div class="flex items-center space-x-3 mb-6">
                            <div class="w-10 h-10 bg-blue-100 rounded-lg flex items-center justify-center">
                                <i class="fas fa-edit text-blue-600 text-lg"></i>
                            </div>
                            <div>
                                <h3 class="text-lg font-semibold text-gray-900">编辑业务流名称</h3>
                                <p class="text-sm text-gray-600">请输入更符合业务场景的描述名称</p>
                            </div>
                        </div>
                        
                        <!-- 输入框 -->
                        <div class="mb-6">
                            <label class="block text-sm font-medium text-gray-700 mb-2">业务流名称</label>
                            <input type="text" id="business-flow-name-input" 
                                   value="${currentName}" 
                                   class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                                   placeholder="请输入业务流名称...">
                        </div>
                        
                        <!-- 按钮 -->
                        <div class="flex justify-end space-x-3">
                            <button onclick="closeEditDialog()" 
                                    class="px-4 py-2 text-gray-600 bg-gray-100 rounded-lg hover:bg-gray-200 transition-colors">
                                取消
                            </button>
                            <button onclick="confirmEdit()" 
                                    class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors">
                                确认修改
                            </button>
                        </div>
                    </div>
                </div>
            `;

            document.body.appendChild(backdrop);

            // 显示动画
            setTimeout(() => {
                const dialog = document.getElementById('edit-dialog');
                dialog.classList.remove('scale-95', 'opacity-0');
                dialog.classList.add('scale-100', 'opacity-100');
            }, 10);

            // 聚焦输入框
            setTimeout(() => {
                const input = document.getElementById('business-flow-name-input');
                input.focus();
                input.select();
            }, 200);

            // 保存回调函数
            window.editCallback = callback;

            // ESC键关闭
            const handleEsc = (e) => {
                if (e.key === 'Escape') {
                    closeEditDialog();
                }
            };
            document.addEventListener('keydown', handleEsc);
            window.editDialogEscHandler = handleEsc;

            // Enter键确认
            const handleEnter = (e) => {
                if (e.key === 'Enter') {
                    confirmEdit();
                }
            };
            document.getElementById('business-flow-name-input').addEventListener('keydown', handleEnter);
        }

        function closeEditDialog() {
            const backdrop = document.querySelector('.fixed.inset-0.bg-black.bg-opacity-50');
            if (backdrop) {
                const dialog = document.getElementById('edit-dialog');
                dialog.classList.add('scale-95', 'opacity-0');
                
                setTimeout(() => {
                    document.body.removeChild(backdrop);
                    if (window.editDialogEscHandler) {
                        document.removeEventListener('keydown', window.editDialogEscHandler);
                        delete window.editDialogEscHandler;
                    }
                    delete window.editCallback;
                }, 200);
            }
        }

        function confirmEdit() {
            const input = document.getElementById('business-flow-name-input');
            const newName = input.value.trim();
            
            if (newName && window.editCallback) {
                window.editCallback(newName);
            }
            
            closeEditDialog();
        }

        function ignoreBusinessFlow(id) {
            const row = document.querySelector(`tr:has([data-id="${id}"])`);
            if (row) {
                const statusCell = row.querySelector('td:nth-child(5) span');
                statusCell.className = 'inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-gray-100 text-gray-800';
                statusCell.textContent = '已忽略';
                
                // 隐藏确认和忽略按钮
                const confirmBtn = row.querySelector('button[onclick*="confirmBusinessFlow"]');
                const ignoreBtn = row.querySelector('button[onclick*="ignoreBusinessFlow"]');
                if (confirmBtn) confirmBtn.style.display = 'none';
                if (ignoreBtn) ignoreBtn.style.display = 'none';
                
                // 显示成功提示
                showNotification('业务流已标记为忽略', 'warning');
            }
        }

        // 通知提示函数
        function showNotification(message, type = 'info') {
            const notification = document.createElement('div');
            notification.className = `fixed top-4 right-4 z-50 px-4 py-3 rounded-lg shadow-lg transition-all duration-300 transform translate-x-full`;
            
            const colors = {
                success: 'bg-green-500 text-white',
                warning: 'bg-yellow-500 text-white',
                error: 'bg-red-500 text-white',
                info: 'bg-blue-500 text-white'
            };
            
            notification.className += ` ${colors[type] || colors.info}`;
            notification.innerHTML = `
                <div class="flex items-center space-x-2">
                    <i class="fas fa-${type === 'success' ? 'check' : type === 'warning' ? 'exclamation-triangle' : type === 'error' ? 'times' : 'info'}-circle"></i>
                    <span>${message}</span>
                </div>
            `;
            
            document.body.appendChild(notification);
            
            // 显示动画
            setTimeout(() => {
                notification.classList.remove('translate-x-full');
            }, 100);
            
            // 自动隐藏
            setTimeout(() => {
                notification.classList.add('translate-x-full');
                setTimeout(() => {
                    document.body.removeChild(notification);
                }, 300);
            }, 3000);
        }

        // 搜索和筛选功能
        document.addEventListener('DOMContentLoaded', function() {
            const searchInput = document.getElementById('business-flow-search');
            const statusFilter = document.getElementById('status-filter');
            const confidenceFilter = document.getElementById('confidence-filter');
            
            if (searchInput) {
                searchInput.addEventListener('input', filterBusinessFlows);
            }
            if (statusFilter) {
                statusFilter.addEventListener('change', filterBusinessFlows);
            }
            if (confidenceFilter) {
                confidenceFilter.addEventListener('change', filterBusinessFlows);
            }
        });

        function filterBusinessFlows() {
            const searchTerm = document.getElementById('business-flow-search')?.value.toLowerCase() || '';
            const statusFilter = document.getElementById('status-filter')?.value || '';
            const confidenceFilter = document.getElementById('confidence-filter')?.value || '';
            
            const rows = document.querySelectorAll('#business-flow-list tr');
            
            rows.forEach(row => {
                const name = row.querySelector('td:first-child')?.textContent.toLowerCase() || '';
                const entities = row.querySelector('td:nth-child(2)')?.textContent.toLowerCase() || '';
                const protocol = row.querySelector('td:nth-child(3)')?.textContent.toLowerCase() || '';
                const reason = row.querySelector('td:nth-child(4)')?.textContent.toLowerCase() || '';
                const status = row.querySelector('td:nth-child(6) span')?.textContent || '';
                const confidenceText = row.querySelector('td:nth-child(5) span')?.textContent || '';
                const confidence = parseInt(confidenceText.replace('%', '')) || 0;
                
                let show = true;
                
                // 搜索过滤
                if (searchTerm && !name.includes(searchTerm) && !entities.includes(searchTerm) && !protocol.includes(searchTerm) && !reason.includes(searchTerm)) {
                    show = false;
                }
                
                // 状态过滤
                if (statusFilter && status !== statusFilter) {
                    show = false;
                }
                
                // 置信度过滤
                if (confidenceFilter) {
                    if (confidenceFilter === 'high' && confidence < 90) {
                        show = false;
                    } else if (confidenceFilter === 'medium' && (confidence < 70 || confidence >= 90)) {
                        show = false;
                    } else if (confidenceFilter === 'low' && confidence >= 70) {
                        show = false;
                    }
                }
                
                row.style.display = show ? '' : 'none';
            });
        }
    </script>
</body>
</html> 
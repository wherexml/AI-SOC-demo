<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å®‰å…¨å·¥ä½œæµç¼–æ’å¹³å° - XDR AI 2.0</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://unpkg.com/jsplumb@2.15.6/dist/js/jsplumb.min.js"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#1e40af',
                        secondary: '#64748b',
                        accent: '#3b82f6',
                        danger: '#ef4444',
                        warning: '#f59e0b',
                        success: '#10b981'
                    }
                }
            }
        }
    </script>
    <style>
        .workflow-canvas {
            background-image: radial-gradient(circle, #d1d5db 1px, transparent 1px);
            background-size: 20px 20px;
            position: relative;
            user-select: none;
        }
        .workflow-viewport {
            position: relative;
            width: 100%;
            height: 100%;
            overflow: hidden;
            cursor: grab;
        }
        .workflow-viewport:active {
            cursor: grabbing;
        }
        .workflow-container {
            position: absolute;
            width: 10000px;
            height: 10000px;
            transform-origin: 0 0;
            transition: transform 0.1s ease-out;
        }
        .canvas-controls {
            position: absolute;
            top: 10px;
            right: 10px;
            z-index: 100;
            display: flex;
            flex-direction: column;
            gap: 8px;
        }
        .canvas-control-btn {
            width: 36px;
            height: 36px;
            background: white;
            border: 1px solid #e5e7eb;
            border-radius: 6px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            transition: all 0.2s ease;
        }
        .canvas-control-btn:hover {
            background: #f9fafb;
            box-shadow: 0 4px 8px rgba(0,0,0,0.15);
        }
        .minimap {
            position: absolute;
            bottom: 20px;
            right: 20px;
            width: 200px;
            height: 150px;
            background: white;
            border: 2px solid #e5e7eb;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            z-index: 100;
            overflow: hidden;
        }
        .minimap-content {
            width: 100%;
            height: 100%;
            position: relative;
            background: #f9fafb;
        }
        .minimap-viewport {
            position: absolute;
            border: 2px solid #3b82f6;
            background: rgba(59, 130, 246, 0.1);
            cursor: pointer;
        }
        .minimap-node {
            position: absolute;
            background: #6b7280;
            border-radius: 2px;
            width: 8px;
            height: 6px;
        }
        .coordinates-display {
            position: absolute;
            bottom: 20px;
            left: 20px;
            background: white;
            border: 1px solid #e5e7eb;
            border-radius: 6px;
            padding: 8px 12px;
            font-size: 12px;
            color: #6b7280;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            z-index: 100;
        }
        .draggable-node {
            cursor: move;
            transition: all 0.2s ease;
            position: relative;
        }
        .draggable-node:hover {
            transform: scale(1.02);
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        }
        .draggable-node:hover .connection-hint {
            opacity: 1;
        }
        .connection-hint {
            position: absolute;
            top: -25px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0,0,0,0.8);
            color: white;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 10px;
            opacity: 0;
            transition: opacity 0.2s ease;
            pointer-events: none;
            white-space: nowrap;
            z-index: 1000;
        }
        .node-trigger { border-left: 4px solid #10b981; }
        .node-ai { border-left: 4px solid #3b82f6; }
        .node-agent { border-left: 4px solid #8b5cf6; }
        .node-soar { border-left: 4px solid #f59e0b; }
        .node-human { border-left: 4px solid #ef4444; }
        .node-logic { border-left: 4px solid #64748b; }
        .node-comment { border-left: 4px solid #f59e0b; background: #fefce8; }
        .node-group { border: 2px dashed #6366f1; background: rgba(99, 102, 241, 0.05); }
        
        .connector-endpoint {
            width: 10px;
            height: 10px;
            border-radius: 50%;
            position: absolute;
            cursor: crosshair;
        }
        .endpoint-source {
            background: #10b981;
            right: -5px;
            top: 50%;
            transform: translateY(-50%);
        }
        .endpoint-target {
            background: #ef4444;
            left: -5px;
            top: 50%;
            transform: translateY(-50%);
        }
        
        .sidebar-collapsed {
            width: 60px;
        }
        .sidebar-expanded {
            width: 280px;
        }
        
        .debug-highlight {
            animation: pulse 2s infinite;
            border: 2px solid #f59e0b !important;
        }
        
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }

        /* å³é”®èœå•æ ·å¼ */
        .context-menu {
            position: fixed;
            background: white;
            border: 1px solid #e5e7eb;
            border-radius: 8px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.15);
            z-index: 1000;
            min-width: 120px;
            display: none;
        }
        .context-menu-item {
            padding: 8px 12px;
            cursor: pointer;
            transition: background 0.2s;
            font-size: 14px;
            border-bottom: 1px solid #f3f4f6;
        }
        .context-menu-item:last-child {
            border-bottom: none;
        }
        .context-menu-item:hover {
            background: #f9fafb;
        }
        .context-menu-item.danger:hover {
            background: #fee2e2;
            color: #dc2626;
        }
        
        /* è¿æ¥æ¨¡å¼å’Œç«¯ç‚¹å¢å¼ºæ ·å¼ */
        body.connecting-mode {
            cursor: crosshair !important;
        }
        body.connecting-mode * {
            cursor: crosshair !important;
        }
        .endpoint-highlight {
            animation: pulse-endpoint 1.5s infinite;
        }
        @keyframes pulse-endpoint {
            0% { transform: scale(1); opacity: 1; }
            50% { transform: scale(1.3); opacity: 0.8; }
            100% { transform: scale(1); opacity: 1; }
        }
        
        /* è¿æ¥ç‚¹é»˜è®¤éšè— */
        .jtk-endpoint {
            opacity: 0;
            transition: opacity 0.3s ease;
        }
        
        /* èŠ‚ç‚¹æ‚¬åœæˆ–æ¿€æ´»æ—¶æ˜¾ç¤ºè¿æ¥ç‚¹ */
        .workflow-node:hover .jtk-endpoint,
        .workflow-node.show-endpoints .jtk-endpoint {
            opacity: 1;
        }
        
        /* è¿æ¥æŒ‡å¼• - åªåœ¨æ‚¬åœæ—¶æ˜¾ç¤º */
        .workflow-node:hover::after {
            content: '';
            position: absolute;
            top: 50%;
            right: -15px;
            width: 12px;
            height: 12px;
            background: #10b981;
            border-radius: 50%;
            transform: translateY(-50%);
            box-shadow: 0 0 0 3px rgba(16, 185, 129, 0.3);
            animation: pulse-connection-hint 2s infinite;
        }
        .workflow-node:hover::before {
            content: '';
            position: absolute;
            top: 50%;
            left: -15px;
            width: 12px;
            height: 12px;
            background: #ef4444;
            border-radius: 50%;
            transform: translateY(-50%);
            box-shadow: 0 0 0 3px rgba(239, 68, 68, 0.3);
            animation: pulse-connection-hint 2s infinite;
        }
        @keyframes pulse-connection-hint {
            0% { opacity: 0.6; transform: translateY(-50%) scale(1); }
            50% { opacity: 1; transform: translateY(-50%) scale(1.1); }
            100% { opacity: 0.6; transform: translateY(-50%) scale(1); }
        }
        
        /* è”ç»œå‘˜AgentèŠ‚ç‚¹å¢å¼ºæ ·å¼ */
        .agent-enhanced {
            border: 2px solid #8b5cf6;
            box-shadow: 0 4px 12px rgba(139, 92, 246, 0.2);
        }
        
        .agent-enhanced:hover {
            box-shadow: 0 8px 25px rgba(139, 92, 246, 0.3);
        }
        
        /* è¾“å‡ºé”šç‚¹æ ‡è®° */
        .output-anchor-marker {
            opacity: 0;
            transition: all 0.3s ease;
            z-index: 10;
        }
        
        .agent-enhanced:hover .output-anchor-marker {
            opacity: 1;
            animation: pulse-anchor 2s infinite;
        }
        
        @keyframes pulse-anchor {
            0%, 100% { transform: translateX(50%) translateY(-50%) scale(1); opacity: 0.8; }
            50% { transform: translateX(50%) translateY(-50%) scale(1.2); opacity: 1; }
        }
        
        /* ç«¯ç‚¹æ ‡ç­¾æ ·å¼ */
        .endpoint-label {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            white-space: nowrap;
            pointer-events: none;
            z-index: 1000;
            opacity: 0;
            transition: opacity 0.3s ease;
        }
        
        .agent-enhanced:hover .endpoint-label {
            opacity: 1;
        }
        
        /* é¡µç­¾æ ·å¼ */
        .tab-button {
            transition: all 0.2s ease;
            cursor: pointer;
        }
        
        .tab-button:hover {
            border-bottom-color: #93c5fd !important;
        }
        
        .tab-content {
            transition: opacity 0.3s ease;
        }
        
        /* æ¨¡æ¿é€‰æ‹©å™¨å¼ºè°ƒæ ·å¼ */
        #templateSelect {
            transition: all 0.3s ease;
        }
        
        #templateSelect:focus {
            border-color: #3b82f6;
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
        }
        
        /* æŒ‡ä»¤é…ç½®è¡¨æ ¼æ ·å¼ */
        .command-row {
            background: white;
            border: 1px solid #e5e7eb;
            border-radius: 6px;
            padding: 8px;
            margin-bottom: 8px;
            transition: all 0.2s ease;
        }
        
        .command-row:hover {
            border-color: #3b82f6;
            box-shadow: 0 2px 8px rgba(59, 130, 246, 0.1);
        }
        
        .command-row input {
            transition: border-color 0.2s ease;
        }
        
        .command-row input:focus {
            border-color: #3b82f6;
            outline: none;
            box-shadow: 0 0 0 2px rgba(59, 130, 246, 0.1);
        }
        
        /* è¿æ¥æ ‡ç­¾æ ·å¼ */
        .connection-label {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            white-space: nowrap;
            pointer-events: none;
            z-index: 1000;
            border: 1px solid #c084fc;
            backdrop-filter: blur(4px);
        }
        
        /* å·¥ä½œæµèŠ‚ç‚¹ä¼˜åŒ– */
        .workflow-node {
            border-radius: 12px;
            transition: all 0.3s ease;
        }

        /* å±æ€§é¢æ¿æ»šåŠ¨æ ·å¼ */
        #propertiesPanel .flex-1 {
            scrollbar-width: thin;
            scrollbar-color: #d1d5db #f9fafb;
        }

        #propertiesPanel .flex-1::-webkit-scrollbar {
            width: 6px;
        }

        #propertiesPanel .flex-1::-webkit-scrollbar-track {
            background: #f9fafb;
            border-radius: 3px;
        }

        #propertiesPanel .flex-1::-webkit-scrollbar-thumb {
            background: #d1d5db;
            border-radius: 3px;
        }

        #propertiesPanel .flex-1::-webkit-scrollbar-thumb:hover {
            background: #9ca3af;
        }

        /* ç¡®ä¿é¢æ¿é«˜åº¦æ­£ç¡® */
        #propertiesPanel {
            height: 100vh;
        }

        #propertiesPanel .flex-1 {
            min-height: 0;
            overflow-y: auto;
            max-height: calc(100vh - 80px); /* å‡å»å¤´éƒ¨é«˜åº¦ */
        }
        
        .workflow-node:hover {
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
        }
        
        /* è”ç»œå‘˜AgentèŠ‚ç‚¹ç‰¹æ®Šæ ‡è¯† */
        .node-agent .font-semibold::after {
            content: " ğŸ¤–";
            font-size: 14px;
        }
    </style>
</head>
<body class="bg-gray-50 h-screen overflow-hidden">
    <!-- ä¸»é¡µé¢ï¼šæ¨¡æ¿å•†åº— -->
    <div id="templateStorePage" class="min-h-screen bg-gray-50">
        <!-- é¡¶éƒ¨å¯¼èˆªå’Œç»Ÿè®¡ -->
        <div class="bg-white shadow-sm">
            <!-- ä¸»å¯¼èˆª -->
            <div class="border-b border-gray-200 px-6 py-4">
                <div class="flex items-center justify-between">
                    <div class="flex items-center space-x-4">
                        <div class="flex items-center space-x-3">
                            <div class="w-10 h-10 bg-gradient-to-r from-blue-500 to-purple-600 rounded-xl flex items-center justify-center">
                                <i class="fas fa-project-diagram text-white text-lg"></i>
                            </div>
                            <div>
                                <h1 class="text-xl font-bold text-gray-900">å®‰å…¨å·¥ä½œæµç¼–æ’å¹³å°</h1>
                                <p class="text-sm text-gray-500">XDR AI SecOps 2.0</p>
                            </div>
                        </div>
                        <div class="h-8 w-px bg-gray-300"></div>
                        <nav class="flex items-center space-x-6">
                            <button id="homeBtn" class="px-3 py-2 text-sm font-medium text-purple-600 bg-purple-50 rounded-lg">
                                <i class="fas fa-home mr-2"></i>å·¥ä½œæµå•†åº—
                            </button>
                            <button id="editorBtn" class="px-3 py-2 text-sm font-medium text-gray-600 hover:text-gray-900 hover:bg-gray-100 rounded-lg transition-colors">
                                <i class="fas fa-edit mr-2"></i>æµç¨‹ç¼–è¾‘å™¨
                            </button>
                            <button id="monitorBtn" class="px-3 py-2 text-sm font-medium text-gray-600 hover:text-gray-900 hover:bg-gray-100 rounded-lg transition-colors">
                                <i class="fas fa-chart-line mr-2"></i>è¿è¡Œç›‘æ§
                            </button>
                        </nav>
                    </div>
                    <div class="flex items-center space-x-4">
                        <div class="text-sm text-gray-500 flex items-center">
                            <span class="w-2 h-2 bg-green-500 rounded-full mr-2"></span>
                            ç³»ç»Ÿè¿è¡Œæ­£å¸¸
                        </div>
                        <button class="p-2 text-gray-500 hover:text-gray-700 rounded-lg hover:bg-gray-100" title="å¸®åŠ©">
                            <i class="fas fa-question-circle"></i>
                        </button>
                        <button class="p-2 text-gray-500 hover:text-gray-700 rounded-lg hover:bg-gray-100" title="è®¾ç½®">
                            <i class="fas fa-cog"></i>
                        </button>
                    </div>
                </div>
            </div>
            
            <!-- ç»Ÿè®¡ä»ªè¡¨æ¿ -->
            <div class="px-6 py-4">
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
                    <div class="bg-gradient-to-r from-blue-500 to-blue-600 rounded-xl p-4 text-white">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-blue-100 text-sm">ä»Šæ—¥æ‰§è¡Œ</p>
                                <p class="text-2xl font-bold">1,247</p>
                                <p class="text-xs text-blue-200 mt-1">
                                    <i class="fas fa-arrow-up mr-1"></i>+12.5% è¾ƒæ˜¨æ—¥
                                </p>
                            </div>
                            <div class="w-12 h-12 bg-white bg-opacity-20 rounded-lg flex items-center justify-center">
                                <i class="fas fa-play text-xl"></i>
                            </div>
                        </div>
                    </div>
                    
                    <div class="bg-gradient-to-r from-green-500 to-green-600 rounded-xl p-4 text-white">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-green-100 text-sm">æˆåŠŸç‡</p>
                                <p class="text-2xl font-bold">98.2%</p>
                                <p class="text-xs text-green-200 mt-1">
                                    <i class="fas fa-arrow-up mr-1"></i>+0.3% è¾ƒæ˜¨æ—¥
                                </p>
                            </div>
                            <div class="w-12 h-12 bg-white bg-opacity-20 rounded-lg flex items-center justify-center">
                                <i class="fas fa-check-circle text-xl"></i>
                            </div>
                        </div>
                    </div>
                    
                    <div class="bg-gradient-to-r from-orange-500 to-orange-600 rounded-xl p-4 text-white">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-orange-100 text-sm">æ´»è·ƒå·¥ä½œæµ</p>
                                <p class="text-2xl font-bold">23</p>
                                <p class="text-xs text-orange-200 mt-1">
                                    <i class="fas fa-arrow-right mr-1"></i>è¿è¡Œä¸­
                                </p>
                            </div>
                            <div class="w-12 h-12 bg-white bg-opacity-20 rounded-lg flex items-center justify-center">
                                <i class="fas fa-stream text-xl"></i>
                            </div>
                        </div>
                    </div>
                    
                    <div class="bg-gradient-to-r from-purple-500 to-purple-600 rounded-xl p-4 text-white">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-purple-100 text-sm">å¹³å‡å“åº”æ—¶é—´</p>
                                <p class="text-2xl font-bold">2.3s</p>
                                <p class="text-xs text-purple-200 mt-1">
                                    <i class="fas fa-arrow-down mr-1"></i>-0.5s è¾ƒæ˜¨æ—¥
                                </p>
                            </div>
                            <div class="w-12 h-12 bg-white bg-opacity-20 rounded-lg flex items-center justify-center">
                                <i class="fas fa-clock text-xl"></i>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- æ¨¡æ¿å•†åº—å†…å®¹åŒºåŸŸ -->
        <div class="px-6 py-8">
            <div class="max-w-7xl mx-auto">
                <div class="mb-8">
                    <h2 class="text-2xl font-bold text-gray-900 mb-2">Workflowæ¨¡æ¿å•†åº—</h2>
                    <p class="text-gray-600">é€‰æ‹©é¢„æ„å»ºçš„å®‰å…¨è¿è¥å·¥ä½œæµæ¨¡æ¿ï¼Œå¿«é€Ÿå¼€å§‹æ‚¨çš„è‡ªåŠ¨åŒ–ä¹‹æ—…</p>
                </div>
                
                <!-- æœç´¢å’Œç­›é€‰ -->
                <div class="mb-8 flex items-center justify-between">
                    <div class="flex items-center space-x-4">
                        <div class="relative">
                            <input type="text" placeholder="æœç´¢æ¨¡æ¿..." 
                                   class="w-64 pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                            <i class="fas fa-search absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400"></i>
                        </div>
                        <select class="px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                            <option>æ‰€æœ‰ç±»åˆ«</option>
                            <option>å‘Šè­¦äº‹ä»¶å¨èƒè¿è¥</option>
                            <option>èµ„äº§æ¼æ´é£é™©ç®¡ç†</option>
                        </select>
                    </div>
                    <div class="flex items-center space-x-2 text-sm text-gray-500">
                        <span>å…± 10 ä¸ªæ¨¡æ¿</span>
                        <div class="w-px h-4 bg-gray-300"></div>
                        <button class="text-blue-600 hover:text-blue-700">æœ€æ–°</button>
                        <button class="text-gray-500 hover:text-gray-700">æœ€çƒ­</button>
                        <button class="text-gray-500 hover:text-gray-700">æ¨è</button>
                    </div>
                </div>
                
                <!-- æ¨¡æ¿å¡ç‰‡å±•ç¤ºåŒºåŸŸ -->
                <div class="space-y-12">
                    <!-- å‘Šè­¦äº‹ä»¶å¨èƒè¿è¥ç±» -->
                    <div>
                        <h3 class="text-xl font-bold text-gray-900 mb-6 flex items-center">
                            <i class="fas fa-exclamation-triangle text-red-500 mr-3"></i>
                            å‘Šè­¦äº‹ä»¶å¨èƒè¿è¥ç±»
                            <span class="ml-3 text-sm font-normal text-gray-500 bg-red-50 px-2 py-1 rounded-full">5ä¸ªæ¨¡æ¿</span>
                        </h3>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                            <div class="template-card bg-white border-2 border-gray-200 rounded-xl p-6 cursor-pointer hover:border-blue-500 hover:shadow-lg transition-all duration-300 group" 
                                 data-template="demo-agent-contact">
                                <div class="flex items-start justify-between mb-4">
                                    <div class="w-12 h-12 bg-gradient-to-r from-purple-400 to-purple-600 rounded-lg flex items-center justify-center group-hover:scale-110 transition-transform">
                                        <i class="fas fa-user-tie text-white text-xl"></i>
                                    </div>
                                    <span class="bg-purple-100 text-purple-800 text-xs px-2 py-1 rounded-full">æ¼”ç¤º</span>
                                </div>
                                <h5 class="text-lg font-semibold text-gray-900 mb-2 group-hover:text-blue-600 transition-colors">æ¼”ç¤ºè”ç»œå‘˜Agent</h5>
                                <p class="text-gray-600 text-sm mb-4">æ™ºèƒ½å®‰å…¨è¿è¥ä¸“å®¶ï¼Œå°†JSONäº‹ä»¶è½¬æ¢ä¸ºä¸“ä¸šä¼å¾®é€šçŸ¥æ¶ˆæ¯</p>
                                <div class="flex items-center justify-between">
                                    <div class="flex items-center text-xs text-gray-500">
                                        <i class="fas fa-clock mr-1"></i>
                                        <span>é¢„è®¡æ‰§è¡Œæ—¶é—´: 1-2åˆ†é’Ÿ</span>
                                    </div>
                                    <div class="text-xs text-gray-400">
                                        <i class="fas fa-download mr-1"></i>æ–°åŠŸèƒ½
                                    </div>
                                </div>
                            </div>

                            <div class="template-card bg-white border-2 border-gray-200 rounded-xl p-6 cursor-pointer hover:border-blue-500 hover:shadow-lg transition-all duration-300 group" 
                                 data-template="internet-attack-block">
                                <div class="flex items-start justify-between mb-4">
                                    <div class="w-12 h-12 bg-gradient-to-r from-red-400 to-red-600 rounded-lg flex items-center justify-center group-hover:scale-110 transition-transform">
                                        <i class="fas fa-shield-alt text-white text-xl"></i>
                                    </div>
                                    <span class="bg-red-100 text-red-800 text-xs px-2 py-1 rounded-full">çƒ­é—¨</span>
                                </div>
                                <h5 class="text-lg font-semibold text-gray-900 mb-2 group-hover:text-blue-600 transition-colors">äº’è”ç½‘æ”»å‡»è‡ªåŠ¨åŒ–é˜»æ–­æµç¨‹</h5>
                                <p class="text-gray-600 text-sm mb-4">å‘ç”Ÿå¤–åˆ°å†…çœŸå®æ”»å‡»å‘Šè­¦ï¼Œå®ä½“åˆ†æåç¡®è®¤æ˜¯å¦å°å µ</p>
                                <div class="flex items-center justify-between">
                                    <div class="flex items-center text-xs text-gray-500">
                                        <i class="fas fa-clock mr-1"></i>
                                        <span>é¢„è®¡æ‰§è¡Œæ—¶é—´: 2-5åˆ†é’Ÿ</span>
                                    </div>
                                    <div class="text-xs text-gray-400">
                                        <i class="fas fa-download mr-1"></i>1,247æ¬¡ä½¿ç”¨
                                    </div>
                                </div>
                            </div>

                            <div class="template-card bg-white border-2 border-gray-200 rounded-xl p-6 cursor-pointer hover:border-blue-500 hover:shadow-lg transition-all duration-300 group" 
                                 data-template="security-incident-response">
                                <div class="flex items-start justify-between mb-4">
                                    <div class="w-12 h-12 bg-gradient-to-r from-orange-400 to-orange-600 rounded-lg flex items-center justify-center group-hover:scale-110 transition-transform">
                                        <i class="fas fa-fire text-white text-xl"></i>
                                    </div>
                                    <span class="bg-orange-100 text-orange-800 text-xs px-2 py-1 rounded-full">æ¨è</span>
                                </div>
                                <h5 class="text-lg font-semibold text-gray-900 mb-2 group-hover:text-blue-600 transition-colors">é‡å¤§å®‰å…¨äº‹ä»¶åº”æ€¥å“åº”æµç¨‹</h5>
                                <p class="text-gray-600 text-sm mb-4">è§¦å‘é‡è¦çš„å®‰å…¨äº‹ä»¶åï¼Œè‡ªåŠ¨åŒ–è°ƒæŸ¥ã€åˆ†æã€ç¡®è®¤ä¸å“åº”æµç¨‹</p>
                                <div class="flex items-center justify-between">
                                    <div class="flex items-center text-xs text-gray-500">
                                        <i class="fas fa-clock mr-1"></i>
                                        <span>é¢„è®¡æ‰§è¡Œæ—¶é—´: 10-30åˆ†é’Ÿ</span>
                                    </div>
                                    <div class="text-xs text-gray-400">
                                        <i class="fas fa-download mr-1"></i>892æ¬¡ä½¿ç”¨
                                    </div>
                                </div>
                            </div>

                            <div class="template-card bg-white border-2 border-gray-200 rounded-xl p-6 cursor-pointer hover:border-blue-500 hover:shadow-lg transition-all duration-300 group" 
                                 data-template="phishing-notification">
                                <div class="flex items-start justify-between mb-4">
                                    <div class="w-12 h-12 bg-gradient-to-r from-yellow-400 to-yellow-600 rounded-lg flex items-center justify-center group-hover:scale-110 transition-transform">
                                        <i class="fas fa-fish text-white text-xl"></i>
                                    </div>
                                </div>
                                <h5 class="text-lg font-semibold text-gray-900 mb-2 group-hover:text-blue-600 transition-colors">é’“é±¼äº‹ä»¶é€šçŸ¥ä¸é—­ç¯æµç¨‹</h5>
                                <p class="text-gray-600 text-sm mb-4">ç”¨æˆ·ç‚¹å‡»é’“é±¼é‚®ä»¶ï¼Œç¡®è®¤ä¸ºçœŸåï¼Œæ¨é€ç»ˆç«¯ç”¨æˆ·æé†’å¹¶è·å¾—å›å¤</p>
                                <div class="flex items-center justify-between">
                                    <div class="flex items-center text-xs text-gray-500">
                                        <i class="fas fa-clock mr-1"></i>
                                        <span>é¢„è®¡æ‰§è¡Œæ—¶é—´: 5-15åˆ†é’Ÿ</span>
                                    </div>
                                    <div class="text-xs text-gray-400">
                                        <i class="fas fa-download mr-1"></i>634æ¬¡ä½¿ç”¨
                                    </div>
                                </div>
                            </div>

                            <div class="template-card bg-white border-2 border-gray-200 rounded-xl p-6 cursor-pointer hover:border-blue-500 hover:shadow-lg transition-all duration-300 group" 
                                 data-template="executive-security-incident">
                                <div class="flex items-start justify-between mb-4">
                                    <div class="w-12 h-12 bg-gradient-to-r from-purple-400 to-purple-600 rounded-lg flex items-center justify-center group-hover:scale-110 transition-transform">
                                        <i class="fas fa-crown text-white text-xl"></i>
                                    </div>
                                </div>
                                <h5 class="text-lg font-semibold text-gray-900 mb-2 group-hover:text-blue-600 transition-colors">é«˜ç®¡å®‰å…¨äº‹ä»¶ä¸“é¡¹æµç¨‹</h5>
                                <p class="text-gray-600 text-sm mb-4">é«˜ç®¡ç”¨æˆ·çš„å®‰å…¨äº‹ä»¶ï¼Œæ¨é€ç®¡ç†å‘˜ç¡®è®¤åå†è‡ªåŠ¨åŒ–æ¨é€é€šçŸ¥ç¡®è®¤</p>
                                <div class="flex items-center justify-between">
                                    <div class="flex items-center text-xs text-gray-500">
                                        <i class="fas fa-clock mr-1"></i>
                                        <span>é¢„è®¡æ‰§è¡Œæ—¶é—´: 15-45åˆ†é’Ÿ</span>
                                    </div>
                                    <div class="text-xs text-gray-400">
                                        <i class="fas fa-download mr-1"></i>423æ¬¡ä½¿ç”¨
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- èµ„äº§æ¼æ´é£é™©ç®¡ç†ç±» -->
                    <div>
                        <h3 class="text-xl font-bold text-gray-900 mb-6 flex items-center">
                            <i class="fas fa-server text-blue-500 mr-3"></i>
                            èµ„äº§æ¼æ´é£é™©ç®¡ç†ç±»
                            <span class="ml-3 text-sm font-normal text-gray-500 bg-blue-50 px-2 py-1 rounded-full">6ä¸ªæ¨¡æ¿</span>
                        </h3>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                            <div class="template-card bg-white border-2 border-gray-200 rounded-xl p-6 cursor-pointer hover:border-blue-500 hover:shadow-lg transition-all duration-300 group" 
                                 data-template="core-asset-exposure">
                                <div class="flex items-start justify-between mb-4">
                                    <div class="w-12 h-12 bg-gradient-to-r from-cyan-400 to-cyan-600 rounded-lg flex items-center justify-center group-hover:scale-110 transition-transform">
                                        <i class="fas fa-globe text-white text-xl"></i>
                                    </div>
                                    <span class="bg-cyan-100 text-cyan-800 text-xs px-2 py-1 rounded-full">æ–°å¢</span>
                                </div>
                                <h5 class="text-lg font-semibold text-gray-900 mb-2 group-hover:text-blue-600 transition-colors">æ ¸å¿ƒèµ„äº§å‘ç°æ–°çš„äº’è”ç½‘æš´éœ²</h5>
                                <p class="text-gray-600 text-sm mb-4">å¯¹äºè®¾å®šçš„æ ¸å¿ƒèµ„äº§ï¼Œå‘ç°äº†æ–°çš„å…³é”®æš´éœ²é¢</p>
                                <div class="flex items-center justify-between">
                                    <div class="flex items-center text-xs text-gray-500">
                                        <i class="fas fa-clock mr-1"></i>
                                        <span>é¢„è®¡æ‰§è¡Œæ—¶é—´: 3-10åˆ†é’Ÿ</span>
                                    </div>
                                    <div class="text-xs text-gray-400">
                                        <i class="fas fa-download mr-1"></i>156æ¬¡ä½¿ç”¨
                                    </div>
                                </div>
                            </div>

                            <div class="template-card bg-white border-2 border-gray-200 rounded-xl p-6 cursor-pointer hover:border-blue-500 hover:shadow-lg transition-all duration-300 group" 
                                 data-template="agent-coverage-monitoring">
                                <div class="flex items-start justify-between mb-4">
                                    <div class="w-12 h-12 bg-gradient-to-r from-green-400 to-green-600 rounded-lg flex items-center justify-center group-hover:scale-110 transition-transform">
                                        <i class="fas fa-chart-line text-white text-xl"></i>
                                    </div>
                                </div>
                                <h5 class="text-lg font-semibold text-gray-900 mb-2 group-hover:text-blue-600 transition-colors">Agentè¦†ç›–ç‡ç›‘æ§ä¸è¡¥é½æµç¨‹</h5>
                                <p class="text-gray-600 text-sm mb-4">æ£€æµ‹åˆ°æ–°çš„æ–°çš„å®‰å…¨äº‹ä»¶ä½†ä¸»æœºæœªå®‰è£…Agent</p>
                                <div class="flex items-center justify-between">
                                    <div class="flex items-center text-xs text-gray-500">
                                        <i class="fas fa-clock mr-1"></i>
                                        <span>é¢„è®¡æ‰§è¡Œæ—¶é—´: 5-20åˆ†é’Ÿ</span>
                                    </div>
                                    <div class="text-xs text-gray-400">
                                        <i class="fas fa-download mr-1"></i>287æ¬¡ä½¿ç”¨
                                    </div>
                                </div>
                            </div>

                            <div class="template-card bg-white border-2 border-gray-200 rounded-xl p-6 cursor-pointer hover:border-blue-500 hover:shadow-lg transition-all duration-300 group" 
                                 data-template="high-risk-vulnerability">
                                <div class="flex items-start justify-between mb-4">
                                    <div class="w-12 h-12 bg-gradient-to-r from-red-500 to-red-700 rounded-lg flex items-center justify-center group-hover:scale-110 transition-transform">
                                        <i class="fas fa-bug text-white text-xl"></i>
                                    </div>
                                    <span class="bg-red-100 text-red-800 text-xs px-2 py-1 rounded-full">é«˜å±</span>
                                </div>
                                <h5 class="text-lg font-semibold text-gray-900 mb-2 group-hover:text-blue-600 transition-colors">é«˜å¯åˆ©ç”¨æ¼æ´ç¡®è®¤ä¸ä¿®å¤æµç¨‹</h5>
                                <p class="text-gray-600 text-sm mb-4">æ£€æµ‹åˆ°é«˜å¯åˆ©ç”¨æ¼æ´ï¼Œæ¨é€äººå·¥ç¡®è®¤åè¿›è¡Œæµç¨‹åŒ–ä¿®å¤</p>
                                <div class="flex items-center justify-between">
                                    <div class="flex items-center text-xs text-gray-500">
                                        <i class="fas fa-clock mr-1"></i>
                                        <span>é¢„è®¡æ‰§è¡Œæ—¶é—´: 30-120åˆ†é’Ÿ</span>
                                    </div>
                                    <div class="text-xs text-gray-400">
                                        <i class="fas fa-download mr-1"></i>512æ¬¡ä½¿ç”¨
                                    </div>
                                </div>
                            </div>

                            <div class="template-card bg-white border-2 border-gray-200 rounded-xl p-6 cursor-pointer hover:border-blue-500 hover:shadow-lg transition-all duration-300 group" 
                                 data-template="vulnerability-lifecycle">
                                <div class="flex items-start justify-between mb-4">
                                    <div class="w-12 h-12 bg-gradient-to-r from-indigo-400 to-indigo-600 rounded-lg flex items-center justify-center group-hover:scale-110 transition-transform">
                                        <i class="fas fa-recycle text-white text-xl"></i>
                                    </div>
                                </div>
                                <h5 class="text-lg font-semibold text-gray-900 mb-2 group-hover:text-blue-600 transition-colors">æ¼æ´ç”Ÿå‘½å‘¨æœŸç®¡ç†æµç¨‹</h5>
                                <p class="text-gray-600 text-sm mb-4">å®Œæ•´çš„æ¼æ´ç®¡ç†æµç¨‹ï¼ŒåŒ…å«è´£ä»»äººæ¨é€ç­‰</p>
                                <div class="flex items-center justify-between">
                                    <div class="flex items-center text-xs text-gray-500">
                                        <i class="fas fa-clock mr-1"></i>
                                        <span>é¢„è®¡æ‰§è¡Œæ—¶é—´: 60-240åˆ†é’Ÿ</span>
                                    </div>
                                    <div class="text-xs text-gray-400">
                                        <i class="fas fa-download mr-1"></i>398æ¬¡ä½¿ç”¨
                                    </div>
                                </div>
                            </div>

                            <div class="template-card bg-white border-2 border-gray-200 rounded-xl p-6 cursor-pointer hover:border-blue-500 hover:shadow-lg transition-all duration-300 group" 
                                 data-template="internet-exposure-closure">
                                <div class="flex items-start justify-between mb-4">
                                    <div class="w-12 h-12 bg-gradient-to-r from-teal-400 to-teal-600 rounded-lg flex items-center justify-center group-hover:scale-110 transition-transform">
                                        <i class="fas fa-lock text-white text-xl"></i>
                                    </div>
                                </div>
                                <h5 class="text-lg font-semibold text-gray-900 mb-2 group-hover:text-blue-600 transition-colors">äº’è”ç½‘æš´éœ²èµ„äº§ç«¯å£é—­ç¯æµç¨‹</h5>
                                <p class="text-gray-600 text-sm mb-4">æ–°å¢äº’è”ç½‘æš´éœ²ç«¯å£æˆ–æœåŠ¡</p>
                                <div class="flex items-center justify-between">
                                    <div class="flex items-center text-xs text-gray-500">
                                        <i class="fas fa-clock mr-1"></i>
                                        <span>é¢„è®¡æ‰§è¡Œæ—¶é—´: 10-30åˆ†é’Ÿ</span>
                                    </div>
                                    <div class="text-xs text-gray-400">
                                        <i class="fas fa-download mr-1"></i>245æ¬¡ä½¿ç”¨
                                    </div>
                                </div>
                            </div>

                            <div class="template-card bg-white border-2 border-gray-200 rounded-xl p-6 cursor-pointer hover:border-blue-500 hover:shadow-lg transition-all duration-300 group" 
                                 data-template="weak-password-response">
                                <div class="flex items-start justify-between mb-4">
                                    <div class="w-12 h-12 bg-gradient-to-r from-amber-400 to-amber-600 rounded-lg flex items-center justify-center group-hover:scale-110 transition-transform">
                                        <i class="fas fa-key text-white text-xl"></i>
                                    </div>
                                </div>
                                <h5 class="text-lg font-semibold text-gray-900 mb-2 group-hover:text-blue-600 transition-colors">å¼±å£ä»¤é£é™©è‡ªåŠ¨å“åº”æµç¨‹</h5>
                                <p class="text-gray-600 text-sm mb-4">æ¢æµ‹åˆ°é‡è¦å¼±å£ä»¤å¹¶ç”Ÿæˆå®‰å…¨äº‹ä»¶</p>
                                <div class="flex items-center justify-between">
                                    <div class="flex items-center text-xs text-gray-500">
                                        <i class="fas fa-clock mr-1"></i>
                                        <span>é¢„è®¡æ‰§è¡Œæ—¶é—´: 5-15åˆ†é’Ÿ</span>
                                    </div>
                                    <div class="text-xs text-gray-400">
                                        <i class="fas fa-download mr-1"></i>189æ¬¡ä½¿ç”¨
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- åº•éƒ¨æç¤º -->
                <div class="mt-12 text-center">
                    <div class="bg-blue-50 rounded-xl p-6 inline-block">
                        <i class="fas fa-lightbulb text-blue-500 text-2xl mb-2"></i>
                        <p class="text-blue-900 font-medium mb-1">ç‚¹å‡»ä»»æ„æ¨¡æ¿å¼€å§‹ç¼–è¾‘</p>
                        <p class="text-blue-700 text-sm">æ‰€æœ‰æ¨¡æ¿éƒ½å·²ç»è¿‡å®‰å…¨ä¸“å®¶éªŒè¯ï¼Œå¯ä»¥ç›´æ¥ä½¿ç”¨æˆ–æ ¹æ®éœ€è¦è‡ªå®šä¹‰</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- å·¥ä½œæµç¼–è¾‘å™¨é¡µé¢ï¼ˆé»˜è®¤éšè—ï¼‰ -->
    <div id="workflowEditorPage" class="hidden">
        <!-- é¡¶éƒ¨å·¥å…·æ  -->
        <div class="bg-white border-b border-gray-200 px-4 py-3 flex items-center justify-between">
            <div class="flex items-center space-x-4">
                <button id="backToStoreBtn" class="p-2 text-gray-500 hover:text-gray-700 rounded-lg hover:bg-gray-100" title="è¿”å›æ¨¡æ¿å•†åº—">
                    <i class="fas fa-arrow-left"></i>
                </button>
                <div class="flex items-center space-x-2">
                    <div class="w-8 h-8 bg-gradient-to-r from-blue-500 to-purple-600 rounded-lg flex items-center justify-center">
                        <i class="fas fa-project-diagram text-white text-sm"></i>
                    </div>
                    <div>
                        <h1 class="text-lg font-semibold text-gray-900">å·¥ä½œæµç¼–è¾‘å™¨</h1>
                    </div>
                </div>
                <div class="h-6 w-px bg-gray-300"></div>
                <div class="flex items-center space-x-2">
                    <button id="saveBtn" class="px-3 py-1.5 bg-blue-500 text-white rounded-md hover:bg-blue-600 text-sm">
                        <i class="fas fa-save mr-1"></i>ä¿å­˜
                    </button>
                    <button id="debugBtn" class="px-3 py-1.5 bg-orange-500 text-white rounded-md hover:bg-orange-600 text-sm">
                        <i class="fas fa-bug mr-1"></i>è°ƒè¯•
                    </button>
                    <button id="publishBtn" class="px-3 py-1.5 bg-green-500 text-white rounded-md hover:bg-green-600 text-sm">
                        <i class="fas fa-rocket mr-1"></i>å‘å¸ƒ
                    </button>
                </div>
            </div>
            <div class="flex items-center space-x-4">
                <div class="text-xs text-gray-500 bg-blue-50 px-3 py-1 rounded-md border border-blue-200">
                    <i class="fas fa-info-circle text-blue-500 mr-1"></i>
                    è¿çº¿æç¤ºï¼šæ‚¬åœèŠ‚ç‚¹æ˜¾ç¤ºè¿æ¥ç‚¹ï¼Œæ‹–æ‹½ç»¿è‰²ç‚¹è¿æ¥åˆ°çº¢è‰²ç‚¹
                </div>
                <div class="text-sm text-gray-500">
                    <span class="w-2 h-2 bg-green-500 rounded-full inline-block mr-1"></span>
                    å·²ä¿å­˜
                </div>
                <button class="p-2 text-gray-500 hover:text-gray-700 rounded-md hover:bg-gray-100" 
                        title="å¸®åŠ©ï¼šç»¿è‰²ç‚¹ä¸ºè¾“å‡ºç«¯ï¼Œçº¢è‰²ç‚¹ä¸ºè¾“å…¥ç«¯">
                    <i class="fas fa-question-circle"></i>
                </button>
            </div>
        </div>

    <div class="flex h-full">
        <!-- å·¦ä¾§èŠ‚ç‚¹å·¥å…·æ  -->
        <div id="sidebar" class="sidebar-expanded bg-white border-r border-gray-200 flex flex-col transition-all duration-300">
            <div class="p-4 border-b border-gray-200 flex items-center justify-between">
                <h2 class="font-semibold text-gray-900">èŠ‚ç‚¹åº“</h2>
                <button id="toggleSidebar" class="p-1 text-gray-500 hover:text-gray-700">
                    <i class="fas fa-chevron-left"></i>
                </button>
            </div>
            
            <div class="flex-1 overflow-y-auto p-4">
                <!-- è§¦å‘å™¨èŠ‚ç‚¹ -->
                <div class="mb-6">
                    <h3 class="text-sm font-medium text-gray-700 mb-3 flex items-center">
                        <i class="fas fa-bolt text-green-500 mr-2"></i>è§¦å‘å™¨èŠ‚ç‚¹
                    </h3>
                    <div class="space-y-2">
                        <div class="node-template draggable-node node-trigger bg-gray-50 p-3 rounded-lg cursor-move" 
                             data-type="trigger" data-subtype="alert">
                            <i class="fas fa-exclamation-triangle text-red-500 mr-2"></i>
                            <span class="text-sm font-medium">å‘Šè­¦è§¦å‘å™¨</span>
                        </div>
                        <div class="node-template draggable-node node-trigger bg-gray-50 p-3 rounded-lg cursor-move" 
                             data-type="trigger" data-subtype="event">
                            <i class="fas fa-calendar-alt text-blue-500 mr-2"></i>
                            <span class="text-sm font-medium">äº‹ä»¶è§¦å‘å™¨</span>
                        </div>
                        <div class="node-template draggable-node node-trigger bg-gray-50 p-3 rounded-lg cursor-move" 
                             data-type="trigger" data-subtype="webhook">
                            <i class="fas fa-plug text-purple-500 mr-2"></i>
                            <span class="text-sm font-medium">Webhookè§¦å‘å™¨</span>
                        </div>
                    </div>
                </div>

                <!-- AI AgentèŠ‚ç‚¹ -->
                <div class="mb-6">
                    <h3 class="text-sm font-medium text-gray-700 mb-3 flex items-center">
                        <i class="fas fa-robot text-blue-500 mr-2"></i>AI AgentèŠ‚ç‚¹
                    </h3>
                    <div class="space-y-2">
                        <div class="node-template draggable-node node-ai bg-gray-50 p-3 rounded-lg cursor-move" 
                             data-type="ai" data-subtype="investigate">
                            <i class="fas fa-search text-blue-500 mr-2"></i>
                            <span class="text-sm font-medium">è°ƒæŸ¥æº¯æºAgent</span>
                        </div>
                        <div class="node-template draggable-node node-ai bg-gray-50 p-3 rounded-lg cursor-move" 
                             data-type="ai" data-subtype="disposal">
                            <i class="fas fa-shield-alt text-green-500 mr-2"></i>
                            <span class="text-sm font-medium">å®ä½“å¤„ç½®Agent</span>
                        </div>
                        <div class="node-template draggable-node node-ai bg-gray-50 p-3 rounded-lg cursor-move" 
                             data-type="ai" data-subtype="custom">
                            <i class="fas fa-cog text-gray-500 mr-2"></i>
                            <span class="text-sm font-medium">è‡ªå®šä¹‰Agent</span>
                        </div>
                    </div>
                </div>

                <!-- è”ç»œå‘˜Agent -->
                <div class="mb-6">
                    <h3 class="text-sm font-medium text-gray-700 mb-3 flex items-center">
                        <i class="fas fa-user-tie text-purple-500 mr-2"></i>è”ç»œå‘˜Agent
                    </h3>
                    <div class="space-y-2">
                        <div class="node-template draggable-node node-agent bg-gray-50 p-3 rounded-lg cursor-move" 
                             data-type="agent" data-subtype="contact">
                            <i class="fas fa-comments text-purple-500 mr-2"></i>
                            <span class="text-sm font-medium">è”ç»œå‘˜Agent</span>
                        </div>
                    </div>
                </div>

                <!-- SOARå¼•æ“ -->
                <div class="mb-6">
                    <h3 class="text-sm font-medium text-gray-700 mb-3 flex items-center">
                        <i class="fas fa-cogs text-orange-500 mr-2"></i>SOARå¼•æ“
                    </h3>
                    <div class="space-y-2">
                        <div class="node-template draggable-node node-soar bg-gray-50 p-3 rounded-lg cursor-move" 
                             data-type="soar" data-subtype="playbook">
                            <i class="fas fa-play-circle text-orange-500 mr-2"></i>
                            <span class="text-sm font-medium">å¤„ç½®Playbook</span>
                        </div>
                        <div class="node-template draggable-node node-soar bg-gray-50 p-3 rounded-lg cursor-move" 
                             data-type="soar" data-subtype="ticket">
                            <i class="fas fa-ticket-alt text-orange-500 mr-2"></i>
                            <span class="text-sm font-medium">å·¥å•ç®¡ç†</span>
                        </div>
                    </div>
                </div>

                <!-- äººå·¥èŠ‚ç‚¹ -->
                <div class="mb-6">
                    <h3 class="text-sm font-medium text-gray-700 mb-3 flex items-center">
                        <i class="fas fa-user text-red-500 mr-2"></i>äººå·¥èŠ‚ç‚¹
                    </h3>
                    <div class="space-y-2">
                        <div class="node-template draggable-node node-human bg-gray-50 p-3 rounded-lg cursor-move" 
                             data-type="human" data-subtype="confirm">
                            <i class="fas fa-check-circle text-red-500 mr-2"></i>
                            <span class="text-sm font-medium">äººå·¥ç¡®è®¤</span>
                        </div>
                    </div>
                </div>

                <!-- é€»è¾‘æ§åˆ¶èŠ‚ç‚¹ -->
                <div class="mb-6">
                    <h3 class="text-sm font-medium text-gray-700 mb-3 flex items-center">
                        <i class="fas fa-code-branch text-gray-500 mr-2"></i>é€»è¾‘æ§åˆ¶
                    </h3>
                    <div class="space-y-2">
                        <div class="node-template draggable-node node-logic bg-gray-50 p-3 rounded-lg cursor-move" 
                             data-type="logic" data-subtype="condition">
                            <i class="fas fa-question text-gray-500 mr-2"></i>
                            <span class="text-sm font-medium">æ¡ä»¶åˆ¤æ–­</span>
                        </div>
                    </div>
                </div>

                <!-- æ³¨é‡Šè¯´æ˜èŠ‚ç‚¹ -->
                <div class="mb-6">
                    <h3 class="text-sm font-medium text-gray-700 mb-3 flex items-center">
                        <i class="fas fa-sticky-note text-yellow-500 mr-2"></i>æ³¨é‡Šè¯´æ˜
                    </h3>
                    <div class="space-y-2">
                        <div class="node-template draggable-node node-comment bg-gray-50 p-3 rounded-lg cursor-move" 
                             data-type="comment" data-subtype="text">
                            <i class="fas fa-comment text-yellow-500 mr-2"></i>
                            <span class="text-sm font-medium">æ–‡å­—è¯´æ˜</span>
                        </div>
                        <div class="node-template draggable-node node-comment bg-gray-50 p-3 rounded-lg cursor-move" 
                             data-type="comment" data-subtype="group">
                            <i class="fas fa-object-group text-indigo-500 mr-2"></i>
                            <span class="text-sm font-medium">åˆ†ç»„æ¡†</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- ä¸»è¦å·¥ä½œåŒºåŸŸ -->
        <div class="flex-1 flex flex-col">
            <!-- å·¥ä½œæµç”»å¸ƒ -->
            <div class="flex-1 relative">
                <div id="workflow-viewport" class="workflow-viewport">
                    <div id="workflow-canvas" class="workflow-canvas" style="width: 100%; height: 100%;">
                        <div id="workflow-container" class="workflow-container">
                    <!-- ç¤ºä¾‹å·¥ä½œæµï¼šé‡å¤§å®‰å…¨äº‹ä»¶æ™ºèƒ½å“åº”æµç¨‹ -->
                    <div id="start-node" class="workflow-node draggable-node node-trigger bg-white rounded-lg shadow-md p-4 absolute" 
                         style="left: 100px; top: 100px; width: 200px;">
                        <div class="flex items-center mb-2">
                            <i class="fas fa-exclamation-triangle text-red-500 mr-2"></i>
                            <span class="font-semibold text-sm">è§¦å‘é‡å¤§å®‰å…¨äº‹ä»¶</span>
                        </div>
                        <div class="text-xs text-gray-500">å‘Šè­¦è§¦å‘å™¨</div>
                    </div>

                    <div id="agent-node" class="workflow-node draggable-node node-agent bg-white rounded-lg shadow-md p-4 absolute" 
                         style="left: 400px; top: 100px; width: 200px;">
                        <div class="flex items-center mb-2">
                            <i class="fas fa-user-tie text-purple-500 mr-2"></i>
                            <span class="font-semibold text-sm">è”ç»œå‘˜Agent</span>
                        </div>
                        <div class="text-xs text-gray-500">ä¼ä¸šå¾®ä¿¡è´Ÿè´£äºº</div>
                    </div>

                    <div id="human-task" class="workflow-node draggable-node node-human bg-white rounded-lg shadow-md p-4 absolute" 
                         style="left: 700px; top: 50px; width: 200px;">
                        <div class="flex items-center mb-2">
                            <i class="fas fa-comments text-blue-500 mr-2"></i>
                            <span class="font-semibold text-sm">ç”³è¯·é€šçŸ¥</span>
                        </div>
                        <div class="text-xs text-gray-500">ä¼ä¸šå¾®ä¿¡å›å¤è¶…æ—¶</div>
                    </div>

                    <div id="investigate-agent" class="workflow-node draggable-node node-ai bg-white rounded-lg shadow-md p-4 absolute" 
                         style="left: 700px; top: 200px; width: 200px;">
                        <div class="flex items-center mb-2">
                            <i class="fas fa-search text-blue-500 mr-2"></i>
                            <span class="font-semibold text-sm">è°ƒæŸ¥æº¯æºAgent</span>
                        </div>
                        <div class="text-xs text-gray-500">èµ„äº§/è¿›ç¨‹/ç½‘ç»œ</div>
                    </div>

                    <div id="disposal-agent" class="workflow-node draggable-node node-ai bg-white rounded-lg shadow-md p-4 absolute" 
                         style="left: 1000px; top: 200px; width: 200px;">
                        <div class="flex items-center mb-2">
                            <i class="fas fa-shield-alt text-green-500 mr-2"></i>
                            <span class="font-semibold text-sm">å¤„ç½®å°å µPlaybook</span>
                        </div>
                        <div class="text-xs text-gray-500">è‡ªåŠ¨å°å µ</div>
                    </div>

                    <div id="ai-report" class="workflow-node draggable-node node-ai bg-white rounded-lg shadow-md p-4 absolute" 
                         style="left: 1000px; top: 50px; width: 200px;">
                        <div class="flex items-center mb-2">
                            <i class="fas fa-file-alt text-blue-500 mr-2"></i>
                            <span class="font-semibold text-sm">AIæ€»ç»“é—­ç¯æŠ¥å‘Š</span>
                        </div>
                        <div class="text-xs text-gray-500">ä¼ä¸šå¾®ä¿¡+é‚®ä»¶</div>
                    </div>

                    <div id="soar-playbook" class="workflow-node draggable-node node-soar bg-white rounded-lg shadow-md p-4 absolute" 
                         style="left: 1300px; top: 200px; width: 200px;">
                        <div class="flex items-center mb-2">
                            <i class="fas fa-play-circle text-orange-500 mr-2"></i>
                            <span class="font-semibold text-sm">å¤„ç½®å°å µPlaybook</span>
                        </div>
                        <div class="text-xs text-gray-500">è°ƒç”¨SOARå¼•æ“</div>
                    </div>

                    <div id="ticket-node" class="workflow-node draggable-node node-soar bg-white rounded-lg shadow-md p-4 absolute" 
                         style="left: 1000px; top: 350px; width: 200px;">
                        <div class="flex items-center mb-2">
                            <i class="fas fa-ticket-alt text-orange-500 mr-2"></i>
                            <span class="font-semibold text-sm">å·¥å•ç®¡ç†</span>
                        </div>
                        <div class="text-xs text-gray-500">åˆ›å»ºå¤„ç½®å·¥å•</div>
                    </div>
                        </div>
                    </div>
                    
                    <!-- ç”»æ¿æ§åˆ¶æŒ‰é’® -->
                    <div class="canvas-controls">
                        <button id="zoomIn" class="canvas-control-btn" title="æ”¾å¤§">
                            <i class="fas fa-plus text-gray-600"></i>
                        </button>
                        <button id="zoomOut" class="canvas-control-btn" title="ç¼©å°">
                            <i class="fas fa-minus text-gray-600"></i>
                        </button>
                        <button id="zoomFit" class="canvas-control-btn" title="é€‚åº”å±å¹•">
                            <i class="fas fa-expand-arrows-alt text-gray-600"></i>
                        </button>
                        <button id="resetView" class="canvas-control-btn" title="é‡ç½®è§†å›¾">
                            <i class="fas fa-home text-gray-600"></i>
                        </button>
                    </div>
                    
                    <!-- å°åœ°å›¾ -->
                    <div id="minimap" class="minimap">
                        <div class="minimap-content">
                            <div id="minimapViewport" class="minimap-viewport"></div>
                        </div>
                    </div>
                    
                    <!-- åæ ‡æ˜¾ç¤º -->
                    <div id="coordinatesDisplay" class="coordinates-display">
                        X: <span id="coordX">0</span>, Y: <span id="coordY">0</span>, ç¼©æ”¾: <span id="coordScale">100%</span>
                    </div>
                </div>
            </div>

            <!-- åº•éƒ¨çŠ¶æ€æ  -->
            <div class="bg-white border-t border-gray-200 px-4 py-2 flex items-center justify-between text-sm">
                <div class="flex items-center space-x-4">
                    <span class="text-gray-500">èŠ‚ç‚¹æ•°é‡: <span id="nodeCount">8</span></span>
                    <span class="text-gray-500">è¿æ¥æ•°é‡: <span id="connectionCount">8</span></span>
                </div>
                <div class="flex items-center space-x-4">
                    <span class="text-gray-500">æœ€åä¿å­˜: åˆšåˆš</span>
                    <button class="text-blue-500 hover:text-blue-700">æŸ¥çœ‹æ‰§è¡Œæ—¥å¿—</button>
                </div>
            </div>
        </div>

        <!-- å³ä¾§å±æ€§é…ç½®é¢æ¿ -->
        <div id="propertiesPanel" class="w-80 bg-white border-l border-gray-200 hidden flex flex-col h-full">
            <div class="p-4 border-b border-gray-200 flex items-center justify-between flex-shrink-0">
                <h3 class="font-semibold text-gray-900">èŠ‚ç‚¹å±æ€§</h3>
                <button id="closePropertiesPanel" class="text-gray-400 hover:text-gray-600 transition-colors">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="flex-1 overflow-y-auto p-4">
                <div id="nodeProperties">
                    <p class="text-gray-500 text-sm">è¯·é€‰æ‹©ä¸€ä¸ªèŠ‚ç‚¹æ¥é…ç½®å±æ€§</p>
                </div>
            </div>
        </div>
    </div>

    <!-- å³é”®èœå• -->
    <div id="contextMenu" class="context-menu">
        <div class="context-menu-item" data-action="edit">
            <i class="fas fa-edit mr-2"></i>ç¼–è¾‘èŠ‚ç‚¹
        </div>
        <div class="context-menu-item" data-action="copy">
            <i class="fas fa-copy mr-2"></i>å¤åˆ¶èŠ‚ç‚¹
        </div>
        <div class="context-menu-item" data-action="disconnect">
            <i class="fas fa-unlink mr-2"></i>æ–­å¼€è¿æ¥
        </div>
        <div class="context-menu-item danger" data-action="delete">
            <i class="fas fa-trash mr-2"></i>åˆ é™¤èŠ‚ç‚¹
        </div>
    </div>

    <!-- è°ƒè¯•æ¨¡æ€æ¡† -->
    <div id="debugModal" class="fixed inset-0 bg-black bg-opacity-50 hidden z-50">
        <div class="flex items-center justify-center h-full">
            <div class="bg-white rounded-lg shadow-xl max-w-2xl w-full mx-4">
                <div class="p-6 border-b border-gray-200">
                    <h3 class="text-lg font-semibold text-gray-900">å·¥ä½œæµè°ƒè¯•æ¨¡å¼</h3>
                </div>
                <div class="p-6">
                    <div class="mb-4">
                        <label class="block text-sm font-medium text-gray-700 mb-2">æ¨¡æ‹Ÿè¾“å…¥æ•°æ®</label>
                        <textarea id="debugInput" class="w-full h-32 p-3 border border-gray-300 rounded-md" 
                                  placeholder='è¯·è¾“å…¥JSONæ ¼å¼çš„æµ‹è¯•æ•°æ®ï¼Œä¾‹å¦‚ï¼š
{
  "alert_id": "A12",
  "severity": "high",
  "asset_ip": "192.168.50.98",
  "attack_type": "file_upload",
  "source_ip": "1.1.112.102"
}'></textarea>
                    </div>
                    <div class="flex items-center justify-between">
                        <button id="startDebug" class="px-4 py-2 bg-orange-500 text-white rounded-md hover:bg-orange-600">
                            <i class="fas fa-play mr-2"></i>å¼€å§‹è°ƒè¯•
                        </button>
                        <button id="closeDebug" class="px-4 py-2 bg-gray-500 text-white rounded-md hover:bg-gray-600">
                            å…³é—­
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- æ—§çš„æ¨¡æ¿å•†åº—æ¨¡æ€æ¡†å·²ç§»é™¤ï¼Œç°åœ¨ä½¿ç”¨é¡µé¢åˆ‡æ¢æ–¹å¼ -->

    <script>
        // å…¨å±€å˜é‡
        let jsPlumbInstance;
        let selectedNode = null;
        let nodeCounter = 0;
        let isDebugMode = false;
        let isDragging = false;
        let clickTimer = null;
        let isConnecting = false;
        
        // æ— é™ç”»æ¿ç›¸å…³å˜é‡
        let canvasState = {
            x: 0,
            y: 0,
            scale: 1,
            isPanning: false,
            lastPanPoint: { x: 0, y: 0 },
            minScale: 0.1,
            maxScale: 3,
            panSensitivity: 1
        };
        let workflowContainer = null;
        let workflowViewport = null;

        // åˆå§‹åŒ–jsPlumb
        function initJsPlumb() {
            jsPlumbInstance = jsPlumb.getInstance({
                Endpoint: ["Dot", { radius: 8 }],
                Connector: ["Bezier", { curviness: 80 }],
                HoverPaintStyle: { stroke: "#1e40af", strokeWidth: 3 },
                PaintStyle: { stroke: "#64748b", strokeWidth: 2, outlineStroke: "transparent", outlineWidth: 4 },
                ConnectionOverlays: [
                    ["Arrow", {
                        location: 1,
                        id: "arrow",
                        length: 14,
                        foldback: 0.8
                    }]
                ],
                Container: "workflow-container",
                DragOptions: { 
                    cursor: 'move', 
                    zIndex: 2000,
                    start: function(params) { 
                        isDragging = true;
                    },
                    stop: function(params) { 
                        setTimeout(() => { 
                            isDragging = false;
                        }, 100); 
                    }
                },
                PaintStyle: { stroke: '#64748b', strokeWidth: 2 },
                EndpointStyle: { fill: '#64748b', stroke: '#64748b' }
            });

            // è®¾ç½®é»˜è®¤è¿æ¥ç‚¹æ ·å¼
            jsPlumbInstance.registerEndpointType("source", {
                endpoint: "Dot",
                paintStyle: { 
                    fill: "#10b981", 
                    stroke: "#059669", 
                    strokeWidth: 2,
                    radius: 6 
                },
                isSource: true,
                connector: ["Bezier", { curviness: 80 }],
                connectorStyle: { stroke: "#64748b", strokeWidth: 2 },
                hoverPaintStyle: { 
                    fill: "#059669", 
                    stroke: "#047857", 
                    strokeWidth: 3,
                    radius: 8
                },
                connectorHoverStyle: { stroke: "#1e40af", strokeWidth: 3 },
                dragOptions: {},
                overlays: [
                    ["Arrow", { location: 1, width: 20, length: 20, id: "arrow" }]
                ]
            });

            jsPlumbInstance.registerEndpointType("target", {
                endpoint: "Dot",
                paintStyle: { 
                    fill: "#ef4444", 
                    stroke: "#dc2626", 
                    strokeWidth: 2,
                    radius: 6 
                },
                hoverPaintStyle: { 
                    fill: "#dc2626", 
                    stroke: "#b91c1c", 
                    strokeWidth: 3,
                    radius: 8
                },
                isTarget: true
            });

            // ä½¿æ‰€æœ‰å·¥ä½œæµèŠ‚ç‚¹å¯æ‹–æ‹½
            jsPlumbInstance.draggable(jsPlumbInstance.getSelector(".workflow-node"));

            // ä¸ºç°æœ‰èŠ‚ç‚¹æ·»åŠ è¿æ¥ç‚¹
            setupExistingNodes();
            
            // æ·»åŠ è¿æ¥ç‚¹å¢å¼ºåŠŸèƒ½
            setupEndpointEnhancements();

            // è¿æ¥äº‹ä»¶ç›‘å¬
            jsPlumbInstance.bind("connection", function(info) {
                updateConnectionCount();
            });

            jsPlumbInstance.bind("connectionDetached", function(info) {
                updateConnectionCount();
            });

            // è¿æ¥å¼€å§‹å’Œç»“æŸäº‹ä»¶
            jsPlumbInstance.bind("beforeStartDetach", function(info) {
                isConnecting = true;
                return true;
            });

            jsPlumbInstance.bind("connectionDragStop", function(info) {
                setTimeout(() => { isConnecting = false; }, 100);
            });

            jsPlumbInstance.bind("beforeDrop", function(info) {
                isConnecting = false;
                return true;
            });
        }

        // åˆå§‹åŒ–æ— é™ç”»æ¿
        function initInfiniteCanvas() {
            workflowViewport = document.getElementById('workflow-viewport');
            workflowContainer = document.getElementById('workflow-container');
            
            // è®¾ç½®åˆå§‹ä½ç½®
            canvasState.x = 0;
            canvasState.y = 0;
            canvasState.scale = 1;
            updateCanvasTransform();
            
            // æ·»åŠ äº‹ä»¶ç›‘å¬
            setupCanvasEvents();
            setupCanvasControls();
            setupMinimap();
            updateCoordinates();
            
            // å»¶è¿Ÿæ‰§è¡Œè‡ªé€‚åº”ï¼Œç¡®ä¿æ‰€æœ‰èŠ‚ç‚¹éƒ½å·²æ¸²æŸ“
            setTimeout(() => {
                fitToScreen();
            }, 500);
        }
        
        // è®¾ç½®ç”»æ¿äº‹ä»¶
        function setupCanvasEvents() {
            const viewport = document.getElementById('workflow-viewport');
            const canvas = document.getElementById('workflow-canvas');
            const container = document.getElementById('workflow-container');
            
            // æ£€æŸ¥æ˜¯å¦ç‚¹å‡»åœ¨ç©ºç™½åŒºåŸŸ
            function isClickOnEmpty(target) {
                return target === viewport || target === canvas || target === container || 
                       target.classList.contains('workflow-canvas') || 
                       target.classList.contains('workflow-container') ||
                       target.classList.contains('workflow-viewport');
            }
            
            // é¼ æ ‡æŒ‰ä¸‹ - å¼€å§‹æ‹–æ‹½
            viewport.addEventListener('mousedown', function(e) {
                // åªåœ¨ç©ºç™½åŒºåŸŸæ‰èƒ½æ‹–æ‹½ç”»æ¿ï¼Œä¸”ä¸æ˜¯èŠ‚ç‚¹ï¼Œä¸”ä¸æ˜¯æ§åˆ¶æŒ‰é’®
                const isOnNode = e.target.closest('.workflow-node');
                const isOnControl = e.target.closest('.canvas-controls') || e.target.closest('.minimap') || e.target.closest('.coordinates-display');
                
                if (isClickOnEmpty(e.target) && !isOnNode && !isOnControl) {
                    if (e.button === 0) { // å·¦é”®
                        canvasState.isPanning = true;
                        canvasState.lastPanPoint = { x: e.clientX, y: e.clientY };
                        viewport.style.cursor = 'grabbing';
                        e.preventDefault();
                        e.stopPropagation();
                    }
                }
            });
            
            // é¼ æ ‡ç§»åŠ¨ - æ‹–æ‹½è¿‡ç¨‹
            document.addEventListener('mousemove', function(e) {
                if (canvasState.isPanning) {
                    const deltaX = (e.clientX - canvasState.lastPanPoint.x) * canvasState.panSensitivity;
                    const deltaY = (e.clientY - canvasState.lastPanPoint.y) * canvasState.panSensitivity;
                    
                    canvasState.x += deltaX;
                    canvasState.y += deltaY;
                    
                    canvasState.lastPanPoint = { x: e.clientX, y: e.clientY };
                    
                    updateCanvasTransform();
                    updateCoordinates();
                    updateMinimap();
                    e.preventDefault();
                }
            });
            
            // é¼ æ ‡é‡Šæ”¾ - ç»“æŸæ‹–æ‹½
            document.addEventListener('mouseup', function(e) {
                if (canvasState.isPanning) {
                    canvasState.isPanning = false;
                    viewport.style.cursor = 'grab';
                }
            });
            
            // é¼ æ ‡ç¦»å¼€çª—å£ - ç»“æŸæ‹–æ‹½
            document.addEventListener('mouseleave', function(e) {
                if (canvasState.isPanning) {
                    canvasState.isPanning = false;
                    viewport.style.cursor = 'grab';
                }
            });
            
            // é¼ æ ‡æ»šè½® - ç¼©æ”¾
            viewport.addEventListener('wheel', function(e) {
                e.preventDefault();
                
                const rect = viewport.getBoundingClientRect();
                const mouseX = e.clientX - rect.left;
                const mouseY = e.clientY - rect.top;
                
                // Macä¼˜åŒ–ï¼šæ›´ç²¾ç»†çš„ç¼©æ”¾æ§åˆ¶
                const scaleFactor = 0.03; // é™ä½æ•æ„Ÿåº¦
                const direction = e.deltaY > 0 ? -1 : 1;
                const delta = 1 + (direction * scaleFactor);
                
                const newScale = Math.max(canvasState.minScale, Math.min(canvasState.maxScale, canvasState.scale * delta));
                
                if (newScale !== canvasState.scale) {
                    // ä»¥é¼ æ ‡ä½ç½®ä¸ºä¸­å¿ƒç¼©æ”¾
                    const scaleRatio = newScale / canvasState.scale;
                    canvasState.x = mouseX - (mouseX - canvasState.x) * scaleRatio;
                    canvasState.y = mouseY - (mouseY - canvasState.y) * scaleRatio;
                    canvasState.scale = newScale;
                    
                    updateCanvasTransform();
                    updateCoordinates();
                    updateMinimap();
                }
            });
        }
        
        // è®¾ç½®æ§åˆ¶æŒ‰é’®
        function setupCanvasControls() {
            document.getElementById('zoomIn').addEventListener('click', function() {
                zoomCanvas(1.2);
            });
            
            document.getElementById('zoomOut').addEventListener('click', function() {
                zoomCanvas(0.8);
            });
            
            document.getElementById('zoomFit').addEventListener('click', function() {
                fitToScreen();
            });
            
            document.getElementById('resetView').addEventListener('click', function() {
                resetView();
            });
        }
        
        // ç¼©æ”¾ç”»æ¿
        function zoomCanvas(factor) {
            const newScale = Math.max(canvasState.minScale, Math.min(canvasState.maxScale, canvasState.scale * factor));
            
            if (newScale !== canvasState.scale) {
                const viewport = workflowViewport.getBoundingClientRect();
                const centerX = viewport.width / 2;
                const centerY = viewport.height / 2;
                
                const scaleRatio = newScale / canvasState.scale;
                canvasState.x = centerX - (centerX - canvasState.x) * scaleRatio;
                canvasState.y = centerY - (centerY - canvasState.y) * scaleRatio;
                canvasState.scale = newScale;
                
                updateCanvasTransform();
                updateCoordinates();
                updateMinimap();
            }
        }
        
        // é€‚åº”å±å¹•
        function fitToScreen() {
            const nodes = document.querySelectorAll('.workflow-node');
            if (nodes.length === 0) {
                // æ²¡æœ‰èŠ‚ç‚¹æ—¶ï¼Œå±…ä¸­æ˜¾ç¤º
                canvasState.x = 0;
                canvasState.y = 0;
                canvasState.scale = 1;
                updateCanvasTransform();
                updateCoordinates();
                updateMinimap();
                return;
            }
            
            let minX = Infinity, minY = Infinity, maxX = -Infinity, maxY = -Infinity;
            
            nodes.forEach(node => {
                const x = parseInt(node.style.left) || 0;
                const y = parseInt(node.style.top) || 0;
                const width = parseInt(node.style.width) || 200;
                const height = node.offsetHeight || 80;
                
                minX = Math.min(minX, x);
                minY = Math.min(minY, y);
                maxX = Math.max(maxX, x + width);
                maxY = Math.max(maxY, y + height);
            });
            
            const padding = 100; // è¾¹è·
            const contentWidth = maxX - minX + padding * 2;
            const contentHeight = maxY - minY + padding * 2;
            
            const viewport = workflowViewport.getBoundingClientRect();
            const scaleX = viewport.width / contentWidth;
            const scaleY = viewport.height / contentHeight;
            const scale = Math.min(scaleX, scaleY, 1); // ä¸è¶…è¿‡100%
            
            canvasState.scale = Math.max(canvasState.minScale, Math.min(canvasState.maxScale, scale));
            
            // è®¡ç®—å±…ä¸­ä½ç½®
            const centerX = (minX + maxX) / 2;
            const centerY = (minY + maxY) / 2;
            
            canvasState.x = viewport.width / 2 - centerX * canvasState.scale;
            canvasState.y = viewport.height / 2 - centerY * canvasState.scale;
            
            updateCanvasTransform();
            updateCoordinates();
            updateMinimap();
        }
        
        // é‡ç½®è§†å›¾
        function resetView() {
            // é‡ç½®åˆ°é€‚åº”æ‰€æœ‰èŠ‚ç‚¹çš„è§†å›¾
            fitToScreen();
        }
        
        // æ›´æ–°ç”»æ¿å˜æ¢
        function updateCanvasTransform() {
            const transform = `translate(${canvasState.x}px, ${canvasState.y}px) scale(${canvasState.scale})`;
            workflowContainer.style.transform = transform;
        }
        
        // æ›´æ–°åæ ‡æ˜¾ç¤º
        function updateCoordinates() {
            document.getElementById('coordX').textContent = Math.round(-canvasState.x / canvasState.scale);
            document.getElementById('coordY').textContent = Math.round(-canvasState.y / canvasState.scale);
            document.getElementById('coordScale').textContent = Math.round(canvasState.scale * 100) + '%';
        }
        
        // è®¾ç½®å°åœ°å›¾
        function setupMinimap() {
            const minimapViewport = document.getElementById('minimapViewport');
            
            // ç‚¹å‡»å°åœ°å›¾ç§»åŠ¨è§†å›¾
            minimapViewport.parentElement.addEventListener('click', function(e) {
                const rect = this.getBoundingClientRect();
                const clickX = e.clientX - rect.left;
                const clickY = e.clientY - rect.top;
                
                const minimapScale = 0.02; // å°åœ°å›¾ç¼©æ”¾æ¯”ä¾‹
                const targetX = -(clickX / minimapScale - workflowViewport.clientWidth / 2);
                const targetY = -(clickY / minimapScale - workflowViewport.clientHeight / 2);
                
                canvasState.x = targetX;
                canvasState.y = targetY;
                
                updateCanvasTransform();
                updateCoordinates();
                updateMinimap();
            });
            
            updateMinimap();
        }
        
        // æ›´æ–°å°åœ°å›¾
        function updateMinimap() {
            const minimapViewport = document.getElementById('minimapViewport');
            const minimapScale = 0.02;
            
            // æ›´æ–°è§†å›¾æ¡†ä½ç½®
            const viewportWidth = workflowViewport.clientWidth * minimapScale;
            const viewportHeight = workflowViewport.clientHeight * minimapScale;
            const viewportX = -canvasState.x * minimapScale;
            const viewportY = -canvasState.y * minimapScale;
            
            minimapViewport.style.width = viewportWidth + 'px';
            minimapViewport.style.height = viewportHeight + 'px';
            minimapViewport.style.left = viewportX + 'px';
            minimapViewport.style.top = viewportY + 'px';
            
            // æ›´æ–°å°åœ°å›¾ä¸­çš„èŠ‚ç‚¹ä½ç½®
            updateMinimapNodes();
        }
        
        // æ›´æ–°å°åœ°å›¾èŠ‚ç‚¹
        function updateMinimapNodes() {
            const minimapContent = document.querySelector('.minimap-content');
            const existingMinimapNodes = minimapContent.querySelectorAll('.minimap-node');
            existingMinimapNodes.forEach(node => node.remove());
            
            const workflowNodes = document.querySelectorAll('.workflow-node');
            const minimapScale = 0.02;
            
            workflowNodes.forEach(node => {
                const minimapNode = document.createElement('div');
                minimapNode.className = 'minimap-node';
                
                const x = (parseInt(node.style.left) || 0) * minimapScale;
                const y = (parseInt(node.style.top) || 0) * minimapScale;
                
                minimapNode.style.left = x + 'px';
                minimapNode.style.top = y + 'px';
                
                minimapContent.appendChild(minimapNode);
            });
        }
        
        // è®¾ç½®ç°æœ‰èŠ‚ç‚¹çš„è¿æ¥ç‚¹
        function setupExistingNodes() {
            // ä¸ºç°æœ‰èŠ‚ç‚¹æ·»åŠ è¿æ¥ç‚¹
            const existingNodes = document.querySelectorAll('.workflow-node');
            existingNodes.forEach(node => {
                addNodeEndpoints(node);
                
                // ç‰¹åˆ«ä¸ºè”ç»œå‘˜èŠ‚ç‚¹æ·»åŠ å¢å¼ºåŠŸèƒ½
                if (node.classList.contains('node-agent')) {
                    // å»¶è¿Ÿæ·»åŠ è§†è§‰å¢å¼ºï¼Œç¡®ä¿èŠ‚ç‚¹å·²å®Œå…¨æ¸²æŸ“
                    setTimeout(() => {
                        addAgentVisualEnhancements(node);
                    }, 200);
                }
            });

            // æ·»åŠ è¿æ¥
            jsPlumbInstance.connect({
                source: "start-node",
                target: "agent-node",
                anchors: ["Right", "Left"]
            });

            jsPlumbInstance.connect({
                source: "agent-node",
                target: "human-task",
                anchors: ["Right", "Left"],
                overlays: [["Label", { label: "è¶…æ—¶æœªå›å¤", location: 0.5, cssClass: "text-xs bg-yellow-100 px-2 py-1 rounded" }]]
            });

            jsPlumbInstance.connect({
                source: "agent-node",
                target: "investigate-agent",
                anchors: ["Right", "Left"],
                overlays: [["Label", { label: "è·å¾—å¤„ç½®å›å¤", location: 0.5, cssClass: "text-xs bg-green-100 px-2 py-1 rounded" }]]
            });

            jsPlumbInstance.connect({
                source: "investigate-agent",
                target: "disposal-agent",
                anchors: ["Right", "Left"],
                overlays: [["Label", { label: "è¾“å…¥å°å µå®ä½“", location: 0.5, cssClass: "text-xs bg-blue-100 px-2 py-1 rounded" }]]
            });

            jsPlumbInstance.connect({
                source: "disposal-agent",
                target: "soar-playbook",
                anchors: ["Right", "Left"],
                overlays: [["Label", { label: "è°ƒç”¨SOAR", location: 0.5, cssClass: "text-xs bg-orange-100 px-2 py-1 rounded" }]]
            });

            jsPlumbInstance.connect({
                source: "human-task",
                target: "ai-report",
                anchors: ["Right", "Left"],
                overlays: [["Label", { label: "æ— éœ€å¤„ç½®", location: 0.5, cssClass: "text-xs bg-gray-100 px-2 py-1 rounded" }]]
            });

            jsPlumbInstance.connect({
                source: "disposal-agent",
                target: "ticket-node",
                anchors: ["Bottom", "Top"],
                overlays: [["Label", { label: "åˆ›å»ºå·¥å•", location: 0.5, cssClass: "text-xs bg-orange-100 px-2 py-1 rounded" }]]
            });

            jsPlumbInstance.connect({
                source: "soar-playbook",
                target: "ai-report",
                anchors: ["Top", "Bottom"],
                overlays: [["Label", { label: "è¿”å›ç»“æœ", location: 0.5, cssClass: "text-xs bg-purple-100 px-2 py-1 rounded" }]]
            });

            jsPlumbInstance.connect({
                source: "ticket-node",
                target: "ai-report",
                anchors: ["Right", "Bottom"],
                overlays: [["Label", { label: "å·¥å•å®Œæˆ", location: 0.5, cssClass: "text-xs bg-green-100 px-2 py-1 rounded" }]]
            });
        }

        // è®¾ç½®è¿æ¥ç‚¹å¢å¼ºåŠŸèƒ½
        function setupEndpointEnhancements() {
            // ä¸ºæ¯ä¸ªèŠ‚ç‚¹å­˜å‚¨ç‹¬ç«‹çš„å®šæ—¶å™¨
            const nodeTimers = new Map();
            
            // ä¸ºæ‰€æœ‰èŠ‚ç‚¹æ·»åŠ æ‚¬åœäº‹ä»¶ï¼Œæ˜¾ç¤ºè¿æ¥ç‚¹
            document.addEventListener('mouseover', function(e) {
                const node = e.target.closest('.workflow-node');
                if (node && !node.classList.contains('node-comment') && !node.classList.contains('node-group')) {
                    // æ¸…é™¤è¯¥èŠ‚ç‚¹çš„éšè—å®šæ—¶å™¨
                    if (nodeTimers.has(node)) {
                        clearTimeout(nodeTimers.get(node));
                        nodeTimers.delete(node);
                    }
                    
                    // æ˜¾ç¤ºè¿æ¥ç‚¹
                    node.classList.add('show-endpoints');
                    
                    const endpoints = jsPlumbInstance.getEndpoints(node);
                    if (endpoints) {
                        endpoints.forEach(endpoint => {
                            endpoint.addClass('endpoint-highlight');
                        });
                    }
                }
            });
            
            // é¼ æ ‡ç¦»å¼€æ—¶å»¶è¿Ÿéšè—è¿æ¥ç‚¹
            document.addEventListener('mouseout', function(e) {
                const node = e.target.closest('.workflow-node');
                if (node && !node.classList.contains('node-comment') && !node.classList.contains('node-group')) {
                    // ä¸ºè¯¥èŠ‚ç‚¹è®¾ç½®å»¶è¿Ÿéšè—å®šæ—¶å™¨
                    const timer = setTimeout(() => {
                        node.classList.remove('show-endpoints');
                        
                        const endpoints = jsPlumbInstance.getEndpoints(node);
                        if (endpoints) {
                            endpoints.forEach(endpoint => {
                                endpoint.removeClass('endpoint-highlight');
                            });
                        }
                        
                        // æ¸…ç†å®šæ—¶å™¨å¼•ç”¨
                        nodeTimers.delete(node);
                    }, 1000); // 1ç§’å»¶è¿Ÿ
                    
                    nodeTimers.set(node, timer);
                }
            });
            
            // è¿æ¥å¼€å§‹æ—¶çš„è§†è§‰åé¦ˆ
            jsPlumbInstance.bind("connectionDrag", function(connection) {
                document.body.classList.add('connecting-mode');
                // è¿æ¥æ—¶æ˜¾ç¤ºæ‰€æœ‰èŠ‚ç‚¹çš„è¿æ¥ç‚¹
                document.querySelectorAll('.workflow-node').forEach(node => {
                    if (!node.classList.contains('node-comment') && !node.classList.contains('node-group')) {
                        node.classList.add('show-endpoints');
                    }
                });
            });
            
            // è¿æ¥ç»“æŸæ—¶ç§»é™¤è§†è§‰åé¦ˆ
            jsPlumbInstance.bind("connectionDragStop", function(connection) {
                document.body.classList.remove('connecting-mode');
                // å»¶è¿Ÿéšè—æ‰€æœ‰è¿æ¥ç‚¹
                setTimeout(() => {
                    document.querySelectorAll('.workflow-node').forEach(node => {
                        node.classList.remove('show-endpoints');
                    });
                }, 1500);
            });
        }

        // ä¸ºèŠ‚ç‚¹æ·»åŠ è¿æ¥ç‚¹
        function addNodeEndpoints(node) {
            // æ£€æŸ¥æ˜¯å¦å·²ç»æœ‰è¿æ¥ç‚¹
            const existingEndpoints = jsPlumbInstance.getEndpoints(node);
            if (existingEndpoints && existingEndpoints.length > 0) {
                return; // å·²ç»æœ‰è¿æ¥ç‚¹ï¼Œç›´æ¥è¿”å›
            }

            // ç§»é™¤ç°æœ‰çš„è¿æ¥ç‚¹HTMLå…ƒç´ 
            const existingHTMLEndpoints = node.querySelectorAll('.connector-endpoint');
            existingHTMLEndpoints.forEach(ep => ep.remove());

            try {
                // æ£€æŸ¥æ˜¯å¦æ˜¯è”ç»œå‘˜AgentèŠ‚ç‚¹
                if (node.classList.contains('node-agent')) {
                    addAgentEndpoints(node);
                } else {
                    // å…¶ä»–èŠ‚ç‚¹çš„æ ‡å‡†è¿æ¥ç‚¹
                    addStandardEndpoints(node);
                }
            } catch (e) {
                console.warn('æ·»åŠ è¿æ¥ç‚¹å¤±è´¥:', e);
            }
        }
        
        // ä¸ºæ ‡å‡†èŠ‚ç‚¹æ·»åŠ è¿æ¥ç‚¹
        function addStandardEndpoints(node) {
                // æ·»åŠ æºè¿æ¥ç‚¹ï¼ˆå³ä¾§ï¼‰
                jsPlumbInstance.addEndpoint(node, {
                    anchor: "Right",
                    type: "source",
                    uuid: node.id + "-source",
                    maxConnections: -1
                });

                // æ·»åŠ ç›®æ ‡è¿æ¥ç‚¹ï¼ˆå·¦ä¾§ï¼‰
                jsPlumbInstance.addEndpoint(node, {
                    anchor: "Left",
                    type: "target",
                    uuid: node.id + "-target",
                    maxConnections: -1
                });

                // æ·»åŠ é¡¶éƒ¨å’Œåº•éƒ¨è¿æ¥ç‚¹ç”¨äºå¤æ‚è¿çº¿
                jsPlumbInstance.addEndpoint(node, {
                    anchor: "Top",
                    type: "source",
                    uuid: node.id + "-top-source",
                    maxConnections: -1
                });

                jsPlumbInstance.addEndpoint(node, {
                    anchor: "Bottom",
                    type: "target",
                    uuid: node.id + "-bottom-target",
                    maxConnections: -1
                });
        }
        
        // ä¸ºè”ç»œå‘˜AgentèŠ‚ç‚¹æ·»åŠ å¤šä¸ªè¾“å‡ºé”šç‚¹
        function addAgentEndpoints(node) {
            // æ·»åŠ è¾“å…¥è¿æ¥ç‚¹ï¼ˆå·¦ä¾§ï¼‰
            jsPlumbInstance.addEndpoint(node, {
                anchor: "Left",
                type: "target",
                uuid: node.id + "-target",
                maxConnections: -1
            });
            
            // æ·»åŠ å¤šä¸ªè¾“å‡ºé”šç‚¹ï¼ˆå³ä¾§å’Œåº•éƒ¨ï¼‰
            const outputAnchors = [
                { anchor: [1, 0.2], label: "get_details", description: "æŸ¥çœ‹è¯¦æƒ…" },
                { anchor: [1, 0.4], label: "containment_approved", description: "ä¸€é”®éåˆ¶" },
                { anchor: [1, 0.6], label: "marked_as_done", description: "æ ‡è®°å®Œæˆ" },
                { anchor: [1, 0.8], label: "re_investigate", description: "è°ƒæŸ¥" }
            ];
            
            outputAnchors.forEach((config, index) => {
                const endpoint = jsPlumbInstance.addEndpoint(node, {
                    anchor: config.anchor,
                    type: "source",
                    uuid: node.id + "-" + config.label,
                    maxConnections: -1,
                    overlays: [
                        ["Label", {
                            label: config.description,
                            location: [1.5, 0.5],
                            cssClass: "endpoint-label text-xs bg-purple-100 text-purple-800 px-2 py-1 rounded shadow-sm",
                            id: "label-" + config.label
                        }]
                    ]
                });
            });
            
            // ä¸ºè”ç»œå‘˜èŠ‚ç‚¹æ·»åŠ è§†è§‰æç¤º
            addAgentVisualEnhancements(node);
        }
        
        // ä¸ºè”ç»œå‘˜èŠ‚ç‚¹æ·»åŠ è§†è§‰å¢å¼º
        function addAgentVisualEnhancements(node) {
            // æ·»åŠ è¾“å‡ºé”šç‚¹çš„è§†è§‰æ ‡è®°
            const existingMarkers = node.querySelectorAll('.output-anchor-marker');
            existingMarkers.forEach(marker => marker.remove());
            
            const anchorPositions = [
                { top: '20%', label: 'è¯¦æƒ…' },
                { top: '40%', label: 'éåˆ¶' },
                { top: '60%', label: 'å®Œæˆ' },
                { top: '80%', label: 'è°ƒæŸ¥' }
            ];
            
            anchorPositions.forEach(pos => {
                const marker = document.createElement('div');
                marker.className = 'output-anchor-marker absolute right-0 transform translate-x-1/2 w-3 h-3 bg-purple-500 rounded-full border-2 border-white shadow-sm';
                marker.style.top = pos.top;
                marker.style.transform = 'translateX(50%) translateY(-50%)';
                marker.title = pos.label + 'åˆ†æ”¯è¾“å‡º';
                node.appendChild(marker);
            });
            
            // æ·»åŠ èŠ‚ç‚¹ç‰¹æ®Šæ ·å¼
            node.classList.add('agent-enhanced');
        }

        // ç¬¬ä¸€ä¸ªäº‹ä»¶ç›‘å¬å™¨å·²åˆå¹¶åˆ°é¡µé¢åˆå§‹åŒ–éƒ¨åˆ†

        // è®¾ç½®æ‹–æ‹½åŠŸèƒ½
        function setupDragAndDrop() {
            const canvas = document.getElementById('workflow-canvas');
            const nodeTemplates = document.querySelectorAll('.node-template');

            nodeTemplates.forEach(template => {
                template.addEventListener('dragstart', function(e) {
                    e.dataTransfer.setData('text/plain', JSON.stringify({
                        type: this.dataset.type,
                        subtype: this.dataset.subtype,
                        html: this.outerHTML
                    }));
                });

                template.setAttribute('draggable', 'true');
            });

            canvas.addEventListener('dragover', function(e) {
                e.preventDefault();
            });

            canvas.addEventListener('drop', function(e) {
                e.preventDefault();
                const data = JSON.parse(e.dataTransfer.getData('text/plain'));
                
                // è·å–é¼ æ ‡ç›¸å¯¹äºç”»æ¿çš„ä½ç½®
                const viewportRect = workflowViewport.getBoundingClientRect();
                const mouseX = e.clientX - viewportRect.left;
                const mouseY = e.clientY - viewportRect.top;
                
                // è½¬æ¢åˆ°ç”»æ¿åæ ‡ç³»
                const x = (mouseX - canvasState.x) / canvasState.scale;
                const y = (mouseY - canvasState.y) / canvasState.scale;
                
                // ç¡®ä¿æ–°èŠ‚ç‚¹åœ¨åˆç†ä½ç½®ï¼ˆéè´Ÿåæ ‡ï¼‰
                const finalX = Math.max(50, x);
                const finalY = Math.max(50, y);
                
                createNode(data, finalX, finalY);
            });
        }

        // åˆ›å»ºæ–°èŠ‚ç‚¹
        function createNode(data, x, y) {
            nodeCounter++;
            const nodeId = `node-${nodeCounter}`;
            
            const nodeElement = document.createElement('div');
            nodeElement.id = nodeId;
            nodeElement.className = `workflow-node draggable-node node-${data.type} bg-white rounded-lg shadow-md p-4 absolute`;
            nodeElement.style.left = x + 'px';
            nodeElement.style.top = y + 'px';
            
            // æ ¹æ®èŠ‚ç‚¹ç±»å‹è®¾ç½®å°ºå¯¸
            if (data.type === 'comment') {
                if (data.subtype === 'group') {
                    nodeElement.style.width = '300px';
                    nodeElement.style.height = '200px';
                    nodeElement.className = `workflow-node draggable-node node-group bg-white rounded-lg shadow-md p-4 absolute`;
                } else {
                    nodeElement.style.width = '250px';
                    nodeElement.style.minHeight = '80px';
                }
            } else {
                nodeElement.style.width = '200px';
            }
            
            // æ ¹æ®èŠ‚ç‚¹ç±»å‹è®¾ç½®å†…å®¹
            const nodeContent = getNodeContent(data);
            nodeElement.innerHTML = nodeContent;
            
            document.getElementById('workflow-canvas').appendChild(nodeElement);
            
            // ä½¿æ–°èŠ‚ç‚¹å¯æ‹–æ‹½
            jsPlumbInstance.draggable(nodeElement);
            
            // ä¸ºéæ³¨é‡ŠèŠ‚ç‚¹æ·»åŠ è¿æ¥ç‚¹
            if (data.type !== 'comment') {
                // å»¶è¿Ÿæ·»åŠ è¿æ¥ç‚¹ï¼Œç¡®ä¿DOMå·²å®Œå…¨æ¸²æŸ“
                setTimeout(() => {
                    addNodeEndpoints(nodeElement);
                }, 100);
            }
            
            // æ›´æ–°èŠ‚ç‚¹è®¡æ•°
            updateNodeCount();
            
            // æ›´æ–°å°åœ°å›¾
            updateMinimapNodes();
        }

        // è·å–èŠ‚ç‚¹å†…å®¹
        function getNodeContent(data) {
            const icons = {
                trigger: {
                    alert: 'fas fa-exclamation-triangle text-red-500',
                    event: 'fas fa-calendar-alt text-blue-500',
                    webhook: 'fas fa-plug text-purple-500'
                },
                ai: {
                    investigate: 'fas fa-search text-blue-500',
                    disposal: 'fas fa-shield-alt text-green-500',
                    custom: 'fas fa-cog text-gray-500'
                },
                agent: {
                    contact: 'fas fa-comments text-purple-500'
                },
                soar: {
                    playbook: 'fas fa-play-circle text-orange-500',
                    ticket: 'fas fa-ticket-alt text-orange-500'
                },
                human: {
                    confirm: 'fas fa-check-circle text-red-500'
                },
                logic: {
                    condition: 'fas fa-question text-gray-500'
                },
                comment: {
                    text: 'fas fa-comment text-yellow-500',
                    group: 'fas fa-object-group text-indigo-500'
                }
            };

            const names = {
                trigger: {
                    alert: 'å‘Šè­¦è§¦å‘å™¨',
                    event: 'äº‹ä»¶è§¦å‘å™¨',
                    webhook: 'Webhookè§¦å‘å™¨'
                },
                ai: {
                    investigate: 'è°ƒæŸ¥æº¯æºAgent',
                    disposal: 'å®ä½“å¤„ç½®Agent',
                    custom: 'è‡ªå®šä¹‰Agent'
                },
                agent: {
                    contact: 'è”ç»œå‘˜Agent'
                },
                soar: {
                    playbook: 'å¤„ç½®Playbook',
                    ticket: 'å·¥å•ç®¡ç†'
                },
                human: {
                    confirm: 'äººå·¥ç¡®è®¤'
                },
                logic: {
                    condition: 'æ¡ä»¶åˆ¤æ–­'
                },
                comment: {
                    text: 'æ–‡å­—è¯´æ˜',
                    group: 'åˆ†ç»„æ¡†'
                }
            };

            const iconClass = icons[data.type][data.subtype];
            const nodeName = names[data.type][data.subtype];

            // æ³¨é‡ŠèŠ‚ç‚¹ç‰¹æ®Šå¤„ç†
            if (data.type === 'comment') {
                if (data.subtype === 'group') {
                    return `
                        <div class="flex items-center mb-2">
                            <i class="${iconClass} mr-2"></i>
                            <span class="font-semibold text-sm">${nodeName}</span>
                        </div>
                        <div class="text-xs text-gray-500 mb-4">åŒå‡»ç¼–è¾‘åˆ†ç»„è¯´æ˜</div>
                        <div class="text-center text-gray-400 border-2 border-dashed border-gray-300 rounded p-4 mt-4">
                            <p class="text-sm">æ‹–æ‹½èŠ‚ç‚¹åˆ°æ­¤åŒºåŸŸè¿›è¡Œåˆ†ç»„</p>
                        </div>
                    `;
                } else {
                    return `
                        <div class="flex items-center mb-2">
                            <i class="${iconClass} mr-2"></i>
                            <span class="font-semibold text-sm">${nodeName}</span>
                        </div>
                        <div class="text-xs text-gray-500 mb-2">åŒå‡»ç¼–è¾‘å†…å®¹</div>
                        <div class="text-sm text-gray-700 editable-text p-2 border border-gray-200 rounded" 
                             contenteditable="true" placeholder="åœ¨æ­¤è¾“å…¥è¯´æ˜æ–‡å­—...">
                            ç‚¹å‡»è¾“å…¥è¯´æ˜æ–‡å­—...
                        </div>
                    `;
                }
            }

            return `
                <div class="connection-hint">æ‹–æ‹½åœ†ç‚¹è¿æ¥åˆ°å…¶ä»–èŠ‚ç‚¹</div>
                <div class="flex items-center mb-2">
                    <i class="${iconClass} mr-2"></i>
                    <span class="font-semibold text-sm">${nodeName}</span>
                </div>
                <div class="text-xs text-gray-500">ç‚¹å‡»é…ç½®</div>
            `;
        }

        // é€‰æ‹©èŠ‚ç‚¹
        function selectNode(node) {
            // å¦‚æœæ­£åœ¨æ‹–æ‹½æˆ–è¿çº¿ï¼Œä¸æ‰§è¡Œé€‰æ‹©
            if (isDragging || isConnecting || canvasState.isPanning) {
                return;
            }
            
            // ç§»é™¤ä¹‹å‰é€‰ä¸­çš„èŠ‚ç‚¹é«˜äº®
            clearSelection();
            
            // é«˜äº®å½“å‰é€‰ä¸­çš„èŠ‚ç‚¹
            node.classList.add('ring-2', 'ring-blue-500');
            selectedNode = node;
            
            // æ˜¾ç¤ºå±æ€§é¢æ¿
            showNodeProperties(node);
        }
        
        // æ¸…é™¤é€‰æ‹©
        function clearSelection() {
            document.querySelectorAll('.workflow-node').forEach(n => {
                n.classList.remove('ring-2', 'ring-blue-500');
            });
            selectedNode = null;
            document.getElementById('propertiesPanel').classList.add('hidden');
        }

        // æ˜¾ç¤ºèŠ‚ç‚¹å±æ€§
        function showNodeProperties(node) {
            const panel = document.getElementById('propertiesPanel');
            const properties = document.getElementById('nodeProperties');
            
            panel.classList.remove('hidden');
            
            // æ ¹æ®èŠ‚ç‚¹ç±»å‹æ˜¾ç¤ºä¸åŒçš„å±æ€§é…ç½®
            const nodeType = getNodeType(node);
            properties.innerHTML = getNodePropertiesHTML(nodeType, node);
            
            // æ·»åŠ é€šç”¨çš„ç‚¹å‡»äº‹ä»¶å¤„ç†ï¼Œé˜²æ­¢é¢æ¿å†…çš„ç‚¹å‡»äº‹ä»¶å†’æ³¡
            setupPropertiesPanelEvents(panel);
            
            // å¦‚æœæ˜¯è”ç»œå‘˜èŠ‚ç‚¹ï¼Œéœ€è¦åˆå§‹åŒ–ä¸“é—¨çš„åŠŸèƒ½
            if (nodeType === 'agent') {
                initAgentConfiguration();
            }
        }
        
        // è®¾ç½®å±æ€§é¢æ¿äº‹ä»¶å¤„ç†
        function setupPropertiesPanelEvents(panel) {
            // ä¸ºé¢æ¿æ·»åŠ ç‚¹å‡»äº‹ä»¶å¤„ç†ï¼Œé˜»æ­¢äº‹ä»¶å†’æ³¡
            panel.addEventListener('click', function(e) {
                e.stopPropagation();
            });
            
            // ä¸ºé¢æ¿å†…çš„æ‰€æœ‰è¾“å…¥å…ƒç´ æ·»åŠ äº‹ä»¶å¤„ç†
            const inputs = panel.querySelectorAll('input, textarea, select, button');
            inputs.forEach(input => {
                input.addEventListener('click', function(e) {
                    e.stopPropagation();
                });
                
                input.addEventListener('change', function(e) {
                    e.stopPropagation();
                });
                
                input.addEventListener('focus', function(e) {
                    e.stopPropagation();
                });
            });
        }
        
        // åˆå§‹åŒ–è”ç»œå‘˜Agentçš„é…ç½®åŠŸèƒ½
        function initAgentConfiguration() {
            // é¡µç­¾åˆ‡æ¢åŠŸèƒ½
            const messageTemplateTab = document.getElementById('messageTemplateTab');
            const interactionTab = document.getElementById('interactionTab');
            const messageTemplateContent = document.getElementById('messageTemplateContent');
            const interactionContent = document.getElementById('interactionContent');
            
            if (messageTemplateTab) {
                messageTemplateTab.addEventListener('click', function(e) {
                    e.stopPropagation(); // é˜»æ­¢äº‹ä»¶å†’æ³¡
                    
                    // åˆ‡æ¢é¡µç­¾æ ·å¼
                    messageTemplateTab.className = 'tab-button border-b-2 border-blue-500 text-blue-600 py-2 px-1 text-sm font-medium';
                    interactionTab.className = 'tab-button border-b-2 border-transparent text-gray-500 hover:text-gray-700 py-2 px-1 text-sm font-medium';
                    
                    // åˆ‡æ¢å†…å®¹æ˜¾ç¤º
                    messageTemplateContent.classList.remove('hidden');
                    interactionContent.classList.add('hidden');
                });
            }
            
            if (interactionTab) {
                interactionTab.addEventListener('click', function(e) {
                    e.stopPropagation(); // é˜»æ­¢äº‹ä»¶å†’æ³¡
                    
                    // åˆ‡æ¢é¡µç­¾æ ·å¼
                    interactionTab.className = 'tab-button border-b-2 border-blue-500 text-blue-600 py-2 px-1 text-sm font-medium';
                    messageTemplateTab.className = 'tab-button border-b-2 border-transparent text-gray-500 hover:text-gray-700 py-2 px-1 text-sm font-medium';
                    
                    // åˆ‡æ¢å†…å®¹æ˜¾ç¤º
                    interactionContent.classList.remove('hidden');
                    messageTemplateContent.classList.add('hidden');
                });
            }
            
            // æ¨¡æ¿åº“åŠŸèƒ½
            const templateSelect = document.getElementById('templateSelect');
            const messageTemplate = document.getElementById('messageTemplate');
            
            if (templateSelect) {
                templateSelect.addEventListener('change', function(e) {
                    e.stopPropagation(); // é˜»æ­¢äº‹ä»¶å†’æ³¡
                    
                    const selectedTemplate = this.value;
                    if (selectedTemplate && messageTemplate) {
                        const promptContent = getPromptTemplate(selectedTemplate);
                        messageTemplate.value = promptContent;
                    }
                });
                
                // ä¸ºä¸‹æ‹‰èœå•æ·»åŠ ç‚¹å‡»äº‹ä»¶é˜»æ­¢å†’æ³¡
                templateSelect.addEventListener('click', function(e) {
                    e.stopPropagation();
                });
            }
            
            // æ¥æ”¶äººç±»å‹é€‰æ‹©åŠŸèƒ½
            const recipientType = document.getElementById('recipientType');
            const recipientInput = document.getElementById('recipientInput');
            
            if (recipientType && recipientInput) {
                recipientType.addEventListener('change', function(e) {
                    e.stopPropagation(); // é˜»æ­¢äº‹ä»¶å†’æ³¡
                    
                    const selectedType = this.value;
                    
                    if (selectedType === 'asset_owner') {
                        recipientInput.disabled = true;
                        recipientInput.value = '';
                        recipientInput.placeholder = 'ç³»ç»Ÿè‡ªåŠ¨è¯†åˆ«äº‹ä»¶å…³è”èµ„äº§çš„è´£ä»»äºº';
                        recipientInput.classList.add('disabled:bg-gray-100', 'disabled:text-gray-500');
                    } else if (selectedType === 'admin') {
                        recipientInput.disabled = true;
                        recipientInput.value = '';
                        recipientInput.placeholder = 'ç³»ç»Ÿè‡ªåŠ¨æ¨é€ç»™ç®¡ç†å‘˜ç”¨æˆ·ç»„';
                        recipientInput.classList.add('disabled:bg-gray-100', 'disabled:text-gray-500');
                    } else if (selectedType === 'custom') {
                        recipientInput.disabled = false;
                        recipientInput.value = '';
                        recipientInput.placeholder = '@ç”¨æˆ·åæˆ–è§’è‰²ç»„';
                        recipientInput.classList.remove('disabled:bg-gray-100', 'disabled:text-gray-500');
                        recipientInput.focus();
                    }
                });
                
                // ä¸ºä¸‹æ‹‰èœå•æ·»åŠ ç‚¹å‡»äº‹ä»¶é˜»æ­¢å†’æ³¡
                recipientType.addEventListener('click', function(e) {
                    e.stopPropagation();
                });
                
                // åˆå§‹åŒ–çŠ¶æ€
                recipientType.dispatchEvent(new Event('change'));
            }
        }
        
        // è·å–Promptæ¨¡æ¿å†…å®¹
        function getPromptTemplate(templateType) {
            const templates = {
                'security_incident': `# è§’è‰²
ä½ æ˜¯ä¸€ä½é¡¶å°–çš„å®‰å…¨è¿è¥ä¸“å®¶å’Œæ²Ÿé€šå¤§å¸ˆã€‚ä½ çš„ä»»åŠ¡æ˜¯å°†ä¸€ä»½æœºå™¨å¯è¯»çš„JSONæ ¼å¼çš„å®‰å…¨äº‹ä»¶æŠ¥å‘Šï¼Œè½¬æ¢ä¸ºä¸€ä»½æ¸…æ™°ã€å‡†ç¡®ã€ä¸“ä¸šçš„ä¼å¾®é€šçŸ¥æ¶ˆæ¯ï¼Œä»¥ä¾¿ä¸€çº¿åˆ†æå¸ˆèƒ½å¿«é€Ÿç†è§£æƒ…å†µå¹¶åšå‡ºå†³ç­–ã€‚

# ä»»åŠ¡
ä¸¥æ ¼æŒ‰ç…§ä¸‹æ–¹æŒ‡å®šçš„"è¾“å‡ºæ ¼å¼"å’Œ"å†…å®¹è¦æ±‚"ï¼Œæ ¹æ®æä¾›çš„"[äº‹ä»¶JSONæ•°æ®]"ç”Ÿæˆå†…å®¹ã€‚

# è§„åˆ™
1. **å¿ äºåŸæ–‡:** æ‰€æœ‰ä¿¡æ¯éƒ½å¿…é¡»æ¥è‡ªæä¾›çš„JSONï¼Œä¸¥ç¦æœæ’°æˆ–çŒœæµ‹ã€‚
2. **æ™ºèƒ½å¤„ç†ç©ºå€¼:** å¦‚æœJSONä¸­æŸä¸ªå…³é”®ä¿¡æ¯ä¸å­˜åœ¨ï¼ˆå¦‚æ¼æ´ä¿¡æ¯ï¼‰ï¼Œè¯·åœ¨ç”Ÿæˆçš„å†…å®¹ä¸­æ™ºèƒ½åœ°è¯´æ˜æƒ…å†µï¼ˆå¦‚"æš‚æ— å…³è”æ¼æ´ä¿¡æ¯"ï¼‰ï¼Œä»¥ä¿è¯é€šçŸ¥çš„é€šé¡ºå’Œä¸“ä¸šæ€§ã€‚
3. **è¯­è¨€é£æ ¼:** è¯­æ°”å¿…é¡»ä¸“ä¸šã€å†·é™ã€ç´§æ€¥ï¼Œä½†ä¸èƒ½å¼•å‘ä¸å¿…è¦çš„ææ…Œã€‚

# äº‹ä»¶JSONæ•°æ®
[æ­¤å¤„å°†åŠ¨æ€æ’å…¥ä¸Šè¿°ç¤ºä¾‹JSON]

# è¾“å‡ºæ ¼å¼ä¸å†…å®¹è¦æ±‚
ã€å®‰å…¨äº‹ä»¶é€šçŸ¥ã€‘æ‚¨å¥½ï¼æˆ‘æ˜¯æ‚¨çš„å®‰å…¨åŠ©æ‰‹ Botã€‚ç³»ç»Ÿäº [æ¸…æ™°åœ°å†™å‡ºäº‹ä»¶å‘ç”Ÿçš„å…·ä½“æ—¶é—´] ç›‘æµ‹åˆ°ä¸€æ¡ [æ˜ç¡®æŒ‡å‡ºäº‹ä»¶çš„ä¸¥é‡ç­‰çº§]å®‰å…¨äº‹ä»¶ï¼Œè¯·åœ¨ [å†™å‡ºè§„åˆ™ä¸­è®¾å®šçš„å“åº”è¶…æ—¶åˆ†é’Ÿæ•°] åˆ†é’Ÿ å†…ç¡®è®¤å¹¶é€‰æ‹©å¤„ç½®æ–¹å¼ï¼ˆæµ‹è¯•é˜¶æ®µï¼Œå¦‚æœ‰æ‰“æ‰°æ•¬è¯·è«’è§£ï¼Œæˆ–éœ€äººå·¥ååŠ©è¯· @ä¿¡æ¯å®‰å…¨éƒ¨-æœåŠ¡å·ï¼‰ã€‚
â¸»
â€¢ GPTç ”åˆ¤ç»“è®ºï¼š[æ¦‚æ‹¬å¹¶å¡«å…¥AIçš„æ ¸å¿ƒç ”åˆ¤ç»“è®º]
â€¢ å¨èƒç­‰çº§ï¼š[å†æ¬¡æ˜ç¡®å¨èƒç­‰çº§]
â€¢ å—å½±å“èµ„äº§ï¼š[æè¿°å—å½±å“èµ„äº§çš„å…³é”®ä¿¡æ¯ï¼ŒåŒ…æ‹¬å…¶IPã€ç«¯å£å’Œä¸šåŠ¡æè¿°]
â€¢ æ”»å‡»æº IPï¼š[æè¿°æ”»å‡»æºçš„IPåœ°å€åŠå…¶åœ°ç†ä½ç½®]
â€¢ æ£€æµ‹è¯¦æƒ…ï¼š[ä½¿ç”¨GPTç ”åˆ¤çš„æ€»ç»“å†…å®¹]
â¸»
è¯·å›å¤ä»¥ä¸‹ä»»ä¸€æŒ‡ä»¤ï¼ˆ[å†™å‡ºè§„åˆ™ä¸­è®¾å®šçš„å“åº”è¶…æ—¶åˆ†é’Ÿæ•°] åˆ†é’Ÿå†…æœ‰æ•ˆï¼‰ï¼š
è¯¦æƒ…
ä¸€é”®éåˆ¶
æ ‡è®°å®Œæˆ
è°ƒæŸ¥
è‹¥è¶…æ—¶æœªå›å¤ï¼Œäº‹ä»¶å°†è¿›å…¥ã€Œå¾…äººå·¥å¤æ ¸ã€é˜Ÿåˆ—å¹¶æŒç»­ç›‘æ§ã€‚æ„Ÿè°¢é…åˆï¼`,
                
                'asset_exposure': `# è§’è‰²
ä½ æ˜¯ä¸€ä½é¡¶å°–çš„å®‰å…¨è¿è¥ä¸“å®¶å’Œæ²Ÿé€šå¤§å¸ˆã€‚ä½ çš„ä»»åŠ¡æ˜¯å°†ä¸€ä»½æœºå™¨å¯è¯»çš„JSONæ ¼å¼çš„èµ„äº§æš´éœ²äº‹ä»¶æŠ¥å‘Šï¼Œè½¬æ¢ä¸ºä¸€ä»½æ¸…æ™°ã€å‡†ç¡®ã€ä¸“ä¸šçš„ä¼å¾®é€šçŸ¥æ¶ˆæ¯ï¼Œä»¥ä¾¿èµ„äº§è´Ÿè´£äººèƒ½å¿«é€Ÿç†è§£é£é™©å¹¶åšå‡ºå†³ç­–ã€‚

# ä»»åŠ¡
ä¸¥æ ¼æŒ‰ç…§ä¸‹æ–¹æŒ‡å®šçš„"è¾“å‡ºæ ¼å¼"å’Œ"å†…å®¹è¦æ±‚"ï¼Œæ ¹æ®æä¾›çš„"[äº‹ä»¶JSONæ•°æ®]"ç”Ÿæˆå†…å®¹ã€‚

# è§„åˆ™
1. **å¿ äºåŸæ–‡:** æ‰€æœ‰ä¿¡æ¯éƒ½å¿…é¡»æ¥è‡ªæä¾›çš„JSONï¼Œä¸¥ç¦æœæ’°æˆ–çŒœæµ‹ã€‚
2. **æ™ºèƒ½å¤„ç†ç©ºå€¼:** å¦‚æœJSONä¸­æŸä¸ªå…³é”®ä¿¡æ¯ä¸å­˜åœ¨ï¼Œè¯·åœ¨ç”Ÿæˆçš„å†…å®¹ä¸­æ™ºèƒ½åœ°è¯´æ˜æƒ…å†µï¼Œä»¥ä¿è¯é€šçŸ¥çš„é€šé¡ºå’Œä¸“ä¸šæ€§ã€‚
3. **è¯­è¨€é£æ ¼:** è¯­æ°”å¿…é¡»ä¸“ä¸šã€å†·é™ã€æé†’æ€§ï¼Œå¼ºè°ƒé£é™©ä½†é¿å…è¿‡åº¦ææ…Œã€‚

# äº‹ä»¶JSONæ•°æ®
[æ­¤å¤„å°†åŠ¨æ€æ’å…¥èµ„äº§æš´éœ²äº‹ä»¶JSON]

# è¾“å‡ºæ ¼å¼ä¸å†…å®¹è¦æ±‚
ã€èµ„äº§æš´éœ²é€šçŸ¥ã€‘æ‚¨å¥½ï¼æˆ‘æ˜¯æ‚¨çš„å®‰å…¨åŠ©æ‰‹ Botã€‚ç³»ç»Ÿäº [æ¸…æ™°åœ°å†™å‡ºå‘ç°æ—¶é—´] å‘ç°æ‚¨è´Ÿè´£çš„èµ„äº§å­˜åœ¨æ–°çš„äº’è”ç½‘æš´éœ²ï¼Œè¯·åœ¨ [å†™å‡ºè§„åˆ™ä¸­è®¾å®šçš„å“åº”è¶…æ—¶åˆ†é’Ÿæ•°] åˆ†é’Ÿå†…ç¡®è®¤å¤„ç½®æ–¹å¼ã€‚
â¸»
â€¢ GPTç ”åˆ¤ç»“è®ºï¼š[æ¦‚æ‹¬å¹¶å¡«å…¥AIçš„æ ¸å¿ƒé£é™©è¯„ä¼°ç»“è®º]
â€¢ é£é™©ç­‰çº§ï¼š[æ˜ç¡®æŒ‡å‡ºé£é™©ç­‰çº§]
â€¢ æš´éœ²èµ„äº§ï¼š[æè¿°æš´éœ²èµ„äº§çš„å…³é”®ä¿¡æ¯ï¼ŒåŒ…æ‹¬å…¶IPã€ç«¯å£å’Œä¸šåŠ¡æè¿°]
â€¢ æœåŠ¡ç±»å‹ï¼š[æè¿°æš´éœ²çš„æœåŠ¡ç±»å‹å’Œåè®®]
â€¢ æ£€æµ‹è¯¦æƒ…ï¼š[ä½¿ç”¨GPTç ”åˆ¤çš„æ€»ç»“å†…å®¹]
â¸»
è¯·å›å¤ä»¥ä¸‹ä»»ä¸€æŒ‡ä»¤ï¼ˆ[å†™å‡ºè§„åˆ™ä¸­è®¾å®šçš„å“åº”è¶…æ—¶åˆ†é’Ÿæ•°] åˆ†é’Ÿå†…æœ‰æ•ˆï¼‰ï¼š
è¯¦æƒ…
ç¡®è®¤å¤„ç½®
æ ‡è®°å·²çŸ¥
é£é™©è¯„ä¼°
è‹¥è¶…æ—¶æœªå›å¤ï¼Œå°†è‡ªåŠ¨å‡çº§å¤„ç†ã€‚æ„Ÿè°¢é…åˆï¼`,
                
                'vulnerability': `# è§’è‰²
ä½ æ˜¯ä¸€ä½é¡¶å°–çš„å®‰å…¨è¿è¥ä¸“å®¶å’Œæ²Ÿé€šå¤§å¸ˆã€‚ä½ çš„ä»»åŠ¡æ˜¯å°†ä¸€ä»½æœºå™¨å¯è¯»çš„JSONæ ¼å¼çš„æ¼æ´æ£€æµ‹æŠ¥å‘Šï¼Œè½¬æ¢ä¸ºä¸€ä»½æ¸…æ™°ã€å‡†ç¡®ã€ä¸“ä¸šçš„ä¼å¾®é€šçŸ¥æ¶ˆæ¯ï¼Œä»¥ä¾¿èµ„äº§è´Ÿè´£äººèƒ½å¿«é€Ÿç†è§£æ¼æ´é£é™©å¹¶åšå‡ºå¤„ç½®å†³ç­–ã€‚

# ä»»åŠ¡
ä¸¥æ ¼æŒ‰ç…§ä¸‹æ–¹æŒ‡å®šçš„"è¾“å‡ºæ ¼å¼"å’Œ"å†…å®¹è¦æ±‚"ï¼Œæ ¹æ®æä¾›çš„"[äº‹ä»¶JSONæ•°æ®]"ç”Ÿæˆå†…å®¹ã€‚

# è§„åˆ™
1. **å¿ äºåŸæ–‡:** æ‰€æœ‰ä¿¡æ¯éƒ½å¿…é¡»æ¥è‡ªæä¾›çš„JSONï¼Œä¸¥ç¦æœæ’°æˆ–çŒœæµ‹ã€‚
2. **æ™ºèƒ½å¤„ç†ç©ºå€¼:** å¦‚æœJSONä¸­æŸä¸ªå…³é”®ä¿¡æ¯ä¸å­˜åœ¨ï¼ˆå¦‚CVEç¼–å·ï¼‰ï¼Œè¯·åœ¨ç”Ÿæˆçš„å†…å®¹ä¸­æ™ºèƒ½åœ°è¯´æ˜æƒ…å†µï¼Œä»¥ä¿è¯é€šçŸ¥çš„é€šé¡ºå’Œä¸“ä¸šæ€§ã€‚
3. **è¯­è¨€é£æ ¼:** è¯­æ°”å¿…é¡»ä¸“ä¸šã€ç´§è¿«ä½†å†·é™ï¼Œå¼ºè°ƒä¿®å¤çš„é‡è¦æ€§ä½†é¿å…å¼•å‘ææ…Œã€‚

# äº‹ä»¶JSONæ•°æ®
[æ­¤å¤„å°†åŠ¨æ€æ’å…¥æ¼æ´æ£€æµ‹JSON]

# è¾“å‡ºæ ¼å¼ä¸å†…å®¹è¦æ±‚
ã€é«˜å±æ¼æ´é€šçŸ¥ã€‘æ‚¨å¥½ï¼æˆ‘æ˜¯æ‚¨çš„å®‰å…¨åŠ©æ‰‹ Botã€‚ç³»ç»Ÿäº [æ¸…æ™°åœ°å†™å‡ºæ£€æµ‹æ—¶é—´] å‘ç°é«˜ä¼˜å…ˆçº§æ¼æ´ï¼Œè¯·åœ¨ [å†™å‡ºè§„åˆ™ä¸­è®¾å®šçš„å“åº”è¶…æ—¶åˆ†é’Ÿæ•°] åˆ†é’Ÿå†…ç¡®è®¤ä¿®å¤è®¡åˆ’ã€‚
â¸»
â€¢ GPTç ”åˆ¤ç»“è®ºï¼š[æ¦‚æ‹¬å¹¶å¡«å…¥AIçš„æ ¸å¿ƒé£é™©è¯„ä¼°ç»“è®º]
â€¢ æ¼æ´ç­‰çº§ï¼š[å†æ¬¡æ˜ç¡®æ¼æ´ä¸¥é‡ç­‰çº§]
â€¢ æ¼æ´ç¼–å·ï¼š[å¦‚æœå­˜åœ¨CVEç¼–å·åˆ™å¡«å…¥ï¼Œå¦‚ä¸å­˜åœ¨åˆ™è¯´æ˜"æš‚æ— CVEç¼–å·"]
â€¢ å½±å“èµ„äº§ï¼š[æè¿°å—å½±å“èµ„äº§çš„å…³é”®ä¿¡æ¯ï¼ŒåŒ…æ‹¬å…¶IPã€ç«¯å£å’Œä¸šåŠ¡æè¿°]
â€¢ æ£€æµ‹è¯¦æƒ…ï¼š[ä½¿ç”¨GPTç ”åˆ¤çš„æ€»ç»“å†…å®¹]
â¸»
è¯·å›å¤ä»¥ä¸‹ä»»ä¸€æŒ‡ä»¤ï¼ˆ[å†™å‡ºè§„åˆ™ä¸­è®¾å®šçš„å“åº”è¶…æ—¶åˆ†é’Ÿæ•°] åˆ†é’Ÿå†…æœ‰æ•ˆï¼‰ï¼š
è¯¦æƒ…
ç«‹å³ä¿®å¤
è®¡åˆ’ä¿®å¤
é£é™©è¯„ä¼°
è¯·åŠæ—¶å¤„ç†ï¼Œé¿å…å®‰å…¨é£é™©ï¼`,
                
                'business_impact': `# è§’è‰²
ä½ æ˜¯ä¸€ä½é¡¶å°–çš„å®‰å…¨è¿è¥ä¸“å®¶å’Œæ²Ÿé€šå¤§å¸ˆã€‚ä½ çš„ä»»åŠ¡æ˜¯å°†ä¸€ä»½æœºå™¨å¯è¯»çš„JSONæ ¼å¼çš„ä¸šåŠ¡å½±å“è¯„ä¼°æŠ¥å‘Šï¼Œè½¬æ¢ä¸ºä¸€ä»½æ¸…æ™°ã€å‡†ç¡®ã€ä¸“ä¸šçš„ä¼å¾®é€šçŸ¥æ¶ˆæ¯ï¼Œä»¥ä¾¿ä¸šåŠ¡è´Ÿè´£äººèƒ½å¿«é€Ÿç†è§£é£é™©å¹¶ç¡®è®¤å½±å“èŒƒå›´ã€‚

# ä»»åŠ¡
ä¸¥æ ¼æŒ‰ç…§ä¸‹æ–¹æŒ‡å®šçš„"è¾“å‡ºæ ¼å¼"å’Œ"å†…å®¹è¦æ±‚"ï¼Œæ ¹æ®æä¾›çš„"[äº‹ä»¶JSONæ•°æ®]"ç”Ÿæˆå†…å®¹ã€‚

# è§„åˆ™
1. **å¿ äºåŸæ–‡:** æ‰€æœ‰ä¿¡æ¯éƒ½å¿…é¡»æ¥è‡ªæä¾›çš„JSONï¼Œä¸¥ç¦æœæ’°æˆ–çŒœæµ‹ã€‚
2. **æ™ºèƒ½å¤„ç†ç©ºå€¼:** å¦‚æœJSONä¸­æŸä¸ªå…³é”®ä¿¡æ¯ä¸å­˜åœ¨ï¼Œè¯·åœ¨ç”Ÿæˆçš„å†…å®¹ä¸­æ™ºèƒ½åœ°è¯´æ˜æƒ…å†µï¼Œä»¥ä¿è¯é€šçŸ¥çš„é€šé¡ºå’Œä¸“ä¸šæ€§ã€‚
3. **è¯­è¨€é£æ ¼:** è¯­æ°”å¿…é¡»ä¸“ä¸šã€å…³åˆ‡ä½†ä¸å¼•å‘ææ…Œï¼Œå¼ºè°ƒä¸šåŠ¡è¿ç»­æ€§ä¿éšœã€‚

# äº‹ä»¶JSONæ•°æ®
[æ­¤å¤„å°†åŠ¨æ€æ’å…¥ä¸šåŠ¡å½±å“è¯„ä¼°JSON]

# è¾“å‡ºæ ¼å¼ä¸å†…å®¹è¦æ±‚
ã€ä¸šåŠ¡å½±å“ç¡®è®¤ã€‘æ‚¨å¥½ï¼æˆ‘æ˜¯æ‚¨çš„å®‰å…¨åŠ©æ‰‹ Botã€‚ç³»ç»Ÿäº [æ¸…æ™°åœ°å†™å‡ºæ£€æµ‹æ—¶é—´] æ£€æµ‹åˆ°å¯èƒ½å½±å“æ‚¨ä¸šåŠ¡çš„å®‰å…¨äº‹ä»¶ï¼Œè¯·åœ¨ [å†™å‡ºè§„åˆ™ä¸­è®¾å®šçš„å“åº”è¶…æ—¶åˆ†é’Ÿæ•°] åˆ†é’Ÿå†…ç¡®è®¤å½±å“èŒƒå›´ã€‚
â¸»
â€¢ GPTç ”åˆ¤ç»“è®ºï¼š[æ¦‚æ‹¬å¹¶å¡«å…¥AIçš„æ ¸å¿ƒå½±å“è¯„ä¼°ç»“è®º]
â€¢ å¨èƒç­‰çº§ï¼š[æ˜ç¡®æŒ‡å‡ºå¨èƒç­‰çº§]
â€¢ å—å½±å“èµ„äº§ï¼š[æè¿°å—å½±å“èµ„äº§çš„å…³é”®ä¿¡æ¯ï¼ŒåŒ…æ‹¬å…¶IPã€ç«¯å£å’Œä¸šåŠ¡æè¿°]
â€¢ ä¸šåŠ¡å½±å“ï¼š[è¯¦ç»†æè¿°å¯¹ä¸šåŠ¡å¯èƒ½çš„å½±å“èŒƒå›´å’Œä¸¥é‡ç¨‹åº¦]
â€¢ æ£€æµ‹è¯¦æƒ…ï¼š[ä½¿ç”¨GPTç ”åˆ¤çš„æ€»ç»“å†…å®¹]
â¸»
è¯·å›å¤ä»¥ä¸‹ä»»ä¸€æŒ‡ä»¤ï¼ˆ[å†™å‡ºè§„åˆ™ä¸­è®¾å®šçš„å“åº”è¶…æ—¶åˆ†é’Ÿæ•°] åˆ†é’Ÿå†…æœ‰æ•ˆï¼‰ï¼š
è¯¦æƒ…
ç¡®è®¤å½±å“
æ— å½±å“
éœ€è¦æ”¯æŒ
æˆ‘ä»¬å°†æ ¹æ®æ‚¨çš„åé¦ˆåˆ¶å®šç›¸åº”çš„å¤„ç½®æ–¹æ¡ˆã€‚`,
                
                'phishing': `# è§’è‰²
ä½ æ˜¯ä¸€ä½é¡¶å°–çš„å®‰å…¨è¿è¥ä¸“å®¶å’Œæ²Ÿé€šå¤§å¸ˆã€‚ä½ çš„ä»»åŠ¡æ˜¯å°†ä¸€ä»½æœºå™¨å¯è¯»çš„JSONæ ¼å¼çš„é’“é±¼æ”»å‡»æ£€æµ‹æŠ¥å‘Šï¼Œè½¬æ¢ä¸ºä¸€ä»½æ¸…æ™°ã€å‡†ç¡®ã€ä¸“ä¸šçš„ä¼å¾®é€šçŸ¥æ¶ˆæ¯ï¼Œä»¥ä¾¿å—å½±å“äººå‘˜èƒ½å¿«é€Ÿç†è§£å¨èƒå¹¶é‡‡å–æ­£ç¡®é˜²æŠ¤æªæ–½ã€‚

# ä»»åŠ¡
ä¸¥æ ¼æŒ‰ç…§ä¸‹æ–¹æŒ‡å®šçš„"è¾“å‡ºæ ¼å¼"å’Œ"å†…å®¹è¦æ±‚"ï¼Œæ ¹æ®æä¾›çš„"[äº‹ä»¶JSONæ•°æ®]"ç”Ÿæˆå†…å®¹ã€‚

# è§„åˆ™
1. **å¿ äºåŸæ–‡:** æ‰€æœ‰ä¿¡æ¯éƒ½å¿…é¡»æ¥è‡ªæä¾›çš„JSONï¼Œä¸¥ç¦æœæ’°æˆ–çŒœæµ‹ã€‚
2. **æ™ºèƒ½å¤„ç†ç©ºå€¼:** å¦‚æœJSONä¸­æŸä¸ªå…³é”®ä¿¡æ¯ä¸å­˜åœ¨ï¼Œè¯·åœ¨ç”Ÿæˆçš„å†…å®¹ä¸­æ™ºèƒ½åœ°è¯´æ˜æƒ…å†µï¼Œä»¥ä¿è¯é€šçŸ¥çš„é€šé¡ºå’Œä¸“ä¸šæ€§ã€‚
3. **è¯­è¨€é£æ ¼:** è¯­æ°”å¿…é¡»ä¸“ä¸šã€è­¦ç¤ºæ€§ä½†ä¸å¼•å‘ææ…Œï¼Œå¼ºè°ƒç«‹å³é˜²æŠ¤çš„é‡è¦æ€§ã€‚

# äº‹ä»¶JSONæ•°æ®
[æ­¤å¤„å°†åŠ¨æ€æ’å…¥é’“é±¼æ”»å‡»æ£€æµ‹JSON]

# è¾“å‡ºæ ¼å¼ä¸å†…å®¹è¦æ±‚
ã€é’“é±¼äº‹ä»¶é€šçŸ¥ã€‘æ‚¨å¥½ï¼æˆ‘æ˜¯æ‚¨çš„å®‰å…¨åŠ©æ‰‹ Botã€‚ç³»ç»Ÿäº [æ¸…æ™°åœ°å†™å‡ºæ£€æµ‹æ—¶é—´] æ£€æµ‹åˆ°æ‚¨å¯èƒ½é­é‡é’“é±¼æ”»å‡»ï¼Œè¯·åœ¨ [å†™å‡ºè§„åˆ™ä¸­è®¾å®šçš„å“åº”è¶…æ—¶åˆ†é’Ÿæ•°] åˆ†é’Ÿå†…ç¡®è®¤å¤„ç½®æ–¹å¼ã€‚
â¸»
â€¢ GPTç ”åˆ¤ç»“è®ºï¼š[æ¦‚æ‹¬å¹¶å¡«å…¥AIçš„æ ¸å¿ƒå¨èƒåˆ†æç»“è®º]
â€¢ å¨èƒç­‰çº§ï¼š[æ˜ç¡®æŒ‡å‡ºå¨èƒç­‰çº§]
â€¢ å—å½±å“èµ„äº§ï¼š[æè¿°å—å½±å“èµ„äº§çš„å…³é”®ä¿¡æ¯ï¼ŒåŒ…æ‹¬å…¶IPã€ç«¯å£å’Œä¸šåŠ¡æè¿°]
â€¢ æ”»å‡»æº IPï¼š[æè¿°æ”»å‡»æºçš„IPåœ°å€åŠå…¶åœ°ç†ä½ç½®]
â€¢ æ£€æµ‹è¯¦æƒ…ï¼š[ä½¿ç”¨GPTç ”åˆ¤çš„æ€»ç»“å†…å®¹]
â¸»
è¯·å›å¤ä»¥ä¸‹ä»»ä¸€æŒ‡ä»¤ï¼ˆ[å†™å‡ºè§„åˆ™ä¸­è®¾å®šçš„å“åº”è¶…æ—¶åˆ†é’Ÿæ•°] åˆ†é’Ÿå†…æœ‰æ•ˆï¼‰ï¼š
è¯¦æƒ…
ç«‹å³éš”ç¦»
æ ‡è®°è¯¯æŠ¥
ç”³è¯·è°ƒæŸ¥
è¯·å‹¿ç‚¹å‡»ä»»ä½•å¯ç–‘é“¾æ¥ï¼Œå¦‚æœ‰ç–‘é—®è¯·è”ç³»å®‰å…¨å›¢é˜Ÿï¼`,
                
                'custom': `# è§’è‰²
ä½ æ˜¯ä¸€ä½é¡¶å°–çš„å®‰å…¨è¿è¥ä¸“å®¶å’Œæ²Ÿé€šå¤§å¸ˆã€‚ä½ çš„ä»»åŠ¡æ˜¯å°†ä¸€ä»½æœºå™¨å¯è¯»çš„JSONæ ¼å¼çš„å®‰å…¨äº‹ä»¶æŠ¥å‘Šï¼Œè½¬æ¢ä¸ºä¸€ä»½æ¸…æ™°ã€å‡†ç¡®ã€ä¸“ä¸šçš„ä¼å¾®é€šçŸ¥æ¶ˆæ¯ï¼Œä»¥ä¾¿ç›¸å…³äººå‘˜èƒ½å¿«é€Ÿç†è§£æƒ…å†µå¹¶åšå‡ºå†³ç­–ã€‚

# ä»»åŠ¡
ä¸¥æ ¼æŒ‰ç…§ä¸‹æ–¹æŒ‡å®šçš„"è¾“å‡ºæ ¼å¼"å’Œ"å†…å®¹è¦æ±‚"ï¼Œæ ¹æ®æä¾›çš„"[äº‹ä»¶JSONæ•°æ®]"ç”Ÿæˆå†…å®¹ã€‚

# è§„åˆ™
1. **å¿ äºåŸæ–‡:** æ‰€æœ‰ä¿¡æ¯éƒ½å¿…é¡»æ¥è‡ªæä¾›çš„JSONï¼Œä¸¥ç¦æœæ’°æˆ–çŒœæµ‹ã€‚
2. **æ™ºèƒ½å¤„ç†ç©ºå€¼:** å¦‚æœJSONä¸­æŸä¸ªå…³é”®ä¿¡æ¯ä¸å­˜åœ¨ï¼Œè¯·åœ¨ç”Ÿæˆçš„å†…å®¹ä¸­æ™ºèƒ½åœ°è¯´æ˜æƒ…å†µï¼Œä»¥ä¿è¯é€šçŸ¥çš„é€šé¡ºå’Œä¸“ä¸šæ€§ã€‚
3. **è¯­è¨€é£æ ¼:** è¯­æ°”å¿…é¡»ä¸“ä¸šã€ä¸­æ€§ï¼Œæ—¢ä¸è¿‡åº¦ç´§å¼ ä¹Ÿä¸è¿‡äºæ¾æ‡ˆï¼Œç¡®ä¿å‡†ç¡®ä¼ è¾¾äº‹ä»¶ä¿¡æ¯ã€‚

# äº‹ä»¶JSONæ•°æ®
[æ­¤å¤„å°†åŠ¨æ€æ’å…¥å®‰å…¨äº‹ä»¶JSON]

# è¾“å‡ºæ ¼å¼ä¸å†…å®¹è¦æ±‚
ã€å®‰å…¨äº‹ä»¶é€šçŸ¥ã€‘æ‚¨å¥½ï¼æˆ‘æ˜¯æ‚¨çš„å®‰å…¨åŠ©æ‰‹ Botã€‚ç³»ç»Ÿäº [æ¸…æ™°åœ°å†™å‡ºäº‹ä»¶æ—¶é—´] ç›‘æµ‹åˆ°ä¸€æ¡å®‰å…¨äº‹ä»¶ï¼Œè¯·åœ¨ [å†™å‡ºè§„åˆ™ä¸­è®¾å®šçš„å“åº”è¶…æ—¶åˆ†é’Ÿæ•°] åˆ†é’Ÿå†…ç¡®è®¤å¹¶é€‰æ‹©å¤„ç½®æ–¹å¼ã€‚
â¸»
â€¢ GPTç ”åˆ¤ç»“è®ºï¼š[æ¦‚æ‹¬å¹¶å¡«å…¥AIçš„æ ¸å¿ƒåˆ†æç»“è®º]
â€¢ å¨èƒç­‰çº§ï¼š[æ˜ç¡®æŒ‡å‡ºå¨èƒç­‰çº§]
â€¢ å—å½±å“èµ„äº§ï¼š[æè¿°å—å½±å“èµ„äº§çš„å…³é”®ä¿¡æ¯ï¼ŒåŒ…æ‹¬å…¶IPã€ç«¯å£å’Œä¸šåŠ¡æè¿°]
â€¢ æ”»å‡»æº IPï¼š[å¦‚æœ‰æ”»å‡»æºåˆ™æè¿°IPåœ°å€åŠåœ°ç†ä½ç½®ï¼Œå¦‚æ— åˆ™è¯´æ˜"æš‚æ— æ˜ç¡®æ”»å‡»æº"]
â€¢ æ£€æµ‹è¯¦æƒ…ï¼š[ä½¿ç”¨GPTç ”åˆ¤çš„æ€»ç»“å†…å®¹]
â¸»
è¯·å›å¤ä»¥ä¸‹ä»»ä¸€æŒ‡ä»¤ï¼ˆ[å†™å‡ºè§„åˆ™ä¸­è®¾å®šçš„å“åº”è¶…æ—¶åˆ†é’Ÿæ•°] åˆ†é’Ÿå†…æœ‰æ•ˆï¼‰ï¼š
è¯¦æƒ…
ç¡®è®¤å¤„ç½®
æ ‡è®°å®Œæˆ
ç”³è¯·ååŠ©
æ„Ÿè°¢æ‚¨çš„é…åˆï¼`
            };
            
            return templates[templateType] || templates['custom'];
        }
        
        // æ·»åŠ æŒ‡ä»¤è¡Œ
        function addCommandRow() {
            const commandRows = document.getElementById('commandRows');
            if (commandRows) {
                const newRow = document.createElement('div');
                newRow.className = 'command-row grid grid-cols-4 gap-2 items-center';
                newRow.innerHTML = `
                    <input type="text" placeholder="æŒ‡ä»¤æè¿°" class="p-2 border border-gray-300 rounded text-xs">
                    <input type="text" placeholder="å…³é”®è¯" class="p-2 border border-gray-300 rounded text-xs">
                    <input type="text" placeholder="è¾“å‡ºå€¼" class="p-2 border border-gray-300 rounded text-xs">
                    <button class="text-red-600 hover:text-red-800 text-xs" onclick="removeCommandRow(this)">åˆ é™¤</button>
                `;
                commandRows.appendChild(newRow);
            }
        }
        
        // åˆ é™¤æŒ‡ä»¤è¡Œ
        function removeCommandRow(button) {
            const row = button.closest('.command-row');
            if (row) {
                row.remove();
            }
        }

        // è·å–èŠ‚ç‚¹ç±»å‹
        function getNodeType(node) {
            if (node.classList.contains('node-trigger')) return 'trigger';
            if (node.classList.contains('node-ai')) return 'ai';
            if (node.classList.contains('node-agent')) return 'agent';
            if (node.classList.contains('node-soar')) return 'soar';
            if (node.classList.contains('node-human')) return 'human';
            if (node.classList.contains('node-logic')) return 'logic';
            if (node.classList.contains('node-comment') || node.classList.contains('node-group')) return 'comment';
            return 'unknown';
        }

        // è·å–èŠ‚ç‚¹å±æ€§é…ç½®HTML
        function getNodePropertiesHTML(type, node) {
            const nodeTitle = node.querySelector('.font-semibold').textContent;
            
            switch(type) {
                case 'trigger':
                    return `
                        <div class="space-y-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">èŠ‚ç‚¹åç§°</label>
                                <input type="text" value="${nodeTitle}" class="w-full p-2 border border-gray-300 rounded-md">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">è§¦å‘æ¡ä»¶</label>
                                <textarea class="w-full p-2 border border-gray-300 rounded-md h-20" placeholder="è®¾ç½®è§¦å‘æ¡ä»¶..."></textarea>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">ä¼˜å…ˆçº§</label>
                                <select class="w-full p-2 border border-gray-300 rounded-md">
                                    <option>é«˜</option>
                                    <option>ä¸­</option>
                                    <option>ä½</option>
                                </select>
                            </div>
                        </div>
                    `;
                case 'agent':
                    return `
                        <div class="space-y-4">
                            <!-- ä¸“ä¸šè¯´æ˜ -->
                            <div class="bg-purple-50 border border-purple-200 rounded-md p-3">
                                <div class="flex items-center mb-1">
                                    <i class="fas fa-user-tie text-purple-600 mr-2"></i>
                                    <span class="text-sm font-medium text-purple-900">å®‰å…¨è¿è¥ä¸“å®¶ - æ™ºèƒ½è”ç»œå‘˜Agent</span>
                                </div>
                                <div class="text-xs text-purple-700">
                                    å°†JSONæ ¼å¼å®‰å…¨äº‹ä»¶æŠ¥å‘Šè½¬æ¢ä¸ºæ¸…æ™°ã€å‡†ç¡®ã€ä¸“ä¸šçš„ä¼å¾®é€šçŸ¥æ¶ˆæ¯ï¼Œç¡®ä¿ä¸€çº¿åˆ†æå¸ˆå¿«é€Ÿç†è§£å¹¶å†³ç­–
                                </div>
                            </div>
                            
                            <!-- é¡µç­¾å¯¼èˆª -->
                            <div class="border-b border-gray-200">
                                <nav class="flex space-x-6">
                                    <button id="messageTemplateTab" class="tab-button border-b-2 border-blue-500 text-blue-600 py-2 px-1 text-sm font-medium">
                                        Promptå·¥ç¨‹
                                    </button>
                                    <button id="interactionTab" class="tab-button border-b-2 border-transparent text-gray-500 hover:text-gray-700 py-2 px-1 text-sm font-medium">
                                        äº¤äº’ä¸åˆ†æ”¯
                                    </button>
                                </nav>
                            </div>
                            
                            <!-- Promptå·¥ç¨‹é¡µç­¾å†…å®¹ -->
                            <div id="messageTemplateContent" class="tab-content">
                        <div class="space-y-4">
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-2">ä»Promptåº“é€‰æ‹©</label>
                                        <select id="templateSelect" class="w-full p-2 border border-gray-300 rounded-md bg-blue-50 border-blue-200">
                                            <option value="">é€‰æ‹©é¢„è®¾Prompt...</option>
                                            <option value="security_incident">[å®˜æ–¹] é‡å¤§å®‰å…¨äº‹ä»¶å“åº”Prompt</option>
                                            <option value="asset_exposure">[å®˜æ–¹] ä¸šåŠ¡å‘ç°æ–°çš„æš´éœ²é¢å“åº”Prompt</option>
                                            <option value="vulnerability">[å®˜æ–¹] é«˜ä¼˜å…ˆçº§æ¼æ´å“åº”é—­ç¯Prompt</option>
                                            <option value="business_impact">[å®˜æ–¹] ä¸šåŠ¡å½±å“ç¡®è®¤Prompt</option>
                                            <option value="phishing">[å®˜æ–¹] é’“é±¼äº‹ä»¶å¤„ç½®Prompt</option>
                                            <option value="custom">è‡ªå®šä¹‰Prompt</option>
                                        </select>
                                    </div>
                                    
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-2">Promptå†…å®¹</label>
                                        <textarea id="messageTemplate" class="w-full p-3 border border-gray-300 rounded-md h-48 font-mono text-sm" placeholder="é€‰æ‹©Promptåæ­¤å¤„å°†è‡ªåŠ¨å¡«å……å†…å®¹..."># è§’è‰²
ä½ æ˜¯ä¸€ä½é¡¶å°–çš„å®‰å…¨è¿è¥ä¸“å®¶å’Œæ²Ÿé€šå¤§å¸ˆã€‚ä½ çš„ä»»åŠ¡æ˜¯å°†ä¸€ä»½æœºå™¨å¯è¯»çš„JSONæ ¼å¼çš„å®‰å…¨äº‹ä»¶æŠ¥å‘Šï¼Œè½¬æ¢ä¸ºä¸€ä»½æ¸…æ™°ã€å‡†ç¡®ã€ä¸“ä¸šçš„ä¼å¾®é€šçŸ¥æ¶ˆæ¯ï¼Œä»¥ä¾¿ä¸€çº¿åˆ†æå¸ˆèƒ½å¿«é€Ÿç†è§£æƒ…å†µå¹¶åšå‡ºå†³ç­–ã€‚

# ä»»åŠ¡
ä¸¥æ ¼æŒ‰ç…§ä¸‹æ–¹æŒ‡å®šçš„"è¾“å‡ºæ ¼å¼"å’Œ"å†…å®¹è¦æ±‚"ï¼Œæ ¹æ®æä¾›çš„"[äº‹ä»¶JSONæ•°æ®]"ç”Ÿæˆå†…å®¹ã€‚

# è§„åˆ™
1. **å¿ äºåŸæ–‡:** æ‰€æœ‰ä¿¡æ¯éƒ½å¿…é¡»æ¥è‡ªæä¾›çš„JSONï¼Œä¸¥ç¦æœæ’°æˆ–çŒœæµ‹ã€‚
2. **æ™ºèƒ½å¤„ç†ç©ºå€¼:** å¦‚æœJSONä¸­æŸä¸ªå…³é”®ä¿¡æ¯ä¸å­˜åœ¨ï¼ˆå¦‚æ¼æ´ä¿¡æ¯ï¼‰ï¼Œè¯·åœ¨ç”Ÿæˆçš„å†…å®¹ä¸­æ™ºèƒ½åœ°è¯´æ˜æƒ…å†µï¼ˆå¦‚"æš‚æ— å…³è”æ¼æ´ä¿¡æ¯"ï¼‰ï¼Œä»¥ä¿è¯é€šçŸ¥çš„é€šé¡ºå’Œä¸“ä¸šæ€§ã€‚
3. **è¯­è¨€é£æ ¼:** è¯­æ°”å¿…é¡»ä¸“ä¸šã€å†·é™ã€ç´§æ€¥ï¼Œä½†ä¸èƒ½å¼•å‘ä¸å¿…è¦çš„ææ…Œã€‚

# äº‹ä»¶JSONæ•°æ®
[æ­¤å¤„å°†åŠ¨æ€æ’å…¥ä¸Šè¿°ç¤ºä¾‹JSON]

# è¾“å‡ºæ ¼å¼ä¸å†…å®¹è¦æ±‚
ã€å®‰å…¨äº‹ä»¶é€šçŸ¥ã€‘æ‚¨å¥½ï¼æˆ‘æ˜¯æ‚¨çš„å®‰å…¨åŠ©æ‰‹ Botã€‚ç³»ç»Ÿäº [æ¸…æ™°åœ°å†™å‡ºäº‹ä»¶å‘ç”Ÿçš„å…·ä½“æ—¶é—´] ç›‘æµ‹åˆ°ä¸€æ¡ [æ˜ç¡®æŒ‡å‡ºäº‹ä»¶çš„ä¸¥é‡ç­‰çº§]å®‰å…¨äº‹ä»¶ï¼Œè¯·åœ¨ [å†™å‡ºè§„åˆ™ä¸­è®¾å®šçš„å“åº”è¶…æ—¶åˆ†é’Ÿæ•°] åˆ†é’Ÿ å†…ç¡®è®¤å¹¶é€‰æ‹©å¤„ç½®æ–¹å¼ï¼ˆæµ‹è¯•é˜¶æ®µï¼Œå¦‚æœ‰æ‰“æ‰°æ•¬è¯·è«’è§£ï¼Œæˆ–éœ€äººå·¥ååŠ©è¯· @ä¿¡æ¯å®‰å…¨éƒ¨-æœåŠ¡å·ï¼‰ã€‚
â¸»
â€¢ GPTç ”åˆ¤ç»“è®ºï¼š[æ¦‚æ‹¬å¹¶å¡«å…¥AIçš„æ ¸å¿ƒç ”åˆ¤ç»“è®º]
â€¢ å¨èƒç­‰çº§ï¼š[å†æ¬¡æ˜ç¡®å¨èƒç­‰çº§]
â€¢ å—å½±å“èµ„äº§ï¼š[æè¿°å—å½±å“èµ„äº§çš„å…³é”®ä¿¡æ¯ï¼ŒåŒ…æ‹¬å…¶IPã€ç«¯å£å’Œä¸šåŠ¡æè¿°]
â€¢ æ”»å‡»æº IPï¼š[æè¿°æ”»å‡»æºçš„IPåœ°å€åŠå…¶åœ°ç†ä½ç½®]
â€¢ æ£€æµ‹è¯¦æƒ…ï¼š[ä½¿ç”¨GPTç ”åˆ¤çš„æ€»ç»“å†…å®¹]
â¸»
è¯·å›å¤ä»¥ä¸‹ä»»ä¸€æŒ‡ä»¤ï¼ˆ[å†™å‡ºè§„åˆ™ä¸­è®¾å®šçš„å“åº”è¶…æ—¶åˆ†é’Ÿæ•°] åˆ†é’Ÿå†…æœ‰æ•ˆï¼‰ï¼š
è¯¦æƒ…
ä¸€é”®éåˆ¶
æ ‡è®°å®Œæˆ
è°ƒæŸ¥
è‹¥è¶…æ—¶æœªå›å¤ï¼Œäº‹ä»¶å°†è¿›å…¥ã€Œå¾…äººå·¥å¤æ ¸ã€é˜Ÿåˆ—å¹¶æŒç»­ç›‘æ§ã€‚æ„Ÿè°¢é…åˆï¼</textarea>
                                    </div>
                                    
                                    <div class="bg-blue-50 border border-blue-200 rounded-md p-3">
                                        <h5 class="text-sm font-medium text-blue-900 mb-2">Promptå·¥ç¨‹è¯´æ˜</h5>
                                        <div class="text-xs text-blue-700 space-y-1">
                                            <div class="mb-2"><strong>JSONæ•°æ®åŠ¨æ€æ’å…¥ï¼š</strong>å®‰å…¨äº‹ä»¶çš„å®Œæ•´JSONå°†åœ¨è¿è¡Œæ—¶è‡ªåŠ¨æ’å…¥åˆ°"[äº‹ä»¶JSONæ•°æ®]"å ä½ç¬¦ä½ç½®</div>
                                            <div class="mb-2"><strong>è¾“å‡ºæ ¼å¼æŒ‡å¼•ï¼š</strong>ä½¿ç”¨æ–¹æ‹¬å·[]æ ‡è®°çš„å†…å®¹ä¸ºAIéœ€è¦æ™ºèƒ½æå–å’Œè½¬æ¢çš„ä¿¡æ¯ï¼Œç¡®ä¿ï¼š</div>
                                            <div class="ml-2">â€¢ ä¸¥æ ¼å¿ äºJSONåŸæ–‡ï¼Œç¦æ­¢æœæ’°</div>
                                            <div class="ml-2">â€¢ æ™ºèƒ½å¤„ç†ç©ºå€¼æˆ–ç¼ºå¤±å­—æ®µ</div>
                                            <div class="ml-2">â€¢ ä¿æŒä¸“ä¸šå®‰å…¨è¿è¥è¯­æ°”</div>
                                            <div class="ml-2">â€¢ æ ¹æ®äº‹ä»¶ç±»å‹è°ƒæ•´è¯­è¨€ç´§æ€¥ç¨‹åº¦</div>
                                            <div class="mt-2"><strong>æ ¸å¿ƒå˜é‡æ˜ å°„ï¼š</strong></div>
                                            <div class="ml-2">äº‹ä»¶æ—¶é—´ã€ä¸¥é‡ç­‰çº§ã€å—å½±å“èµ„äº§ã€æ”»å‡»æºä¿¡æ¯ã€GPTç ”åˆ¤ç»“è®ºã€æ£€æµ‹è¯¦æƒ…ã€å“åº”è¶…æ—¶æ—¶é—´ç­‰</div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- äº¤äº’ä¸åˆ†æ”¯é¡µç­¾å†…å®¹ -->
                            <div id="interactionContent" class="tab-content hidden">
                                <div class="space-y-4">
                                    <div class="bg-amber-50 border border-amber-200 rounded-md p-3">
                                        <div class="flex items-center mb-1">
                                            <i class="fas fa-lightbulb text-amber-600 mr-2"></i>
                                            <span class="text-sm font-medium text-amber-900">ä¸“ä¸šè®¾è®¡ç†å¿µ</span>
                                        </div>
                                        <div class="text-xs text-amber-700">
                                            é‡‡ç”¨å†·é™ã€ä¸“ä¸šã€ç´§æ€¥ä½†ä¸å¼•å‘ææ…Œçš„è¯­æ°”ï¼ŒæŒ‡ä»¤è®¾è®¡åŸºäºå®‰å…¨è¿è¥å®æˆ˜éœ€æ±‚ï¼Œç¡®ä¿é«˜å‹ç¯å¢ƒä¸‹å¿«é€Ÿå†³ç­–
                                        </div>
                                    </div>
                                    
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-2">æ¥æ”¶äººé…ç½®</label>
                                        <div class="space-y-3">
                                            <div>
                                                <label class="block text-xs font-medium text-gray-600 mb-1">æ¥æ”¶äººç±»å‹</label>
                                                <select id="recipientType" class="w-full p-2 border border-gray-300 rounded-md bg-gray-50 text-sm">
                                                    <option value="asset_owner">èµ„äº§è´£ä»»äºº</option>
                                                    <option value="admin">ç®¡ç†å‘˜</option>
                                                    <option value="custom">è‡ªå®šä¹‰</option>
                                                </select>
                                            </div>
                                            <div>
                                                <label class="block text-xs font-medium text-gray-600 mb-1">å…·ä½“æ¥æ”¶äºº</label>
                                                <input type="text" id="recipientInput" placeholder="@ç”¨æˆ·åæˆ–è§’è‰²ç»„ï¼ˆå½“é€‰æ‹©è‡ªå®šä¹‰æ—¶å¡«å†™ï¼‰" class="w-full p-2 border border-gray-300 rounded-md disabled:bg-gray-100 disabled:text-gray-500">
                                            </div>
                                            <div class="flex items-center space-x-2">
                                                <input type="number" value="15" class="w-20 p-2 border border-gray-300 rounded-md">
                                                <span class="text-sm text-gray-600">åˆ†é’Ÿåå‡çº§ç»™ç®¡ç†å‘˜</span>
                                            </div>
                                        </div>
                                    </div>
                                    
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">é€šçŸ¥æ¸ é“</label>
                                <div class="space-y-2">
                                    <label class="flex items-center">
                                        <input type="checkbox" checked class="mr-2">
                                        <span class="text-sm">ä¼ä¸šå¾®ä¿¡</span>
                                    </label>
                                    <label class="flex items-center">
                                        <input type="checkbox" class="mr-2">
                                        <span class="text-sm">é‚®ä»¶</span>
                                    </label>
                                    <label class="flex items-center">
                                        <input type="checkbox" class="mr-2">
                                        <span class="text-sm">çŸ­ä¿¡</span>
                                    </label>
                                </div>
                            </div>
                                    
                            <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-2">ç”¨æˆ·æŒ‡ä»¤é…ç½®</label>
                                        <div class="text-xs text-gray-500 mb-3 bg-yellow-50 p-2 rounded">
                                            ğŸ’¡ æ‚¨åœ¨è¿™é‡Œé…ç½®çš„æ¯ä¸€æ¡æŒ‡ä»¤ï¼Œéƒ½ä¼šåœ¨å·¥ä½œæµç”»å¸ƒçš„èŠ‚ç‚¹ä¸Šç”Ÿæˆä¸€ä¸ªå¯¹åº”çš„"è¾“å‡ºé”šç‚¹"ï¼Œç”¨äºè¿æ¥åç»­çš„æµç¨‹ã€‚
                            </div>
                                        
                                        <div class="space-y-3">
                                            <div class="border rounded-md p-3 bg-gray-50">
                                                <div class="flex items-center justify-between mb-2">
                                                    <span class="text-sm font-medium text-gray-700">æŒ‡ä»¤é…ç½®</span>
                                                    <button class="text-blue-600 hover:text-blue-800 text-sm" onclick="addCommandRow()">+ æ·»åŠ æŒ‡ä»¤</button>
                                                </div>
                                                
                                                <div class="space-y-2" id="commandRows">
                                                    <div class="command-row grid grid-cols-4 gap-2 items-center">
                                                        <input type="text" placeholder="æŒ‡ä»¤æè¿°" value="æŸ¥çœ‹å®Œæ•´åŸå§‹æ—¥å¿—ä¸ä¸Šä¸‹æ–‡" class="p-2 border border-gray-300 rounded text-xs">
                                                        <input type="text" placeholder="å…³é”®è¯" value="è¯¦æƒ…" class="p-2 border border-gray-300 rounded text-xs">
                                                        <input type="text" placeholder="è¾“å‡ºå€¼" value="get_details" class="p-2 border border-gray-300 rounded text-xs">
                                                        <button class="text-red-600 hover:text-red-800 text-xs" onclick="removeCommandRow(this)">åˆ é™¤</button>
                                                    </div>
                                                    
                                                    <div class="command-row grid grid-cols-4 gap-2 items-center">
                                                        <input type="text" placeholder="æŒ‡ä»¤æè¿°" value="æŒ‡æ´¾å¤„ç½®Agentå°ç¦æ¶æ„å®ä½“" class="p-2 border border-gray-300 rounded text-xs">
                                                        <input type="text" placeholder="å…³é”®è¯" value="ä¸€é”®éåˆ¶" class="p-2 border border-gray-300 rounded text-xs">
                                                        <input type="text" placeholder="è¾“å‡ºå€¼" value="containment_approved" class="p-2 border border-gray-300 rounded text-xs">
                                                        <button class="text-red-600 hover:text-red-800 text-xs" onclick="removeCommandRow(this)">åˆ é™¤</button>
                                                    </div>
                                                    
                                                    <div class="command-row grid grid-cols-4 gap-2 items-center">
                                                        <input type="text" placeholder="æŒ‡ä»¤æè¿°" value="ç›´æ¥æ ‡è®°å®Œæˆè¯¥äº‹ä»¶" class="p-2 border border-gray-300 rounded text-xs">
                                                        <input type="text" placeholder="å…³é”®è¯" value="æ ‡è®°å®Œæˆ" class="p-2 border border-gray-300 rounded text-xs">
                                                        <input type="text" placeholder="è¾“å‡ºå€¼" value="marked_as_done" class="p-2 border border-gray-300 rounded text-xs">
                                                        <button class="text-red-600 hover:text-red-800 text-xs" onclick="removeCommandRow(this)">åˆ é™¤</button>
                                                    </div>
                                                    
                                                    <div class="command-row grid grid-cols-4 gap-2 items-center">
                                                        <input type="text" placeholder="æŒ‡ä»¤æè¿°" value="æŒ‡æ´¾è°ƒæŸ¥Agentæ·±å…¥æº¯æºè°ƒæŸ¥" class="p-2 border border-gray-300 rounded text-xs">
                                                        <input type="text" placeholder="å…³é”®è¯" value="è°ƒæŸ¥" class="p-2 border border-gray-300 rounded text-xs">
                                                        <input type="text" placeholder="è¾“å‡ºå€¼" value="re_investigate" class="p-2 border border-gray-300 rounded text-xs">
                                                        <button class="text-red-600 hover:text-red-800 text-xs" onclick="removeCommandRow(this)">åˆ é™¤</button>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <div class="bg-green-50 border border-green-200 rounded-md p-3">
                                        <h5 class="text-sm font-medium text-green-900 mb-2">è¾“å‡ºé”šç‚¹é¢„è§ˆ</h5>
                                        <div class="text-xs text-green-700 space-y-1">
                                            <div>â€¢ <code>get_details</code> - æŸ¥çœ‹è¯¦æƒ…åˆ†æ”¯</div>
                                            <div>â€¢ <code>containment_approved</code> - ä¸€é”®éåˆ¶åˆ†æ”¯</div>
                                            <div>â€¢ <code>marked_as_done</code> - æ ‡è®°å®Œæˆåˆ†æ”¯</div>
                                            <div>â€¢ <code>re_investigate</code> - è°ƒæŸ¥åˆ†æ”¯</div>
                                        </div>
                                        <div class="mt-2 text-xs text-green-600">
                                            ğŸ’¡ åŸºäºä¸“ä¸šå®‰å…¨è¿è¥è¦æ±‚ï¼ŒæŒ‡ä»¤ç®€åŒ–ä¸º4ä¸ªæ ¸å¿ƒæ“ä½œï¼Œç¡®ä¿ä¸€çº¿åˆ†æå¸ˆèƒ½å¿«é€Ÿå†³ç­–
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    `;
                case 'ai':
                    return `
                        <div class="space-y-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">AIæ¨¡å‹</label>
                                <select class="w-full p-2 border border-gray-300 rounded-md">
                                    <option>GPT-4</option>
                                    <option>Claude-3</option>
                                    <option>æ–‡å¿ƒä¸€è¨€</option>
                                </select>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">è‡ªå®šä¹‰Prompt</label>
                                <textarea class="w-full p-2 border border-gray-300 rounded-md h-32" placeholder="è¾“å…¥è‡ªå®šä¹‰æç¤ºè¯..."></textarea>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">çŸ¥è¯†åº“</label>
                                <select class="w-full p-2 border border-gray-300 rounded-md">
                                    <option>å®‰å…¨äº‹ä»¶åº“</option>
                                    <option>å¨èƒæƒ…æŠ¥åº“</option>
                                    <option>èµ„äº§ä¿¡æ¯åº“</option>
                                </select>
                            </div>
                        </div>
                    `;
                case 'soar':
                    if (nodeTitle.includes('å·¥å•')) {
                        return `
                            <div class="space-y-4">
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">å·¥å•ç³»ç»Ÿ</label>
                                    <select class="w-full p-2 border border-gray-300 rounded-md">
                                        <option>ServiceNow</option>
                                        <option>Jira Service Desk</option>
                                        <option>ä¼ä¸šå†…éƒ¨å·¥å•ç³»ç»Ÿ</option>
                                        <option>é’‰é’‰å·¥å•</option>
                                    </select>
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">å·¥å•ç±»å‹</label>
                                    <select class="w-full p-2 border border-gray-300 rounded-md">
                                        <option>å®‰å…¨äº‹ä»¶å¤„ç½®</option>
                                        <option>æ¼æ´ä¿®å¤</option>
                                        <option>ç³»ç»Ÿç»´æŠ¤</option>
                                        <option>æƒé™ç”³è¯·</option>
                                    </select>
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">ä¼˜å…ˆçº§</label>
                                    <select class="w-full p-2 border border-gray-300 rounded-md">
                                        <option>ç´§æ€¥</option>
                                        <option>é«˜</option>
                                        <option>ä¸­</option>
                                        <option>ä½</option>
                                    </select>
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">åˆ†é…ç»™</label>
                                    <input type="text" placeholder="ç”¨æˆ·åæˆ–è§’è‰²ç»„" class="w-full p-2 border border-gray-300 rounded-md">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">å·¥å•æ¨¡æ¿</label>
                                    <textarea class="w-full p-2 border border-gray-300 rounded-md h-20" placeholder="å·¥å•æè¿°æ¨¡æ¿...">${nodeTitle.includes('å·¥å•') ? 'å®‰å…¨äº‹ä»¶: {{äº‹ä»¶ID}}\näº‹ä»¶ç±»å‹: {{äº‹ä»¶ç±»å‹}}\nå½±å“èµ„äº§: {{èµ„äº§åˆ—è¡¨}}\nå»ºè®®å¤„ç½®: {{AIå»ºè®®}}' : ''}</textarea>
                                </div>
                                <div class="flex items-center">
                                    <input type="checkbox" checked class="mr-2">
                                    <label class="text-sm text-gray-700">è‡ªåŠ¨åˆ›å»ºå·¥å•</label>
                                </div>
                                <div class="flex items-center">
                                    <input type="checkbox" class="mr-2">
                                    <label class="text-sm text-gray-700">ç­‰å¾…å·¥å•å®Œæˆåç»§ç»­</label>
                                </div>
                            </div>
                        `;
                    } else {
                        return `
                            <div class="space-y-4">
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Playbookåç§°</label>
                                    <input type="text" value="${nodeTitle}" class="w-full p-2 border border-gray-300 rounded-md">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">SOARå¹³å°</label>
                                    <select class="w-full p-2 border border-gray-300 rounded-md">
                                        <option>Phantom</option>
                                        <option>Demisto</option>
                                        <option>IBM Resilient</option>
                                        <option>è‡ªå®šä¹‰SOAR</option>
                                    </select>
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">æ‰§è¡Œå‚æ•°</label>
                                    <textarea class="w-full p-2 border border-gray-300 rounded-md h-20" placeholder="JSONæ ¼å¼å‚æ•°..."></textarea>
                                </div>
                            </div>
                        `;
                    }
                case 'comment':
                    return `
                        <div class="space-y-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">è¯´æ˜æ ‡é¢˜</label>
                                <input type="text" value="${nodeTitle}" class="w-full p-2 border border-gray-300 rounded-md">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">è¯´æ˜å†…å®¹</label>
                                <textarea class="w-full p-2 border border-gray-300 rounded-md h-32" placeholder="è¾“å…¥è¯¦ç»†è¯´æ˜..."></textarea>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">èƒŒæ™¯é¢œè‰²</label>
                                <select class="w-full p-2 border border-gray-300 rounded-md">
                                    <option value="yellow">é»„è‰²</option>
                                    <option value="blue">è“è‰²</option>
                                    <option value="green">ç»¿è‰²</option>
                                    <option value="red">çº¢è‰²</option>
                                    <option value="gray">ç°è‰²</option>
                                </select>
                            </div>
                        </div>
                    `;
                default:
                    return `
                        <div class="space-y-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">èŠ‚ç‚¹åç§°</label>
                                <input type="text" value="${nodeTitle}" class="w-full p-2 border border-gray-300 rounded-md">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">æè¿°</label>
                                <textarea class="w-full p-2 border border-gray-300 rounded-md h-20" placeholder="èŠ‚ç‚¹æè¿°..."></textarea>
                            </div>
                        </div>
                    `;
            }
        }

        // å¼€å§‹è°ƒè¯•æ¨¡å¼
        function startDebugMode() {
            isDebugMode = true;
            document.getElementById('debugModal').classList.add('hidden');
            
            // é«˜äº®æ˜¾ç¤ºæ‰§è¡Œè·¯å¾„
            const executionPath = [
                'start-node', 'agent-node', 'investigate-agent', 
                'disposal-agent', 'ticket-node', 'soar-playbook', 'ai-report'
            ];
            
            let currentStep = 0;
            
            function highlightNextStep() {
                // ç§»é™¤ä¹‹å‰çš„é«˜äº®
                document.querySelectorAll('.debug-highlight').forEach(el => {
                    el.classList.remove('debug-highlight');
                });
                
                if (currentStep < executionPath.length) {
                    const currentNode = document.getElementById(executionPath[currentStep]);
                    if (currentNode) {
                        currentNode.classList.add('debug-highlight');
                        
                        // æ¨¡æ‹Ÿå¤„ç†æ—¶é—´
                        setTimeout(() => {
                            currentStep++;
                            highlightNextStep();
                        }, 2000);
                    }
                } else {
                    // è°ƒè¯•å®Œæˆ
                    isDebugMode = false;
                    showDebugComplete();
                }
            }
            
            highlightNextStep();
        }

        // æ˜¾ç¤ºè°ƒè¯•å®Œæˆ
        function showDebugComplete() {
            alert('å·¥ä½œæµè°ƒè¯•å®Œæˆï¼\n\næ‰§è¡Œè·¯å¾„ï¼š\n1. è§¦å‘é‡å¤§å®‰å…¨äº‹ä»¶\n2. è”ç»œå‘˜Agentæ¨é€é€šçŸ¥\n3. è°ƒæŸ¥æº¯æºAgentåˆ†æ\n4. å¤„ç½®å°å µAgentæ‰§è¡Œ\n5. åˆ›å»ºå·¥å•è®°å½•\n6. SOARå¼•æ“è°ƒç”¨\n7. AIç”Ÿæˆé—­ç¯æŠ¥å‘Š');
        }

        // ä¿å­˜å·¥ä½œæµ
        function saveWorkflow() {
            const workflow = {
                nodes: [],
                connections: []
            };
            
            // æ”¶é›†èŠ‚ç‚¹ä¿¡æ¯
            document.querySelectorAll('.workflow-node').forEach(node => {
                workflow.nodes.push({
                    id: node.id,
                    type: getNodeType(node),
                    position: {
                        x: parseInt(node.style.left),
                        y: parseInt(node.style.top)
                    },
                    title: node.querySelector('.font-semibold').textContent
                });
            });
            
            // æ”¶é›†è¿æ¥ä¿¡æ¯
            jsPlumbInstance.getAllConnections().forEach(conn => {
                workflow.connections.push({
                    source: conn.sourceId,
                    target: conn.targetId
                });
            });
            
            console.log('å·¥ä½œæµå·²ä¿å­˜:', workflow);
            alert('å·¥ä½œæµä¿å­˜æˆåŠŸï¼');
        }

        // å‘å¸ƒå·¥ä½œæµ
        function publishWorkflow() {
            if (confirm('ç¡®å®šè¦å‘å¸ƒæ­¤å·¥ä½œæµå—ï¼Ÿå‘å¸ƒåå°†å¼€å§‹ç›‘æ§å’Œè‡ªåŠ¨æ‰§è¡Œã€‚')) {
                alert('å·¥ä½œæµå‘å¸ƒæˆåŠŸï¼\n\nçŠ¶æ€ï¼šå·²æ¿€æ´»\nç›‘æ§ï¼š24/7\né¢„è®¡å“åº”æ—¶é—´ï¼š< 5åˆ†é’Ÿ');
            }
        }

        // æ›´æ–°èŠ‚ç‚¹è®¡æ•°
        function updateNodeCount() {
            const nodeCount = document.querySelectorAll('.workflow-node').length;
            document.getElementById('nodeCount').textContent = nodeCount;
        }

        // æ›´æ–°è¿æ¥è®¡æ•°
        function updateConnectionCount() {
            const connectionCount = jsPlumbInstance.getAllConnections().length;
            document.getElementById('connectionCount').textContent = connectionCount;
        }

        // æ–­å¼€èŠ‚ç‚¹è¿æ¥
        function disconnectNode(node) {
            const connections = jsPlumbInstance.getAllConnections();
            const nodeId = node.id;
            
            connections.forEach(conn => {
                if (conn.sourceId === nodeId || conn.targetId === nodeId) {
                    jsPlumbInstance.deleteConnection(conn);
                }
            });
            
            updateConnectionCount();
        }

        // è·å–èŠ‚ç‚¹å­ç±»å‹
        function getNodeSubtype(node) {
            const title = node.querySelector('.font-semibold').textContent;
            
            // æ ¹æ®æ ‡é¢˜åˆ¤æ–­å­ç±»å‹ï¼ˆç®€å•å®ç°ï¼‰
            if (title.includes('å‘Šè­¦')) return 'alert';
            if (title.includes('äº‹ä»¶')) return 'event';
            if (title.includes('Webhook')) return 'webhook';
            if (title.includes('è°ƒæŸ¥')) return 'investigate';
            if (title.includes('å¤„ç½®') || title.includes('å®ä½“')) return 'disposal';
            if (title.includes('è‡ªå®šä¹‰')) return 'custom';
            if (title.includes('è”ç»œ')) return 'contact';
            if (title.includes('Playbook')) return 'playbook';
            if (title.includes('å·¥å•')) return 'ticket';
            if (title.includes('ç¡®è®¤')) return 'confirm';
            if (title.includes('æ¡ä»¶')) return 'condition';
            if (title.includes('æ–‡å­—')) return 'text';
            if (title.includes('åˆ†ç»„')) return 'group';
            
            return 'default';
        }

        // ============= æ¨¡æ¿å•†åº—åŠŸèƒ½ =============
        
        // å·¥ä½œæµæ¨¡æ¿å®šä¹‰
        const workflowTemplates = {
            'demo-agent-contact': {
                name: 'æ¼”ç¤ºè”ç»œå‘˜Agent',
                description: 'æ™ºèƒ½å®‰å…¨è¿è¥ä¸“å®¶ï¼Œå°†JSONäº‹ä»¶è½¬æ¢ä¸ºä¸“ä¸šä¼å¾®é€šçŸ¥æ¶ˆæ¯',
                nodes: [
                    { id: 'trigger-demo', type: 'trigger', subtype: 'alert', title: 'å®‰å…¨äº‹ä»¶è§¦å‘', x: 100, y: 200, icon: 'exclamation-triangle', color: 'red' },
                    { id: 'agent-demo', type: 'agent', subtype: 'contact', title: 'è”ç»œå‘˜Agent', x: 400, y: 200, icon: 'user-tie', color: 'purple' },
                    { id: 'detail-demo', type: 'ai', subtype: 'custom', title: 'è¯¦æƒ…ä¿¡æ¯', x: 700, y: 100, icon: 'info-circle', color: 'blue' },
                    { id: 'contain-demo', type: 'soar', subtype: 'playbook', title: 'ä¸€é”®éåˆ¶', x: 700, y: 180, icon: 'shield-alt', color: 'orange' },
                    { id: 'complete-demo', type: 'soar', subtype: 'ticket', title: 'æ ‡è®°å®Œæˆ', x: 700, y: 260, icon: 'check-circle', color: 'green' },
                    { id: 'investigate-demo', type: 'ai', subtype: 'investigate', title: 'è°ƒæŸ¥åˆ†æ', x: 700, y: 340, icon: 'search', color: 'blue' }
                ],
                connections: [
                    { source: 'trigger-demo', target: 'agent-demo' },
                    { source: 'agent-demo', target: 'detail-demo', sourceAnchor: 'get_details' },
                    { source: 'agent-demo', target: 'contain-demo', sourceAnchor: 'containment_approved' },
                    { source: 'agent-demo', target: 'complete-demo', sourceAnchor: 'marked_as_done' },
                    { source: 'agent-demo', target: 'investigate-demo', sourceAnchor: 're_investigate' }
                ]
            },
            'internet-attack-block': {
                name: 'äº’è”ç½‘æ”»å‡»è‡ªåŠ¨åŒ–é˜»æ–­æµç¨‹',
                description: 'å‘ç”Ÿå¤–åˆ°å†…çœŸå®æ”»å‡»å‘Šè­¦ï¼Œå®ä½“åˆ†æåç¡®è®¤æ˜¯å¦å°å µ',
                nodes: [
                    { id: 'trigger-1', type: 'trigger', subtype: 'alert', title: 'äº’è”ç½‘æ”»å‡»å‘Šè­¦', x: 100, y: 200, icon: 'exclamation-triangle', color: 'red' },
                    { id: 'ai-analysis-1', type: 'ai', subtype: 'investigate', title: 'å¨èƒåˆ†æAgent', x: 400, y: 200, icon: 'search', color: 'blue' },
                    { id: 'condition-1', type: 'logic', subtype: 'condition', title: 'å¨èƒç­‰çº§åˆ¤æ–­', x: 700, y: 200, icon: 'question', color: 'gray' },
                    { id: 'auto-block-1', type: 'soar', subtype: 'playbook', title: 'è‡ªåŠ¨å°å µPlaybook', x: 1000, y: 100, icon: 'shield-alt', color: 'green' },
                    { id: 'human-confirm-1', type: 'human', subtype: 'confirm', title: 'äººå·¥ç¡®è®¤å°å µ', x: 1000, y: 300, icon: 'user-check', color: 'red' },
                    { id: 'report-1', type: 'ai', subtype: 'custom', title: 'AIç”Ÿæˆå¤„ç½®æŠ¥å‘Š', x: 1300, y: 200, icon: 'file-alt', color: 'blue' }
                ],
                connections: [
                    { source: 'trigger-1', target: 'ai-analysis-1' },
                    { source: 'ai-analysis-1', target: 'condition-1' },
                    { source: 'condition-1', target: 'auto-block-1' },
                    { source: 'condition-1', target: 'human-confirm-1' },
                    { source: 'auto-block-1', target: 'report-1' },
                    { source: 'human-confirm-1', target: 'report-1' }
                ]
            },
            'security-incident-response': {
                name: 'é‡å¤§å®‰å…¨äº‹ä»¶åº”æ€¥å“åº”æµç¨‹',
                description: 'è§¦å‘é‡è¦çš„å®‰å…¨äº‹ä»¶åï¼Œè‡ªåŠ¨åŒ–è°ƒæŸ¥ã€åˆ†æã€ç¡®è®¤ä¸å“åº”æµç¨‹',
                nodes: [
                    { id: 'trigger-2', type: 'trigger', subtype: 'alert', title: 'é‡å¤§å®‰å…¨äº‹ä»¶è§¦å‘', x: 100, y: 200, icon: 'fire', color: 'red' },
                    { id: 'agent-notify-2', type: 'agent', subtype: 'contact', title: 'æ™ºèƒ½è”ç»œå‘˜Agent', x: 400, y: 200, icon: 'user-tie', color: 'purple' },
                    { id: 'detail-report-2', type: 'ai', subtype: 'custom', title: 'è¯¦ç»†ä¿¡æ¯æŠ¥å‘Š', x: 700, y: 80, icon: 'file-alt', color: 'blue' },
                    { id: 'investigate-2', type: 'ai', subtype: 'investigate', title: 'è°ƒæŸ¥æº¯æºAgent', x: 700, y: 160, icon: 'search', color: 'blue' },
                    { id: 'disposal-2', type: 'ai', subtype: 'disposal', title: 'å®ä½“å¤„ç½®Agent', x: 700, y: 240, icon: 'shield-alt', color: 'green' },
                    { id: 'mark-done-2', type: 'soar', subtype: 'ticket', title: 'æ ‡è®°äº‹ä»¶å®Œæˆ', x: 700, y: 320, icon: 'check-circle', color: 'green' },
                    { id: 'soar-2', type: 'soar', subtype: 'playbook', title: 'SOARå¤„ç½®å¼•æ“', x: 1000, y: 240, icon: 'cogs', color: 'orange' },
                    { id: 'ticket-2', type: 'soar', subtype: 'ticket', title: 'åˆ›å»ºå¤„ç½®å·¥å•', x: 1000, y: 320, icon: 'ticket-alt', color: 'orange' },
                    { id: 'report-2', type: 'ai', subtype: 'custom', title: 'AIé—­ç¯æŠ¥å‘Š', x: 1300, y: 240, icon: 'file-alt', color: 'blue' }
                ],
                connections: [
                    { source: 'trigger-2', target: 'agent-notify-2' },
                    { source: 'agent-notify-2', target: 'detail-report-2', sourceAnchor: 'get_details' },
                    { source: 'agent-notify-2', target: 'disposal-2', sourceAnchor: 'containment_approved' },
                    { source: 'agent-notify-2', target: 'mark-done-2', sourceAnchor: 'marked_as_done' },
                    { source: 'agent-notify-2', target: 'investigate-2', sourceAnchor: 're_investigate' },
                    { source: 'investigate-2', target: 'disposal-2' },
                    { source: 'disposal-2', target: 'soar-2' },
                    { source: 'disposal-2', target: 'ticket-2' },
                    { source: 'soar-2', target: 'report-2' },
                    { source: 'ticket-2', target: 'report-2' }
                ]
            },
            'phishing-notification': {
                name: 'é’“é±¼äº‹ä»¶é€šçŸ¥ä¸é—­ç¯æµç¨‹',
                description: 'ç”¨æˆ·ç‚¹å‡»é’“é±¼é‚®ä»¶ï¼Œç¡®è®¤ä¸ºçœŸåï¼Œæ¨é€ç»ˆç«¯ç”¨æˆ·æé†’å¹¶è·å¾—å›å¤',
                nodes: [
                    { id: 'trigger-3', type: 'trigger', subtype: 'event', title: 'é’“é±¼äº‹ä»¶è§¦å‘', x: 100, y: 200, icon: 'fish', color: 'yellow' },
                    { id: 'ai-verify-3', type: 'ai', subtype: 'investigate', title: 'AIéªŒè¯é’“é±¼çœŸå®æ€§', x: 400, y: 200, icon: 'search', color: 'blue' },
                    { id: 'condition-3', type: 'logic', subtype: 'condition', title: 'é’“é±¼ç¡®è®¤åˆ¤æ–­', x: 700, y: 200, icon: 'question', color: 'gray' },
                    { id: 'user-notify-3', type: 'agent', subtype: 'contact', title: 'ç”¨æˆ·å®‰å…¨æé†’', x: 1000, y: 200, icon: 'bell', color: 'purple' },
                    { id: 'training-3', type: 'soar', subtype: 'playbook', title: 'å®‰å…¨æ„è¯†åŸ¹è®­', x: 1300, y: 100, icon: 'graduation-cap', color: 'orange' },
                    { id: 'isolation-3', type: 'soar', subtype: 'playbook', title: 'é‚®ç®±éš”ç¦»å¤„ç½®', x: 1300, y: 300, icon: 'lock', color: 'orange' },
                    { id: 'report-3', type: 'ai', subtype: 'custom', title: 'é’“é±¼äº‹ä»¶æŠ¥å‘Š', x: 1600, y: 200, icon: 'file-alt', color: 'blue' }
                ],
                connections: [
                    { source: 'trigger-3', target: 'ai-verify-3' },
                    { source: 'ai-verify-3', target: 'condition-3' },
                    { source: 'condition-3', target: 'user-notify-3' },
                    { source: 'user-notify-3', target: 'training-3' },
                    { source: 'user-notify-3', target: 'isolation-3' },
                    { source: 'training-3', target: 'report-3' },
                    { source: 'isolation-3', target: 'report-3' }
                ]
            },
            'executive-security-incident': {
                name: 'é«˜ç®¡å®‰å…¨äº‹ä»¶ä¸“é¡¹æµç¨‹',
                description: 'é«˜ç®¡ç”¨æˆ·çš„å®‰å…¨äº‹ä»¶ï¼Œæ¨é€ç®¡ç†å‘˜ç¡®è®¤åå†è‡ªåŠ¨åŒ–æ¨é€é€šçŸ¥ç¡®è®¤',
                nodes: [
                    { id: 'trigger-4', type: 'trigger', subtype: 'alert', title: 'é«˜ç®¡å®‰å…¨äº‹ä»¶', x: 100, y: 200, icon: 'crown', color: 'purple' },
                    { id: 'classify-4', type: 'ai', subtype: 'investigate', title: 'AIäº‹ä»¶åˆ†çº§', x: 400, y: 200, icon: 'layer-group', color: 'blue' },
                    { id: 'admin-approval-4', type: 'human', subtype: 'confirm', title: 'ç®¡ç†å‘˜é¢„å®¡æ‰¹', x: 700, y: 200, icon: 'user-shield', color: 'red' },
                    { id: 'executive-notify-4', type: 'agent', subtype: 'contact', title: 'é«˜ç®¡é€šçŸ¥ç¡®è®¤', x: 1000, y: 200, icon: 'user-tie', color: 'purple' },
                    { id: 'escalate-4', type: 'soar', subtype: 'playbook', title: 'äº‹ä»¶å‡çº§æµç¨‹', x: 1300, y: 100, icon: 'arrow-up', color: 'orange' },
                    { id: 'response-4', type: 'soar', subtype: 'playbook', title: 'é«˜ä¼˜å…ˆçº§å“åº”', x: 1300, y: 300, icon: 'fire-alt', color: 'orange' },
                    { id: 'report-4', type: 'ai', subtype: 'custom', title: 'é«˜ç®¡äº‹ä»¶æŠ¥å‘Š', x: 1600, y: 200, icon: 'file-alt', color: 'blue' }
                ],
                connections: [
                    { source: 'trigger-4', target: 'classify-4' },
                    { source: 'classify-4', target: 'admin-approval-4' },
                    { source: 'admin-approval-4', target: 'executive-notify-4' },
                    { source: 'executive-notify-4', target: 'escalate-4' },
                    { source: 'executive-notify-4', target: 'response-4' },
                    { source: 'escalate-4', target: 'report-4' },
                    { source: 'response-4', target: 'report-4' }
                ]
            },
            'core-asset-exposure': {
                name: 'æ ¸å¿ƒèµ„äº§å‘ç°æ–°çš„äº’è”ç½‘æš´éœ²',
                description: 'å¯¹äºè®¾å®šçš„æ ¸å¿ƒèµ„äº§ï¼Œå‘ç°äº†æ–°çš„å…³é”®æš´éœ²é¢',
                nodes: [
                    { id: 'trigger-5', type: 'trigger', subtype: 'event', title: 'æ–°æš´éœ²é¢å‘ç°', x: 100, y: 200, icon: 'globe', color: 'cyan' },
                    { id: 'asset-classify-5', type: 'ai', subtype: 'investigate', title: 'èµ„äº§é‡è¦æ€§åˆ†æ', x: 400, y: 200, icon: 'server', color: 'blue' },
                    { id: 'risk-assess-5', type: 'ai', subtype: 'investigate', title: 'é£é™©è¯„ä¼°Agent', x: 700, y: 200, icon: 'exclamation-triangle', color: 'blue' },
                    { id: 'owner-notify-5', type: 'agent', subtype: 'contact', title: 'èµ„äº§è´Ÿè´£äººé€šçŸ¥', x: 1000, y: 100, icon: 'user', color: 'purple' },
                    { id: 'auto-scan-5', type: 'soar', subtype: 'playbook', title: 'è‡ªåŠ¨å®‰å…¨æ‰«æ', x: 1000, y: 300, icon: 'search', color: 'orange' },
                    { id: 'remediate-5', type: 'soar', subtype: 'playbook', title: 'æš´éœ²é¢æ”¶æ•›', x: 1300, y: 200, icon: 'shield-alt', color: 'orange' },
                    { id: 'report-5', type: 'ai', subtype: 'custom', title: 'æš´éœ²é¢åˆ†ææŠ¥å‘Š', x: 1600, y: 200, icon: 'chart-bar', color: 'blue' }
                ],
                connections: [
                    { source: 'trigger-5', target: 'asset-classify-5' },
                    { source: 'asset-classify-5', target: 'risk-assess-5' },
                    { source: 'risk-assess-5', target: 'owner-notify-5' },
                    { source: 'risk-assess-5', target: 'auto-scan-5' },
                    { source: 'owner-notify-5', target: 'remediate-5' },
                    { source: 'auto-scan-5', target: 'remediate-5' },
                    { source: 'remediate-5', target: 'report-5' }
                ]
            },
            'agent-coverage-monitoring': {
                name: 'Agentè¦†ç›–ç‡ç›‘æ§ä¸è¡¥é½æµç¨‹',
                description: 'æ£€æµ‹åˆ°æ–°çš„æ–°çš„å®‰å…¨äº‹ä»¶ä½†ä¸»æœºæœªå®‰è£…Agent',
                nodes: [
                    { id: 'trigger-6', type: 'trigger', subtype: 'alert', title: 'æ— Agentä¸»æœºå‘Šè­¦', x: 100, y: 200, icon: 'exclamation-triangle', color: 'green' },
                    { id: 'host-identify-6', type: 'ai', subtype: 'investigate', title: 'ä¸»æœºèº«ä»½è¯†åˆ«', x: 400, y: 200, icon: 'desktop', color: 'blue' },
                    { id: 'coverage-check-6', type: 'ai', subtype: 'investigate', title: 'Agentè¦†ç›–ç‡æ£€æŸ¥', x: 700, y: 200, icon: 'chart-line', color: 'blue' },
                    { id: 'admin-notify-6', type: 'agent', subtype: 'contact', title: 'ç®¡ç†å‘˜é€šçŸ¥', x: 1000, y: 100, icon: 'user-cog', color: 'purple' },
                    { id: 'auto-deploy-6', type: 'soar', subtype: 'playbook', title: 'è‡ªåŠ¨éƒ¨ç½²Agent', x: 1000, y: 300, icon: 'download', color: 'orange' },
                    { id: 'verify-6', type: 'ai', subtype: 'investigate', title: 'éƒ¨ç½²ç»“æœéªŒè¯', x: 1300, y: 200, icon: 'check-circle', color: 'blue' },
                    { id: 'report-6', type: 'ai', subtype: 'custom', title: 'è¦†ç›–ç‡æŠ¥å‘Š', x: 1600, y: 200, icon: 'chart-pie', color: 'blue' }
                ],
                connections: [
                    { source: 'trigger-6', target: 'host-identify-6' },
                    { source: 'host-identify-6', target: 'coverage-check-6' },
                    { source: 'coverage-check-6', target: 'admin-notify-6' },
                    { source: 'coverage-check-6', target: 'auto-deploy-6' },
                    { source: 'admin-notify-6', target: 'verify-6' },
                    { source: 'auto-deploy-6', target: 'verify-6' },
                    { source: 'verify-6', target: 'report-6' }
                ]
            },
            'high-risk-vulnerability': {
                name: 'é«˜å¯åˆ©ç”¨æ¼æ´ç¡®è®¤ä¸ä¿®å¤æµç¨‹',
                description: 'æ£€æµ‹åˆ°é«˜å¯åˆ©ç”¨æ¼æ´ï¼Œæ¨é€äººå·¥ç¡®è®¤åè¿›è¡Œæµç¨‹åŒ–ä¿®å¤',
                nodes: [
                    { id: 'trigger-7', type: 'trigger', subtype: 'alert', title: 'é«˜å±æ¼æ´å‘ç°', x: 100, y: 200, icon: 'bug', color: 'red' },
                    { id: 'vuln-analysis-7', type: 'ai', subtype: 'investigate', title: 'æ¼æ´å½±å“åˆ†æ', x: 400, y: 200, icon: 'search', color: 'blue' },
                    { id: 'exploit-check-7', type: 'ai', subtype: 'investigate', title: 'å¯åˆ©ç”¨æ€§è¯„ä¼°', x: 700, y: 200, icon: 'shield-alt', color: 'blue' },
                    { id: 'security-confirm-7', type: 'human', subtype: 'confirm', title: 'å®‰å…¨å›¢é˜Ÿç¡®è®¤', x: 1000, y: 100, icon: 'user-check', color: 'red' },
                    { id: 'emergency-patch-7', type: 'soar', subtype: 'playbook', title: 'ç´§æ€¥ä¿®å¤æµç¨‹', x: 1000, y: 300, icon: 'tools', color: 'orange' },
                    { id: 'ticket-create-7', type: 'soar', subtype: 'ticket', title: 'åˆ›å»ºä¿®å¤å·¥å•', x: 1300, y: 200, icon: 'ticket-alt', color: 'orange' },
                    { id: 'verify-patch-7', type: 'ai', subtype: 'investigate', title: 'ä¿®å¤ç»“æœéªŒè¯', x: 1600, y: 200, icon: 'check-double', color: 'blue' },
                    { id: 'report-7', type: 'ai', subtype: 'custom', title: 'æ¼æ´ä¿®å¤æŠ¥å‘Š', x: 1900, y: 200, icon: 'file-medical', color: 'blue' }
                ],
                connections: [
                    { source: 'trigger-7', target: 'vuln-analysis-7' },
                    { source: 'vuln-analysis-7', target: 'exploit-check-7' },
                    { source: 'exploit-check-7', target: 'security-confirm-7' },
                    { source: 'exploit-check-7', target: 'emergency-patch-7' },
                    { source: 'security-confirm-7', target: 'ticket-create-7' },
                    { source: 'emergency-patch-7', target: 'ticket-create-7' },
                    { source: 'ticket-create-7', target: 'verify-patch-7' },
                    { source: 'verify-patch-7', target: 'report-7' }
                ]
            },
            'vulnerability-lifecycle': {
                name: 'æ¼æ´ç”Ÿå‘½å‘¨æœŸç®¡ç†æµç¨‹',
                description: 'å®Œæ•´çš„æ¼æ´ç®¡ç†æµç¨‹ï¼ŒåŒ…å«è´£ä»»äººæ¨é€ç­‰',
                nodes: [
                    { id: 'trigger-8', type: 'trigger', subtype: 'event', title: 'æ¼æ´æ‰«æå‘ç°', x: 100, y: 200, icon: 'search', color: 'indigo' },
                    { id: 'classify-8', type: 'ai', subtype: 'investigate', title: 'æ¼æ´åˆ†ç±»åˆ†çº§', x: 400, y: 200, icon: 'layer-group', color: 'blue' },
                    { id: 'assign-8', type: 'ai', subtype: 'investigate', title: 'è´£ä»»äººåˆ†é…', x: 700, y: 200, icon: 'user-tag', color: 'blue' },
                    { id: 'owner-notify-8', type: 'agent', subtype: 'contact', title: 'è´£ä»»äººé€šçŸ¥', x: 1000, y: 100, icon: 'bell', color: 'purple' },
                    { id: 'sla-monitor-8', type: 'soar', subtype: 'playbook', title: 'SLAç›‘æ§æé†’', x: 1000, y: 300, icon: 'clock', color: 'orange' },
                    { id: 'patch-track-8', type: 'soar', subtype: 'ticket', title: 'ä¿®å¤è¿›åº¦è·Ÿè¸ª', x: 1300, y: 200, icon: 'tasks', color: 'orange' },
                    { id: 'verify-close-8', type: 'ai', subtype: 'investigate', title: 'ä¿®å¤éªŒè¯é—­ç¯', x: 1600, y: 200, icon: 'check-circle', color: 'blue' },
                    { id: 'report-8', type: 'ai', subtype: 'custom', title: 'æ¼æ´ç®¡ç†æŠ¥å‘Š', x: 1900, y: 200, icon: 'chart-line', color: 'blue' }
                ],
                connections: [
                    { source: 'trigger-8', target: 'classify-8' },
                    { source: 'classify-8', target: 'assign-8' },
                    { source: 'assign-8', target: 'owner-notify-8' },
                    { source: 'assign-8', target: 'sla-monitor-8' },
                    { source: 'owner-notify-8', target: 'patch-track-8' },
                    { source: 'sla-monitor-8', target: 'patch-track-8' },
                    { source: 'patch-track-8', target: 'verify-close-8' },
                    { source: 'verify-close-8', target: 'report-8' }
                ]
            },
            'internet-exposure-closure': {
                name: 'äº’è”ç½‘æš´éœ²èµ„äº§ç«¯å£é—­ç¯æµç¨‹',
                description: 'æ–°å¢äº’è”ç½‘æš´éœ²ç«¯å£æˆ–æœåŠ¡',
                nodes: [
                    { id: 'trigger-9', type: 'trigger', subtype: 'event', title: 'æ–°æš´éœ²ç«¯å£å‘ç°', x: 100, y: 200, icon: 'globe', color: 'teal' },
                    { id: 'port-analyze-9', type: 'ai', subtype: 'investigate', title: 'ç«¯å£æœåŠ¡åˆ†æ', x: 400, y: 200, icon: 'network-wired', color: 'blue' },
                    { id: 'business-check-9', type: 'ai', subtype: 'investigate', title: 'ä¸šåŠ¡åˆç†æ€§æ£€æŸ¥', x: 700, y: 200, icon: 'balance-scale', color: 'blue' },
                    { id: 'owner-confirm-9', type: 'human', subtype: 'confirm', title: 'è´Ÿè´£äººç¡®è®¤', x: 1000, y: 100, icon: 'user-check', color: 'red' },
                    { id: 'auto-close-9', type: 'soar', subtype: 'playbook', title: 'è‡ªåŠ¨ç«¯å£å…³é—­', x: 1000, y: 300, icon: 'lock', color: 'orange' },
                    { id: 'verify-9', type: 'ai', subtype: 'investigate', title: 'å…³é—­ç»“æœéªŒè¯', x: 1300, y: 200, icon: 'check-circle', color: 'blue' },
                    { id: 'report-9', type: 'ai', subtype: 'custom', title: 'æš´éœ²é¢æ”¶æ•›æŠ¥å‘Š', x: 1600, y: 200, icon: 'file-alt', color: 'blue' }
                ],
                connections: [
                    { source: 'trigger-9', target: 'port-analyze-9' },
                    { source: 'port-analyze-9', target: 'business-check-9' },
                    { source: 'business-check-9', target: 'owner-confirm-9' },
                    { source: 'business-check-9', target: 'auto-close-9' },
                    { source: 'owner-confirm-9', target: 'verify-9' },
                    { source: 'auto-close-9', target: 'verify-9' },
                    { source: 'verify-9', target: 'report-9' }
                ]
            },
            'weak-password-response': {
                name: 'å¼±å£ä»¤é£é™©è‡ªåŠ¨å“åº”æµç¨‹',
                description: 'æ¢æµ‹åˆ°é‡è¦å¼±å£ä»¤å¹¶ç”Ÿæˆå®‰å…¨äº‹ä»¶',
                nodes: [
                    { id: 'trigger-10', type: 'trigger', subtype: 'alert', title: 'å¼±å£ä»¤å‘ç°', x: 100, y: 200, icon: 'key', color: 'amber' },
                    { id: 'account-analyze-10', type: 'ai', subtype: 'investigate', title: 'è´¦æˆ·é‡è¦æ€§åˆ†æ', x: 400, y: 200, icon: 'user-shield', color: 'blue' },
                    { id: 'risk-level-10', type: 'ai', subtype: 'investigate', title: 'é£é™©ç­‰çº§è¯„ä¼°', x: 700, y: 200, icon: 'exclamation-triangle', color: 'blue' },
                    { id: 'user-notify-10', type: 'agent', subtype: 'contact', title: 'ç”¨æˆ·å¼ºåˆ¶ä¿®æ”¹é€šçŸ¥', x: 1000, y: 100, icon: 'bell', color: 'purple' },
                    { id: 'auto-disable-10', type: 'soar', subtype: 'playbook', title: 'é«˜å±è´¦æˆ·è‡ªåŠ¨ç¦ç”¨', x: 1000, y: 300, icon: 'ban', color: 'orange' },
                    { id: 'password-policy-10', type: 'soar', subtype: 'playbook', title: 'å¯†ç ç­–ç•¥å¼ºåŒ–', x: 1300, y: 200, icon: 'shield-alt', color: 'orange' },
                    { id: 'compliance-10', type: 'ai', subtype: 'custom', title: 'åˆè§„æ€§æ£€æŸ¥æŠ¥å‘Š', x: 1600, y: 200, icon: 'clipboard-check', color: 'blue' }
                ],
                connections: [
                    { source: 'trigger-10', target: 'account-analyze-10' },
                    { source: 'account-analyze-10', target: 'risk-level-10' },
                    { source: 'risk-level-10', target: 'user-notify-10' },
                    { source: 'risk-level-10', target: 'auto-disable-10' },
                    { source: 'user-notify-10', target: 'password-policy-10' },
                    { source: 'auto-disable-10', target: 'password-policy-10' },
                    { source: 'password-policy-10', target: 'compliance-10' }
                ]
            }
        };

        // æ¨¡æ¿å•†åº—ç›¸å…³å‡½æ•°å·²ç§»é™¤ï¼Œç°åœ¨ä½¿ç”¨é¡µé¢åˆ‡æ¢æ–¹å¼

        // åŠ è½½æ¨¡æ¿
        function loadTemplate(templateId) {
            const template = workflowTemplates[templateId];
            if (!template) {
                alert('æ¨¡æ¿ä¸å­˜åœ¨ï¼');
                return;
            }

            console.log(`å¼€å§‹åŠ è½½æ¨¡æ¿: ${template.name}`);
            
            // æ¸…ç©ºç°æœ‰å·¥ä½œæµ
            clearWorkflow();
            
            // åˆ›å»ºæ–°èŠ‚ç‚¹
            template.nodes.forEach(nodeData => {
                createTemplateNode(nodeData);
            });

            // ç­‰å¾…èŠ‚ç‚¹åˆ›å»ºå®Œæˆåå†åˆ›å»ºè¿æ¥
            setTimeout(() => {
                console.log('å¼€å§‹åˆ›å»ºè¿æ¥...');
                template.connections.forEach((conn, index) => {
                    if (conn.sourceAnchor) {
                        console.log(`åˆ›å»ºè¿æ¥ ${index + 1}: ${conn.source} -> ${conn.target} (é”šç‚¹: ${conn.sourceAnchor})`);
                        connectNodes(conn.source, conn.target, conn.sourceAnchor);
                    } else {
                    console.log(`åˆ›å»ºè¿æ¥ ${index + 1}: ${conn.source} -> ${conn.target}`);
                    connectNodes(conn.source, conn.target);
                    }
                });
                
                // æ›´æ–°è®¡æ•°
                updateNodeCount();
                updateConnectionCount();
                
                // è‡ªåŠ¨é€‚åº”å±å¹•åˆ°æ‰€æœ‰èŠ‚ç‚¹
                setTimeout(() => {
                    console.log('è‡ªåŠ¨é€‚åº”å±å¹•...');
                    fitToScreen();
                }, 300);
            }, 800);
        }

        // æ¸…ç©ºå·¥ä½œæµ
        function clearWorkflow() {
            // æ¸…é™¤æ‰€æœ‰è¿æ¥
            jsPlumbInstance.deleteEveryConnection();
            
            // æ¸…é™¤æ‰€æœ‰èŠ‚ç‚¹
            const nodes = document.querySelectorAll('.workflow-node');
            nodes.forEach(node => {
                jsPlumbInstance.remove(node);
            });
            
            // æ¸…é™¤é€‰ä¸­çŠ¶æ€
            selectedNode = null;
            document.getElementById('propertiesPanel').classList.add('hidden');
        }

        // åˆ›å»ºæ¨¡æ¿èŠ‚ç‚¹
        function createTemplateNode(nodeData) {
            console.log(`åˆ›å»ºæ¨¡æ¿èŠ‚ç‚¹: ${nodeData.id} - ${nodeData.title}`);
            
            const nodeId = nodeData.id;
            const nodeClass = `node-${nodeData.type}`;
            const iconClass = `fas fa-${nodeData.icon}`;
            const colorClass = getColorClass(nodeData.color);

            const nodeHtml = `
                <div id="${nodeId}" class="workflow-node draggable-node ${nodeClass} bg-white rounded-lg shadow-md p-4 absolute" 
                     style="left: ${nodeData.x}px; top: ${nodeData.y}px; width: 200px;">
                    <div class="flex items-center mb-2">
                        <i class="${iconClass} ${colorClass} mr-2"></i>
                        <span class="font-semibold text-sm">${nodeData.title}</span>
                    </div>
                    <div class="text-xs text-gray-500">${getNodeTypeLabel(nodeData.type, nodeData.subtype)}</div>
                </div>
            `;

            const container = document.getElementById('workflow-container');
            if (!container) {
                console.error('æ‰¾ä¸åˆ°å·¥ä½œæµå®¹å™¨å…ƒç´ ');
                return;
            }
            
            container.insertAdjacentHTML('beforeend', nodeHtml);
            
            const node = document.getElementById(nodeId);
            if (!node) {
                console.error(`åˆ›å»ºçš„èŠ‚ç‚¹ ${nodeId} æœªæ‰¾åˆ°`);
                return;
            }
            
            console.log(`èŠ‚ç‚¹ ${nodeId} åˆ›å»ºæˆåŠŸ`);
            
            // ç¡®ä¿jsPlumbå®ä¾‹å­˜åœ¨
            if (!jsPlumbInstance) {
                console.error('jsPlumbå®ä¾‹ä¸å­˜åœ¨ï¼Œå°è¯•é‡æ–°åˆå§‹åŒ–');
                initJsPlumb();
            }
            
            // ä½¿èŠ‚ç‚¹å¯æ‹–æ‹½
            if (jsPlumbInstance) {
                jsPlumbInstance.draggable(node);
                console.log(`èŠ‚ç‚¹ ${nodeId} è®¾ç½®ä¸ºå¯æ‹–æ‹½`);
                
                // æ·»åŠ è¿æ¥ç‚¹
                setTimeout(() => {
                    addEndpoints(node);
                    console.log(`èŠ‚ç‚¹ ${nodeId} è¿æ¥ç‚¹æ·»åŠ å®Œæˆ`);
                }, 50);
            } else {
                console.error(`æ— æ³•è®¾ç½®èŠ‚ç‚¹ ${nodeId} ä¸ºå¯æ‹–æ‹½ï¼šjsPlumbå®ä¾‹ä¸å­˜åœ¨`);
            }
            
            // æ·»åŠ äº‹ä»¶ç›‘å¬å™¨
            setupNodeEvents(node);
        }

        // è·å–é¢œè‰²ç±»
        function getColorClass(color) {
            const colorMap = {
                'red': 'text-red-500',
                'blue': 'text-blue-500',
                'green': 'text-green-500',
                'yellow': 'text-yellow-500',
                'purple': 'text-purple-500',
                'orange': 'text-orange-500',
                'gray': 'text-gray-500',
                'cyan': 'text-cyan-500',
                'indigo': 'text-indigo-500',
                'teal': 'text-teal-500',
                'amber': 'text-amber-500'
            };
            return colorMap[color] || 'text-gray-500';
        }

        // è·å–èŠ‚ç‚¹ç±»å‹æ ‡ç­¾
        function getNodeTypeLabel(type, subtype) {
            const labels = {
                'trigger': { 'alert': 'å‘Šè­¦è§¦å‘å™¨', 'event': 'äº‹ä»¶è§¦å‘å™¨', 'webhook': 'Webhookè§¦å‘å™¨' },
                'ai': { 'investigate': 'è°ƒæŸ¥åˆ†æ', 'disposal': 'å¤„ç½®å†³ç­–', 'custom': 'è‡ªå®šä¹‰AI' },
                'agent': { 'contact': 'è”ç»œé€šçŸ¥' },
                'soar': { 'playbook': 'SOARå‰§æœ¬', 'ticket': 'å·¥å•ç³»ç»Ÿ' },
                'human': { 'confirm': 'äººå·¥ç¡®è®¤' },
                'logic': { 'condition': 'æ¡ä»¶åˆ¤æ–­' }
            };
            return labels[type]?.[subtype] || `${type}-${subtype}`;
        }

        // è¿æ¥ä¸¤ä¸ªèŠ‚ç‚¹ï¼ˆæ”¯æŒç‰¹å®šé”šç‚¹è¿æ¥ï¼‰
        function connectNodes(sourceId, targetId, sourceAnchor = null) {
            const sourceNode = document.getElementById(sourceId);
            const targetNode = document.getElementById(targetId);
            
            console.log(`å°è¯•è¿æ¥èŠ‚ç‚¹: ${sourceId} -> ${targetId}`, sourceAnchor ? `(é”šç‚¹: ${sourceAnchor})` : '');
            console.log('æºèŠ‚ç‚¹å­˜åœ¨:', !!sourceNode);
            console.log('ç›®æ ‡èŠ‚ç‚¹å­˜åœ¨:', !!targetNode);
            console.log('jsPlumbå®ä¾‹å­˜åœ¨:', !!jsPlumbInstance);
            
            if (sourceNode && targetNode && jsPlumbInstance) {
                try {
                    let connectionConfig;
                    
                    // å¦‚æœæŒ‡å®šäº†æºé”šç‚¹ï¼Œä½¿ç”¨ç‰¹å®šé”šç‚¹è¿æ¥
                    if (sourceAnchor && sourceNode.classList.contains('node-agent')) {
                        connectionConfig = {
                            source: sourceId,
                            target: targetId,
                            sourceEndpoint: sourceId + "-" + sourceAnchor,
                            targetEndpoint: targetId + "-target",
                            endpoint: "Dot",
                            paintStyle: { stroke: "#8b5cf6", strokeWidth: 2 },
                            hoverPaintStyle: { stroke: "#7c3aed", strokeWidth: 3 },
                            connector: ["Bezier", { curviness: 80 }],
                            overlays: [
                                ["Arrow", { location: 1, width: 20, length: 20 }],
                                ["Label", {
                                    label: getAnchorLabel(sourceAnchor),
                                    location: 0.7,
                                    cssClass: "connection-label text-xs bg-purple-100 text-purple-800 px-2 py-1 rounded shadow-sm",
                                    id: "label-" + sourceAnchor
                                }]
                            ]
                        };
                    } else {
                        // æ ‡å‡†è¿æ¥
                        connectionConfig = {
                        source: sourceId,
                        target: targetId,
                        anchor: ["Right", "Left"],
                        endpoint: "Dot",
                        paintStyle: { stroke: "#64748b", strokeWidth: 2 },
                        hoverPaintStyle: { stroke: "#1e40af", strokeWidth: 3 },
                            connector: ["Bezier", { curviness: 80 }],
                        overlays: [["Arrow", { location: 1, width: 20, length: 20 }]]
                        };
                    }
                    
                    const connection = jsPlumbInstance.connect(connectionConfig);
                    
                    if (connection) {
                        console.log(`æˆåŠŸåˆ›å»ºè¿æ¥: ${sourceId} -> ${targetId}`, sourceAnchor ? `(é”šç‚¹: ${sourceAnchor})` : '');
                    } else {
                        console.error(`è¿æ¥åˆ›å»ºå¤±è´¥: ${sourceId} -> ${targetId}`);
                    }
                } catch (error) {
                    console.error(`è¿æ¥åˆ›å»ºå¼‚å¸¸: ${sourceId} -> ${targetId}`, error);
                }
            } else {
                console.error(`è¿æ¥åˆ›å»ºæ¡ä»¶ä¸æ»¡è¶³: æºèŠ‚ç‚¹=${!!sourceNode}, ç›®æ ‡èŠ‚ç‚¹=${!!targetNode}, jsPlumb=${!!jsPlumbInstance}`);
            }
        }
        
        // è·å–é”šç‚¹æ ‡ç­¾
        function getAnchorLabel(anchorName) {
            const labels = {
                'get_details': 'è¯¦æƒ…',
                'containment_approved': 'éåˆ¶',
                'marked_as_done': 'å®Œæˆ',
                're_investigate': 'è°ƒæŸ¥'
            };
            return labels[anchorName] || anchorName;
        }

        // ============= ç¼ºå¤±å‡½æ•°è¡¥å…… =============
        
        // ä¸ºèŠ‚ç‚¹æ·»åŠ è¿æ¥ç‚¹
        function addEndpoints(node) {
            if (!jsPlumbInstance || !node) return;
            
            // æ·»åŠ è¾“å‡ºç«¯ç‚¹ï¼ˆå³ä¾§ï¼Œç»¿è‰²ï¼‰
            jsPlumbInstance.addEndpoint(node, {
                endpoint: "Dot",
                anchor: "Right",
                isSource: true,
                paintStyle: { fill: "#10b981", stroke: "#059669", strokeWidth: 2, radius: 6 },
                hoverPaintStyle: { fill: "#059669", stroke: "#047857", strokeWidth: 3, radius: 8 },
                connectorStyle: { stroke: "#64748b", strokeWidth: 2 },
                connectorHoverStyle: { stroke: "#1e40af", strokeWidth: 3 },
                connector: ["Bezier", { curviness: 80 }],
                overlays: [["Arrow", { location: 1, width: 20, length: 20 }]]
            });
            
            // æ·»åŠ è¾“å…¥ç«¯ç‚¹ï¼ˆå·¦ä¾§ï¼Œçº¢è‰²ï¼‰
            jsPlumbInstance.addEndpoint(node, {
                endpoint: "Dot",
                anchor: "Left",
                isTarget: true,
                paintStyle: { fill: "#ef4444", stroke: "#dc2626", strokeWidth: 2, radius: 6 },
                hoverPaintStyle: { fill: "#dc2626", stroke: "#b91c1c", strokeWidth: 3, radius: 8 }
            });
        }

        // ä¸ºèŠ‚ç‚¹è®¾ç½®äº‹ä»¶ç›‘å¬å™¨
        function setupNodeEvents(node) {
            if (!node) return;
            
            // ç‚¹å‡»é€‰ä¸­èŠ‚ç‚¹
            node.addEventListener('click', function(e) {
                if (isDragging || isConnecting) return;
                
                e.stopPropagation();
                
                // æ¸…é™¤ä¹‹å‰é€‰ä¸­çš„èŠ‚ç‚¹
                document.querySelectorAll('.workflow-node').forEach(n => {
                    n.classList.remove('ring-2', 'ring-blue-500');
                });
                
                // é€‰ä¸­å½“å‰èŠ‚ç‚¹
                this.classList.add('ring-2', 'ring-blue-500');
                selectedNode = this;
                
                // æ˜¾ç¤ºå±æ€§é¢æ¿
                showNodeProperties(this);
            });
            
            // å³é”®èœå•
            node.addEventListener('contextmenu', function(e) {
                e.preventDefault();
                e.stopPropagation();
                
                selectedNode = this;
                showContextMenu(e.pageX, e.pageY, this);
            });
            
            // åŒå‡»ç¼–è¾‘
            node.addEventListener('dblclick', function(e) {
                e.stopPropagation();
                showNodeProperties(this);
            });
        }

        // ç”»å¸ƒç¼©æ”¾åŠŸèƒ½
        function zoomIn() {
            if (canvasState.scale < canvasState.maxScale) {
                canvasState.scale += 0.1;
                updateCanvasTransform();
                updateCoordinatesDisplay();
            }
        }

        function zoomOut() {
            if (canvasState.scale > canvasState.minScale) {
                canvasState.scale -= 0.1;
                updateCanvasTransform();
                updateCoordinatesDisplay();
            }
        }

        // æ›´æ–°ç”»å¸ƒå˜æ¢
        function updateCanvasTransform() {
            if (!workflowContainer) return;
            
            workflowContainer.style.transform = `translate(${canvasState.x}px, ${canvasState.y}px) scale(${canvasState.scale})`;
            updateCoordinatesDisplay();
            updateMinimapViewport();
        }

        // æ›´æ–°åæ ‡æ˜¾ç¤º
        function updateCoordinatesDisplay() {
            const coordX = document.getElementById('coordX');
            const coordY = document.getElementById('coordY');
            const coordScale = document.getElementById('coordScale');
            
            if (coordX) coordX.textContent = Math.round(canvasState.x);
            if (coordY) coordY.textContent = Math.round(canvasState.y);
            if (coordScale) coordScale.textContent = Math.round(canvasState.scale * 100) + '%';
        }

        // æ›´æ–°å°åœ°å›¾è§†å£
        function updateMinimapViewport() {
            const viewport = document.getElementById('minimapViewport');
            if (!viewport) return;
            
            // ç®€å•çš„å°åœ°å›¾è§†å£æ›´æ–°
            const viewportWidth = 200 * canvasState.scale;
            const viewportHeight = 150 * canvasState.scale;
            
            viewport.style.width = Math.max(20, viewportWidth) + 'px';
            viewport.style.height = Math.max(15, viewportHeight) + 'px';
            viewport.style.left = Math.max(0, -canvasState.x / 50) + 'px';
            viewport.style.top = Math.max(0, -canvasState.y / 50) + 'px';
        }

        // æ›´æ–°å°åœ°å›¾èŠ‚ç‚¹
        function updateMinimapNodes() {
            // ç®€å•å®ç°ï¼Œå¯ä»¥åç»­æ‰©å±•
            console.log('å°åœ°å›¾èŠ‚ç‚¹å·²æ›´æ–°');
        }

        // æ›´æ–°èŠ‚ç‚¹è®¡æ•°
        function updateNodeCount() {
            const nodeCountElement = document.getElementById('nodeCount');
            if (nodeCountElement) {
                const nodeCount = document.querySelectorAll('.workflow-node').length;
                nodeCountElement.textContent = nodeCount;
            }
        }

        // æ›´æ–°è¿æ¥è®¡æ•°
        function updateConnectionCount() {
            const connectionCountElement = document.getElementById('connectionCount');
            if (connectionCountElement && jsPlumbInstance) {
                try {
                    const connectionCount = jsPlumbInstance.getConnections().length;
                    connectionCountElement.textContent = connectionCount;
                } catch (error) {
                    console.log('è¿æ¥è®¡æ•°è·å–å¤±è´¥ï¼Œä½¿ç”¨é»˜è®¤å€¼0');
                    connectionCountElement.textContent = '0';
                }
            }
        }

        // æ˜¾ç¤ºå³é”®èœå•
        function showContextMenu(x, y, node) {
            const contextMenu = document.getElementById('contextMenu');
            if (contextMenu) {
                contextMenu.style.left = x + 'px';
                contextMenu.style.top = y + 'px';
                contextMenu.classList.remove('hidden');
                selectedNode = node;
            }
        }

        // éšè—å³é”®èœå•
        function hideContextMenu() {
            const contextMenu = document.getElementById('contextMenu');
            if (contextMenu) {
                contextMenu.classList.add('hidden');
            }
        }

        // å¤„ç†å³é”®èœå•æ“ä½œ
        function handleContextMenuAction(action, node) {
            console.log('å¤„ç†å³é”®èœå•æ“ä½œ:', action, node);
            switch (action) {
                case 'edit':
                    showNodeProperties(node);
                    break;
                case 'copy':
                    duplicateNode(node);
                    break;
                case 'disconnect':
                    disconnectNode(node);
                    break;
                case 'delete':
                    deleteNode(node);
                    break;
                default:
                    console.log('æœªçŸ¥çš„å³é”®èœå•æ“ä½œ:', action);
            }
        }

        // å¤åˆ¶èŠ‚ç‚¹
        function duplicateNode(node) {
            if (!node || !jsPlumbInstance) return;
            
            const rect = node.getBoundingClientRect();
            const containerRect = workflowContainer.getBoundingClientRect();
            
            // è®¡ç®—åœ¨ç”»å¸ƒä¸­çš„ç›¸å¯¹ä½ç½®
            const x = (rect.left - containerRect.left) / canvasState.scale - canvasState.x / canvasState.scale + 50;
            const y = (rect.top - containerRect.top) / canvasState.scale - canvasState.y / canvasState.scale + 50;
            
            // è·å–åŸèŠ‚ç‚¹çš„ä¿¡æ¯
            const nodeType = getNodeType(node);
            const nodeSubtype = getNodeSubtype(node);
            
            // åˆ›å»ºèŠ‚ç‚¹æ•°æ®
            const data = {
                type: nodeType,
                subtype: nodeSubtype
            };
            
            // åˆ›å»ºæ–°èŠ‚ç‚¹
            createNode(data, x, y);
            
            console.log('èŠ‚ç‚¹å¤åˆ¶æˆåŠŸ:', nodeType, nodeSubtype);
        }

        // åˆ é™¤èŠ‚ç‚¹
        function deleteNode(node) {
            if (!node || !jsPlumbInstance) return;
            
            const nodeTitle = node.querySelector('.font-semibold').textContent;
            
            if (confirm(`ç¡®å®šè¦åˆ é™¤èŠ‚ç‚¹"${nodeTitle}"å—ï¼Ÿ`)) {
                // åˆ é™¤æ‰€æœ‰è¿æ¥
                jsPlumbInstance.deleteConnectionsForElement(node);
                
                // åˆ é™¤èŠ‚ç‚¹
                node.remove();
                
                // æ›´æ–°è®¡æ•°
                updateNodeCount();
                updateConnectionCount();
                
                // æ¸…é™¤é€‰æ‹©
                if (selectedNode === node) {
                    selectedNode = null;
                    document.getElementById('propertiesPanel').classList.add('hidden');
                }
                
                console.log('èŠ‚ç‚¹åˆ é™¤æˆåŠŸ:', nodeTitle);
            }
        }

        // ============= é¡µé¢åˆ‡æ¢åŠŸèƒ½ =============
        
        // æ˜¾ç¤ºæ¨¡æ¿å•†åº—é¡µé¢
        function showTemplatePage() {
            document.getElementById('templateStorePage').classList.remove('hidden');
            document.getElementById('workflowEditorPage').classList.add('hidden');
            document.body.className = 'bg-gray-50';
            console.log('å·²åˆ‡æ¢åˆ°æ¨¡æ¿å•†åº—é¡µé¢');
        }

        // æ˜¾ç¤ºå·¥ä½œæµç¼–è¾‘å™¨é¡µé¢
        function showEditorPage() {
            document.getElementById('templateStorePage').classList.add('hidden');
            document.getElementById('workflowEditorPage').classList.remove('hidden');
            document.body.className = 'bg-gray-50 h-screen overflow-hidden';
            console.log('å·²åˆ‡æ¢åˆ°å·¥ä½œæµç¼–è¾‘å™¨é¡µé¢');
            
            // ç¡®ä¿jsPlumbå’Œç”»å¸ƒå·²åˆå§‹åŒ–
            setTimeout(() => {
                if (!jsPlumbInstance) {
                    console.log('é‡æ–°åˆå§‹åŒ–jsPlumb...');
                    initJsPlumb();
                }
                
                // é‡æ–°ç»‘å®šç”»å¸ƒäº‹ä»¶
                if (typeof initInfiniteCanvas === 'function') {
                    console.log('é‡æ–°åˆå§‹åŒ–ç”»å¸ƒ...');
                    initInfiniteCanvas();
                }
                
                // å¦‚æœæœ‰èŠ‚ç‚¹ï¼Œè‡ªåŠ¨é€‚åº”å±å¹•
                const nodes = document.querySelectorAll('.workflow-node');
                if (nodes.length > 0) {
                    setTimeout(() => {
                        fitToScreen();
                        console.log('ç¼–è¾‘å™¨é¡µé¢è‡ªåŠ¨é€‚åº”åˆ°ç°æœ‰èŠ‚ç‚¹');
                    }, 200);
                }
            }, 100);
        }

        // æ›´æ–°å¯¼èˆªçŠ¶æ€
        function updateNavigation(activeBtn) {
            // æ¸…é™¤æ‰€æœ‰æŒ‰é’®çš„æ¿€æ´»çŠ¶æ€
            document.querySelectorAll('#homeBtn, #editorBtn, #monitorBtn').forEach(btn => {
                if (btn) {
                    btn.className = 'px-3 py-2 text-sm font-medium text-gray-600 hover:text-gray-900 hover:bg-gray-100 rounded-lg transition-colors';
                }
            });
            
            // æ¿€æ´»å½“å‰æŒ‰é’®
            if (activeBtn) {
                activeBtn.className = 'px-3 py-2 text-sm font-medium text-purple-600 bg-purple-50 rounded-lg';
            }
        }

        // ============= é¡µé¢åˆå§‹åŒ– =============
        document.addEventListener('DOMContentLoaded', function() {
            console.log('é¡µé¢å¼€å§‹åˆå§‹åŒ–...');
            
            // é»˜è®¤æ˜¾ç¤ºæ¨¡æ¿å•†åº—é¡µé¢
            showTemplatePage();
            
            // æ¨¡æ¿å•†åº—ç°åœ¨ä½œä¸ºç‹¬ç«‹é¡µé¢å­˜åœ¨
            
            // åˆå§‹åŒ–jsPlumb
            try {
                initJsPlumb();
                console.log('jsPlumbåˆå§‹åŒ–æˆåŠŸ');
            } catch (error) {
                console.error('jsPlumbåˆå§‹åŒ–å¤±è´¥:', error);
            }
            
            // åˆå§‹åŒ–æ— é™ç”»æ¿
            try {
                initInfiniteCanvas();
                console.log('æ— é™ç”»æ¿åˆå§‹åŒ–æˆåŠŸ');
            } catch (error) {
                console.error('æ— é™ç”»æ¿åˆå§‹åŒ–å¤±è´¥:', error);
            }
            
            // å¦‚æœå½“å‰åœ¨ç¼–è¾‘å™¨é¡µé¢ï¼Œåˆ™è‡ªåŠ¨é€‚åº”å±å¹•
            const editorPage = document.getElementById('editor-page');
            if (editorPage && !editorPage.classList.contains('hidden')) {
                setTimeout(() => {
                    try {
                        fitToScreen();
                        console.log('ç¼–è¾‘å™¨é¡µé¢è‡ªåŠ¨é€‚åº”å±å¹•å®Œæˆ');
                    } catch (error) {
                        console.error('è‡ªåŠ¨é€‚åº”å±å¹•å¤±è´¥:', error);
                    }
                }, 500);
            }

            // ç»‘å®šå¯¼èˆªæŒ‰é’®äº‹ä»¶
            const homeBtn = document.getElementById('homeBtn');
            const editorBtn = document.getElementById('editorBtn');
            const backToStoreBtn = document.getElementById('backToStoreBtn');
            
            if (homeBtn) {
                homeBtn.addEventListener('click', function(e) {
                    e.preventDefault();
                    showTemplatePage();
                    updateNavigation(this);
                });
                console.log('å·¥ä½œæµå•†åº—æŒ‰é’®äº‹ä»¶ç»‘å®šæˆåŠŸ');
            }
            
            if (editorBtn) {
                editorBtn.addEventListener('click', function(e) {
                    e.preventDefault();
                    showEditorPage();
                    updateNavigation(this);
                });
                console.log('æµç¨‹ç¼–è¾‘å™¨æŒ‰é’®äº‹ä»¶ç»‘å®šæˆåŠŸ');
            }
            
            if (backToStoreBtn) {
                backToStoreBtn.addEventListener('click', function(e) {
                    e.preventDefault();
                    showTemplatePage();
                    updateNavigation(document.getElementById('homeBtn'));
                });
                console.log('è¿”å›æŒ‰é’®äº‹ä»¶ç»‘å®šæˆåŠŸ');
            }
            // ç»‘å®šæ¨¡æ¿å¡ç‰‡ç‚¹å‡»äº‹ä»¶
            document.querySelectorAll('.template-card').forEach(card => {
                card.addEventListener('click', function() {
                    const templateId = this.getAttribute('data-template');
                    console.log('é€‰æ‹©æ¨¡æ¿:', templateId);
                    
                    // åˆ‡æ¢åˆ°ç¼–è¾‘å™¨é¡µé¢
                    showEditorPage();
                    updateNavigation(document.getElementById('editorBtn'));
                    
                    // å»¶è¿ŸåŠ è½½æ¨¡æ¿ï¼Œç¡®ä¿é¡µé¢åˆ‡æ¢å®Œæˆ
                    setTimeout(() => {
                        if (typeof loadTemplate === 'function') {
                            loadTemplate(templateId);
                        } else {
                            console.log('æ¨¡æ¿åŠ è½½åŠŸèƒ½æš‚æœªå®ç°ï¼Œå·²åˆ‡æ¢åˆ°ç¼–è¾‘å™¨é¡µé¢');
                        }
                    }, 300);
                });
            });
            console.log('æ¨¡æ¿å¡ç‰‡ç‚¹å‡»äº‹ä»¶ç»‘å®šæˆåŠŸ');
            
            // å…¶ä»–æŒ‰é’®äº‹ä»¶ç»‘å®š
            const saveBtn = document.getElementById('saveBtn');
            if (saveBtn) {
                saveBtn.addEventListener('click', function() {
                    console.log('ä¿å­˜æŒ‰é’®è¢«ç‚¹å‡»');
                    if (typeof saveWorkflow === 'function') {
                        saveWorkflow();
                    } else {
                        console.log('ä¿å­˜åŠŸèƒ½æš‚æœªå®ç°');
                    }
                });
            }
            
            const debugBtn = document.getElementById('debugBtn');
            if (debugBtn) {
                debugBtn.addEventListener('click', () => {
                    const debugModal = document.getElementById('debugModal');
                    if (debugModal) {
                        debugModal.classList.remove('hidden');
                    }
                });
            }
            
            const publishBtn = document.getElementById('publishBtn');
            if (publishBtn) {
                publishBtn.addEventListener('click', function() {
                    console.log('å‘å¸ƒæŒ‰é’®è¢«ç‚¹å‡»');
                    if (typeof publishWorkflow === 'function') {
                        publishWorkflow();
                    } else {
                        console.log('å‘å¸ƒåŠŸèƒ½æš‚æœªå®ç°');
                    }
                });
            }
            
            const closeDebug = document.getElementById('closeDebug');
            if (closeDebug) {
                closeDebug.addEventListener('click', () => {
                    const debugModal = document.getElementById('debugModal');
                    if (debugModal) {
                        debugModal.classList.add('hidden');
                    }
                });
            }
            
            const startDebug = document.getElementById('startDebug');
            if (startDebug) {
                startDebug.addEventListener('click', function() {
                    console.log('å¼€å§‹è°ƒè¯•æŒ‰é’®è¢«ç‚¹å‡»');
                    if (typeof startDebugMode === 'function') {
                        startDebugMode();
                    } else {
                        console.log('è°ƒè¯•åŠŸèƒ½æš‚æœªå®ç°');
                    }
                });
            }
            
            // åŸæœ‰çš„æ¨¡æ¿å¡ç‰‡ç‚¹å‡»äº‹ä»¶å·²åœ¨ä¸Šé¢ç»Ÿä¸€å¤„ç†
            
            // æ‹–æ‹½åŠŸèƒ½åˆå§‹åŒ–
            setupDragAndDrop();

            // ä¾§è¾¹æ åˆ‡æ¢
            document.getElementById('toggleSidebar').addEventListener('click', function() {
                const sidebar = document.getElementById('sidebar');
                const icon = this.querySelector('i');
                
                if (sidebar.classList.contains('sidebar-expanded')) {
                    sidebar.classList.remove('sidebar-expanded');
                    sidebar.classList.add('sidebar-collapsed');
                    icon.className = 'fas fa-chevron-right';
                } else {
                    sidebar.classList.remove('sidebar-collapsed');
                    sidebar.classList.add('sidebar-expanded');
                    icon.className = 'fas fa-chevron-left';
                }
            });

            // èŠ‚ç‚¹ç‚¹å‡»äº‹ä»¶ï¼ˆä½¿ç”¨äº‹ä»¶å§”æ‰˜å’Œé˜²æŠ–ï¼‰
            document.addEventListener('click', function(e) {
                // å¦‚æœæ­£åœ¨æ‹–æ‹½ç”»æ¿ï¼Œä¸å¤„ç†ç‚¹å‡»äº‹ä»¶
                if (canvasState && canvasState.isPanning) {
                    return;
                }
                
                // æ¸…é™¤ä¹‹å‰çš„å®šæ—¶å™¨
                if (clickTimer) {
                    clearTimeout(clickTimer);
                }
                
                // å»¶è¿Ÿå¤„ç†ç‚¹å‡»äº‹ä»¶ï¼Œé¿å…ä¸æ‹–æ‹½å†²çª
                clickTimer = setTimeout(() => {
                    // å¦‚æœæ­£åœ¨æ‹–æ‹½æˆ–è¿çº¿ï¼Œå¿½ç•¥ç‚¹å‡»
                    if (isDragging || isConnecting || (canvasState && canvasState.isPanning)) {
                        return;
                    }
                    
                    const workflowNode = e.target.closest('.workflow-node');
                    const propertiesPanel = e.target.closest('#propertiesPanel');
                    
                    if (workflowNode) {
                        if (typeof selectNode === 'function') {
                            selectNode(workflowNode);
                        }
                    } else if (!propertiesPanel) {
                        // åªæœ‰åœ¨ä¸æ˜¯ç‚¹å‡»å±æ€§é¢æ¿æ—¶æ‰æ¸…é™¤é€‰æ‹©
                        if (typeof clearSelection === 'function') {
                            clearSelection();
                        }
                    }
                    
                    // ç‚¹å‡»å…¶ä»–åœ°æ–¹éšè—å³é”®èœå•ï¼ˆä½†ä¸å½±å“å±æ€§é¢æ¿ï¼‰
                    if (!e.target.closest('#contextMenu') && typeof hideContextMenu === 'function') {
                        hideContextMenu();
                    }
                }, 50);
            });

            // ç”»å¸ƒæ§åˆ¶æŒ‰é’®äº‹ä»¶
            document.getElementById('zoomIn').addEventListener('click', zoomIn);
            document.getElementById('zoomOut').addEventListener('click', zoomOut);
            document.getElementById('zoomFit').addEventListener('click', fitToScreen);
            document.getElementById('resetView').addEventListener('click', () => {
                canvasState.x = 0;
                canvasState.y = 0;
                canvasState.scale = 1;
                updateCanvasTransform();
                setTimeout(() => {
                    fitToScreen();
                }, 100);
            });

            // å³é”®èœå•äº‹ä»¶
            document.addEventListener('contextmenu', function(e) {
                e.preventDefault();
                return false;
            });

            document.addEventListener('click', function(e) {
                if (!e.target.closest('#contextMenu')) {
                    hideContextMenu();
                }
            });

            document.getElementById('contextMenu').addEventListener('click', function(e) {
                const action = e.target.dataset.action || e.target.parentElement.dataset.action;
                if (action && selectedNode) {
                    handleContextMenuAction(action, selectedNode);
                }
                hideContextMenu();
            });

            // å±æ€§é¢æ¿å…³é—­æŒ‰é’®äº‹ä»¶
            const closePropertiesPanel = document.getElementById('closePropertiesPanel');
            if (closePropertiesPanel) {
                closePropertiesPanel.addEventListener('click', function(e) {
                    e.stopPropagation();
                    if (typeof clearSelection === 'function') {
                        clearSelection();
                    }
                });
            }

            // åˆå§‹åŒ–èŠ‚ç‚¹è®¡æ•°
            try {
                updateNodeCount();
                updateConnectionCount();
                console.log('èŠ‚ç‚¹å’Œè¿æ¥è®¡æ•°æ›´æ–°å®Œæˆ');
            } catch (error) {
                console.error('èŠ‚ç‚¹è®¡æ•°æ›´æ–°å¤±è´¥:', error);
            }

            // æœ€ç»ˆçŠ¶æ€æ£€æŸ¥
            setTimeout(() => {
                console.log('ğŸ‰ é¡µé¢åˆå§‹åŒ–å®Œæˆï¼Œé»˜è®¤æ˜¾ç¤ºæ¨¡æ¿å•†åº—é¡µé¢');
            }, 100);
        });
    </script>
</body>
</html> 
